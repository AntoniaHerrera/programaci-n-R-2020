<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>AnalizaR datos políticos</title>
  <meta name="description" content="Proyecto de libro">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="AnalizaR datos políticos" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Proyecto de libro" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="AnalizaR datos políticos" />
  
  <meta name="twitter:description" content="Proyecto de libro" />
  

<meta name="author" content="Francisco Urdinez y Andrés Cruz Labrín (editores)">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="prev" href="qta.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="libs/wordcloud2-0.0.1/hover.js"></script>
<script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><b><a href="./index.html">analizaR datos políticos</a></b></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Tabla de contenidos</a></li>
<li class="chapter" data-level="1" data-path="prefacio.html"><a href="prefacio.html"><i class="fa fa-check"></i><b>1</b> Prefacio</a><ul>
<li class="chapter" data-level="1.1" data-path="prefacio.html"><a href="prefacio.html#agradecimientos"><i class="fa fa-check"></i><b>1.1</b> Agradecimientos</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduccion.html"><a href="introduccion.html"><i class="fa fa-check"></i><b>2</b> Introducción</a><ul>
<li class="chapter" data-level="2.1" data-path="introduccion.html"><a href="introduccion.html#organizacion-del-libro"><i class="fa fa-check"></i><b>2.1</b> Organización del libro</a></li>
<li class="chapter" data-level="2.2" data-path="introduccion.html"><a href="introduccion.html#prerrequisitos"><i class="fa fa-check"></i><b>2.2</b> Prerrequisitos</a></li>
</ul></li>
<li class="part"><span><b>I Introducción a R</b></span></li>
<li class="chapter" data-level="3" data-path="rbas.html"><a href="rbas.html"><i class="fa fa-check"></i><b>3</b> R básico</a><ul>
<li class="chapter" data-level="3.1" data-path="rbas.html"><a href="rbas.html#instalacion"><i class="fa fa-check"></i><b>3.1</b> Instalación</a><ul>
<li class="chapter" data-level="3.1.1" data-path="rbas.html"><a href="rbas.html#r"><i class="fa fa-check"></i><b>3.1.1</b> R</a></li>
<li class="chapter" data-level="3.1.2" data-path="rbas.html"><a href="rbas.html#rstudio"><i class="fa fa-check"></i><b>3.1.2</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rbas.html"><a href="rbas.html#partes-de-rstudio"><i class="fa fa-check"></i><b>3.2</b> Partes de RStudio</a><ul>
<li class="chapter" data-level="3.2.1" data-path="rbas.html"><a href="rbas.html#consola"><i class="fa fa-check"></i><b>3.2.1</b> Consola</a></li>
<li class="chapter" data-level="3.2.2" data-path="rbas.html"><a href="rbas.html#script"><i class="fa fa-check"></i><b>3.2.2</b> Script</a></li>
<li class="chapter" data-level="3.2.3" data-path="rbas.html"><a href="rbas.html#objetos"><i class="fa fa-check"></i><b>3.2.3</b> Objetos</a></li>
<li class="chapter" data-level="3.2.4" data-path="rbas.html"><a href="rbas.html#archivos-graficos-paquetes-ayuda"><i class="fa fa-check"></i><b>3.2.4</b> Archivos / gráficos / paquetes / ayuda</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="rbas.html"><a href="rbas.html#ejercicios"><i class="fa fa-check"></i><b>3.3</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html"><i class="fa fa-check"></i><b>4</b> Manejo de datos</a><ul>
<li class="chapter" data-level="4.1" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#nuestra-base-de-datos"><i class="fa fa-check"></i><b>4.1</b> Nuestra base de datos</a></li>
<li class="chapter" data-level="4.2" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#describir-la-base"><i class="fa fa-check"></i><b>4.2</b> Describir la base</a></li>
<li class="chapter" data-level="4.3" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#ordenar-la-base-con-arrange"><i class="fa fa-check"></i><b>4.3</b> Ordenar la base con <code>arrange()</code></a></li>
<li class="chapter" data-level="4.4" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#seleccionar-columnas-de-la-base-con-select"><i class="fa fa-check"></i><b>4.4</b> Seleccionar columnas de la base con <code>select()</code></a></li>
<li class="chapter" data-level="4.5" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#renombrar-columnas-de-la-base-con-rename"><i class="fa fa-check"></i><b>4.5</b> Renombrar columnas de la base con <code>rename()</code></a></li>
<li class="chapter" data-level="4.6" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#filtrar-observaciones-de-la-base-con-filter"><i class="fa fa-check"></i><b>4.6</b> Filtrar observaciones de la base con <code>filter()</code></a></li>
<li class="chapter" data-level="4.7" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#crear-nuevas-variables-en-la-base-con-mutate"><i class="fa fa-check"></i><b>4.7</b> Crear nuevas variables en la base con <code>mutate()</code></a></li>
<li class="chapter" data-level="4.8" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#concatenar-comandos-las-pipes"><i class="fa fa-check"></i><b>4.8</b> Concatenar comandos: las pipes (<code>%&gt;%</code>)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>5</b> Visualización de datos</a><ul>
<li class="chapter" data-level="5.1" data-path="dataviz.html"><a href="dataviz.html#por-que-quiero-visualizar-mis-datos"><i class="fa fa-check"></i><b>5.1</b> ¿Por qué quiero visualizar mis datos?</a></li>
<li class="chapter" data-level="5.2" data-path="dataviz.html"><a href="dataviz.html#primeros-pasos"><i class="fa fa-check"></i><b>5.2</b> Primeros pasos</a><ul>
<li class="chapter" data-level="5.2.1" data-path="dataviz.html"><a href="dataviz.html#las-capas-del-multiverso-ggplotidiano"><i class="fa fa-check"></i><b>5.2.1</b> Las capas del multiverso ggplotidiano</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="dataviz.html"><a href="dataviz.html#elecciones-locales-y-visualizacion-de-datos"><i class="fa fa-check"></i><b>5.3</b> Elecciones locales y visualización de datos</a><ul>
<li class="chapter" data-level="5.3.1" data-path="dataviz.html"><a href="dataviz.html#grafico-de-barras"><i class="fa fa-check"></i><b>5.3.1</b> Gráfico de barras</a></li>
<li class="chapter" data-level="5.3.2" data-path="dataviz.html"><a href="dataviz.html#boxplot"><i class="fa fa-check"></i><b>5.3.2</b> Boxplot</a></li>
<li class="chapter" data-level="5.3.3" data-path="dataviz.html"><a href="dataviz.html#relacion-entre-variables"><i class="fa fa-check"></i><b>5.3.3</b> Relación entre variables</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="dataviz.html"><a href="dataviz.html#para-seguir-aprendiendo"><i class="fa fa-check"></i><b>5.4</b> Para seguir aprendiendo</a><ul>
<li class="chapter" data-level="5.4.1" data-path="dataviz.html"><a href="dataviz.html#otros-paquetes"><i class="fa fa-check"></i><b>5.4.1</b> Otros paquetes:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="carga-flujo.html"><a href="carga-flujo.html"><i class="fa fa-check"></i><b>6</b> Carga de bases y flujo de trabajo</a></li>
<li class="part"><span><b>II Modelos</b></span></li>
<li class="chapter" data-level="7" data-path="stats.html"><a href="stats.html"><i class="fa fa-check"></i><b>7</b> Estadística inferencial básica</a></li>
<li class="chapter" data-level="8" data-path="lineal.html"><a href="lineal.html"><i class="fa fa-check"></i><b>8</b> Modelos lineales</a><ul>
<li class="chapter" data-level="8.1" data-path="lineal.html"><a href="lineal.html#introduccion-1"><i class="fa fa-check"></i><b>8.1</b> Introducción</a></li>
<li class="chapter" data-level="8.2" data-path="lineal.html"><a href="lineal.html#aplicacion-en-r"><i class="fa fa-check"></i><b>8.2</b> Aplicación en R</a><ul>
<li class="chapter" data-level="8.2.1" data-path="lineal.html"><a href="lineal.html#estadisticos-descriptivos"><i class="fa fa-check"></i><b>8.2.1</b> Estadísticos Descriptivos</a></li>
<li class="chapter" data-level="8.2.2" data-path="lineal.html"><a href="lineal.html#estadisticos-descriptivos-y-distribucion-de-las-variables-del-modelo"><i class="fa fa-check"></i><b>8.2.2</b> Estadísticos descriptivos y distribución de las variables del modelo</a></li>
<li class="chapter" data-level="8.2.3" data-path="lineal.html"><a href="lineal.html#matriz-de-correlacion-de-variables-independientes"><i class="fa fa-check"></i><b>8.2.3</b> Matriz de correlación de variables independientes</a></li>
<li class="chapter" data-level="8.2.4" data-path="lineal.html"><a href="lineal.html#distribucion-de-las-variables-de-interes"><i class="fa fa-check"></i><b>8.2.4</b> Distribución de las variables de interés</a></li>
<li class="chapter" data-level="8.2.5" data-path="lineal.html"><a href="lineal.html#relacion-entre-la-variable-dependiente-e-independiente"><i class="fa fa-check"></i><b>8.2.5</b> Relación entre la variable dependiente e independiente</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="lineal.html"><a href="lineal.html#modelo-bivariado-regresion-lineal-simple"><i class="fa fa-check"></i><b>8.3</b> Modelo bivariado: regresión lineal simple</a><ul>
<li class="chapter" data-level="8.3.1" data-path="lineal.html"><a href="lineal.html#estimando-un-modelo-lineal-en-r"><i class="fa fa-check"></i><b>8.3.1</b> Estimando un modelo lineal en R</a></li>
<li class="chapter" data-level="8.3.2" data-path="lineal.html"><a href="lineal.html#representacion-grafica."><i class="fa fa-check"></i><b>8.3.2</b> Representación gráfica.</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="lineal.html"><a href="lineal.html#modelo-multivariado-regresion-multiple"><i class="fa fa-check"></i><b>8.4</b> Modelo multivariado: regresión múltiple</a><ul>
<li class="chapter" data-level="8.4.1" data-path="lineal.html"><a href="lineal.html#ajuste-del-modelo"><i class="fa fa-check"></i><b>8.4.1</b> Ajuste del modelo</a></li>
<li class="chapter" data-level="8.4.2" data-path="lineal.html"><a href="lineal.html#inferencia-en-modelos-lineales-multiples"><i class="fa fa-check"></i><b>8.4.2</b> Inferencia en modelos lineales múltiples</a></li>
<li class="chapter" data-level="8.4.3" data-path="lineal.html"><a href="lineal.html#supuestos-de-ols"><i class="fa fa-check"></i><b>8.4.3</b> Supuestos de OLS</a></li>
<li class="chapter" data-level="8.4.4" data-path="lineal.html"><a href="lineal.html#errores-estandares-robustos"><i class="fa fa-check"></i><b>8.4.4</b> Errores estándares robustos</a></li>
<li class="chapter" data-level="8.4.5" data-path="lineal.html"><a href="lineal.html#un-caso-especial-de-heterocedasticidad-la-varianza-del-error-asociada-a-clusters"><i class="fa fa-check"></i><b>8.4.5</b> Un caso especial de Heterocedasticidad: la varianza del error asociada a clusters</a></li>
<li class="chapter" data-level="8.4.6" data-path="lineal.html"><a href="lineal.html#un-supuesto-adicional-para-poder-realizar-inferencia"><i class="fa fa-check"></i><b>8.4.6</b> Un supuesto adicional para poder realizar <strong>inferencia</strong></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="lineal.html"><a href="lineal.html#seleccion-de-casos"><i class="fa fa-check"></i><b>8.5</b> Selección de casos</a><ul>
<li class="chapter" data-level="8.5.1" data-path="lineal.html"><a href="lineal.html#que-casos-seleccionar"><i class="fa fa-check"></i><b>8.5.1</b> ¿Qué casos seleccionar?</a></li>
<li class="chapter" data-level="8.5.2" data-path="lineal.html"><a href="lineal.html#casos-tipicos"><i class="fa fa-check"></i><b>8.5.2</b> Casos Típicos</a></li>
<li class="chapter" data-level="8.5.3" data-path="lineal.html"><a href="lineal.html#casos-desviados"><i class="fa fa-check"></i><b>8.5.3</b> Casos desviados</a></li>
<li class="chapter" data-level="8.5.4" data-path="lineal.html"><a href="lineal.html#casos-influyentes"><i class="fa fa-check"></i><b>8.5.4</b> Casos Influyentes</a></li>
<li class="chapter" data-level="8.5.5" data-path="lineal.html"><a href="lineal.html#casos-extremos"><i class="fa fa-check"></i><b>8.5.5</b> Casos extremos</a></li>
<li class="chapter" data-level="8.5.6" data-path="lineal.html"><a href="lineal.html#casos-mas-similares"><i class="fa fa-check"></i><b>8.5.6</b> Casos más similares</a></li>
<li class="chapter" data-level="8.5.7" data-path="lineal.html"><a href="lineal.html#casos-mas-diferentes"><i class="fa fa-check"></i><b>8.5.7</b> Casos más diferentes</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="lineal.html"><a href="lineal.html#la-relevancia-de-combinar-metodos"><i class="fa fa-check"></i><b>8.6</b> La relevancia de combinar métodos</a></li>
<li class="chapter" data-level="8.7" data-path="lineal.html"><a href="lineal.html#referencias"><i class="fa fa-check"></i><b>8.7</b> Referencias</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="logit.html"><a href="logit.html"><i class="fa fa-check"></i><b>9</b> Modelos binarios</a><ul>
<li class="chapter" data-level="9.1" data-path="logit.html"><a href="logit.html#nociones-basicas"><i class="fa fa-check"></i><b>9.1</b> Nociones básicas</a></li>
<li class="chapter" data-level="9.2" data-path="logit.html"><a href="logit.html#aplicacion-en-r-1"><i class="fa fa-check"></i><b>9.2</b> Aplicación en R</a><ul>
<li class="chapter" data-level="9.2.1" data-path="logit.html"><a href="logit.html#estimar-los-modelos"><i class="fa fa-check"></i><b>9.2.1</b> Estimar los modelos</a></li>
<li class="chapter" data-level="9.2.2" data-path="logit.html"><a href="logit.html#crear-tablas"><i class="fa fa-check"></i><b>9.2.2</b> Crear tablas</a></li>
<li class="chapter" data-level="9.2.3" data-path="logit.html"><a href="logit.html#visualizacion-de-resultados"><i class="fa fa-check"></i><b>9.2.3</b> Visualización de resultados</a></li>
<li class="chapter" data-level="9.2.4" data-path="logit.html"><a href="logit.html#ajuste-de-los-modelos"><i class="fa fa-check"></i><b>9.2.4</b> Ajuste de los modelos</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="logit.html"><a href="logit.html#proximos-pasos"><i class="fa fa-check"></i><b>9.3</b> Próximos pasos</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="surv.html"><a href="surv.html"><i class="fa fa-check"></i><b>10</b> Modelos de supervivencia</a><ul>
<li class="chapter" data-level="10.1" data-path="surv.html"><a href="surv.html#nociones-basicas-1"><i class="fa fa-check"></i><b>10.1</b> Nociones básicas</a></li>
<li class="chapter" data-level="10.2" data-path="surv.html"><a href="surv.html#el-modelo-cox-de-riesgos-proporcionales"><i class="fa fa-check"></i><b>10.2</b> El modelo Cox de riesgos proporcionales</a></li>
<li class="chapter" data-level="10.3" data-path="surv.html"><a href="surv.html#aplicacion-en-r-2"><i class="fa fa-check"></i><b>10.3</b> Aplicación en R</a><ul>
<li class="chapter" data-level="10.3.1" data-path="surv.html"><a href="surv.html#replicar-la-tabla-1.2-de-altman-e-interpretar-sus-coeficientes-como-hazard-ratios."><i class="fa fa-check"></i><b>10.3.1</b> Replicar la tabla 1.2 de Altman e interpretar sus coeficientes como Hazard Ratios.</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Aplicaciones</b></span></li>
<li class="chapter" data-level="11" data-path="manejo-av.html"><a href="manejo-av.html"><i class="fa fa-check"></i><b>11</b> Manejo avanzado de datos políticos</a><ul>
<li class="chapter" data-level="11.1" data-path="manejo-av.html"><a href="manejo-av.html#introduccion-2"><i class="fa fa-check"></i><b>11.1</b> Introducción</a></li>
<li class="chapter" data-level="11.2" data-path="manejo-av.html"><a href="manejo-av.html#como-aprovechar-countrycode"><i class="fa fa-check"></i><b>11.2</b> ¿Cómo aprovechar ´countrycode´?</a></li>
<li class="chapter" data-level="11.3" data-path="manejo-av.html"><a href="manejo-av.html#como-imputar-datos"><i class="fa fa-check"></i><b>11.3</b> ¿Cómo imputar datos?</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>12</b> Creación de índices con Análisis de Componentes Principales (PCA)</a><ul>
<li class="chapter" data-level="12.1" data-path="pca.html"><a href="pca.html#conceptos-importantes"><i class="fa fa-check"></i><b>12.1</b> Conceptos importantes</a></li>
<li class="chapter" data-level="12.2" data-path="pca.html"><a href="pca.html#aplicacion-en-r-3"><i class="fa fa-check"></i><b>12.2</b> Aplicación en R</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="web-mining.html"><a href="web-mining.html"><i class="fa fa-check"></i><b>13</b> Mínería de datos</a></li>
<li class="chapter" data-level="14" data-path="redes.html"><a href="redes.html"><i class="fa fa-check"></i><b>14</b> Análisis de redes</a><ul>
<li class="chapter" data-level="14.1" data-path="redes.html"><a href="redes.html#introduccion-3"><i class="fa fa-check"></i><b>14.1</b> Introducción</a></li>
<li class="chapter" data-level="14.2" data-path="redes.html"><a href="redes.html#conceptos-basicos-de-redes"><i class="fa fa-check"></i><b>14.2</b> Conceptos básicos de redes</a><ul>
<li class="chapter" data-level="14.2.1" data-path="redes.html"><a href="redes.html#nodos-y-enlaces"><i class="fa fa-check"></i><b>14.2.1</b> Nodos y enlaces</a></li>
<li class="chapter" data-level="14.2.2" data-path="redes.html"><a href="redes.html#matriz-de-adyacencia"><i class="fa fa-check"></i><b>14.2.2</b> Matriz de adyacencia</a></li>
<li class="chapter" data-level="14.2.3" data-path="redes.html"><a href="redes.html#pesos-y-direccion"><i class="fa fa-check"></i><b>14.2.3</b> Pesos y dirección</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="redes.html"><a href="redes.html#generar-una-base-de-datos-de-redes"><i class="fa fa-check"></i><b>14.3</b> Generar una base de datos de redes</a></li>
<li class="chapter" data-level="14.4" data-path="redes.html"><a href="redes.html#disposicion-de-los-puntos-en-el-espacio"><i class="fa fa-check"></i><b>14.4</b> Disposición de los puntos en el espacio</a></li>
<li class="chapter" data-level="14.5" data-path="redes.html"><a href="redes.html#calcular-medidas-de-centralidad-basicas"><i class="fa fa-check"></i><b>14.5</b> Calcular medidas de centralidad básicas</a></li>
<li class="chapter" data-level="14.6" data-path="redes.html"><a href="redes.html#detectar-comunidades-en-las-redes"><i class="fa fa-check"></i><b>14.6</b> Detectar comunidades en las redes</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="qta.html"><a href="qta.html"><i class="fa fa-check"></i><b>15</b> Análisis cuantitativo de textos</a><ul>
<li class="chapter" data-level="15.1" data-path="qta.html"><a href="qta.html#introduccion-4"><i class="fa fa-check"></i><b>15.1</b> Introducción</a></li>
<li class="chapter" data-level="15.2" data-path="qta.html"><a href="qta.html#bases-de-datos"><i class="fa fa-check"></i><b>15.2</b> Bases de datos</a></li>
<li class="chapter" data-level="15.3" data-path="qta.html"><a href="qta.html#calculo-de-frecuencias"><i class="fa fa-check"></i><b>15.3</b> Cálculo de frecuencias</a><ul>
<li class="chapter" data-level="15.3.1" data-path="qta.html"><a href="qta.html#hashtags-mas-usados-de-las-cuentas-de-los-diputados"><i class="fa fa-check"></i><b>15.3.1</b> 10 hashtags mas usados de las cuentas de los diputados</a></li>
<li class="chapter" data-level="15.3.2" data-path="qta.html"><a href="qta.html#frecuencias-por-genero-cantidad-de-hashtags-usados-por-los-diputados-en-total"><i class="fa fa-check"></i><b>15.3.2</b> Frecuencias por género: cantidad de hashtags usados por los diputados en total</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="qta.html"><a href="qta.html#wordcloud-de-hashtags"><i class="fa fa-check"></i><b>15.4</b> Wordcloud de hashtags</a></li>
<li class="chapter" data-level="15.5" data-path="qta.html"><a href="qta.html#hashtags-mas-usados-por-genero"><i class="fa fa-check"></i><b>15.5</b> Hashtags más usados por género</a><ul>
<li class="chapter" data-level="15.5.1" data-path="qta.html"><a href="qta.html#entre-las-diputadas"><i class="fa fa-check"></i><b>15.5.1</b> Entre las diputadas</a></li>
<li class="chapter" data-level="15.5.2" data-path="qta.html"><a href="qta.html#entre-las-diputadas-1"><i class="fa fa-check"></i><b>15.5.2</b> Entre las diputadas</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="qta.html"><a href="qta.html#hashtags-de-genero-por-caracteristicas-del-diputado"><i class="fa fa-check"></i><b>15.6</b> Hashtags de género por características del diputado</a><ul>
<li class="chapter" data-level="15.6.1" data-path="qta.html"><a href="qta.html#por-el-genero-del-diputado"><i class="fa fa-check"></i><b>15.6.1</b> Por el género del diputado</a></li>
<li class="chapter" data-level="15.6.2" data-path="qta.html"><a href="qta.html#por-la-coalicion-de-los-diputados"><i class="fa fa-check"></i><b>15.6.2</b> Por la coalición de los diputados</a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="qta.html"><a href="qta.html#variacion-temporal-del-uso-de-estos-hashtags"><i class="fa fa-check"></i><b>15.7</b> Variación temporal del uso de estos hashtags</a><ul>
<li class="chapter" data-level="15.7.1" data-path="qta.html"><a href="qta.html#frecuencia-semanal-de-olafeminista"><i class="fa fa-check"></i><b>15.7.1</b> Frecuencia semanal de #olafeminista</a></li>
<li class="chapter" data-level="15.7.2" data-path="qta.html"><a href="qta.html#frecuencia-semanal-de-tres-hashtags-de-genero"><i class="fa fa-check"></i><b>15.7.2</b> Frecuencia semanal de tres hashtags de género</a></li>
<li class="chapter" data-level="15.7.3" data-path="qta.html"><a href="qta.html#grafiquemos-los-hashtags-de-genero-por-semana"><i class="fa fa-check"></i><b>15.7.3</b> Grafiquemos los hashtags de género por semana</a></li>
<li class="chapter" data-level="15.7.4" data-path="qta.html"><a href="qta.html#ponderamos-en-relacion-al-total-de-hashtags-por-semana"><i class="fa fa-check"></i><b>15.7.4</b> Ponderamos en relación al total de hashtags por semana</a></li>
<li class="chapter" data-level="15.7.5" data-path="qta.html"><a href="qta.html#grafiquemos-los-hashtags-interesantes-ponderados-por-el-total-semanal"><i class="fa fa-check"></i><b>15.7.5</b> Grafiquemos los hashtags interesantes ponderados por el total semanal</a></li>
<li class="chapter" data-level="15.7.6" data-path="qta.html"><a href="qta.html#diputadas"><i class="fa fa-check"></i><b>15.7.6</b> Diputadas</a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="qta.html"><a href="qta.html#hashtags-de-genero-por-semana-a-nivel-de-diputados-ponderados-por-semana"><i class="fa fa-check"></i><b>15.8</b> Hashtags de género por semana a nivel de diputados (ponderados por semana)</a></li>
<li class="chapter" data-level="15.9" data-path="qta.html"><a href="qta.html#comentarios-finales"><i class="fa fa-check"></i><b>15.9</b> Comentarios finales</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i><b>16</b> Generación de mapas</a><ul>
<li class="chapter" data-level="16.1" data-path="mapas.html"><a href="mapas.html#datos-espaciales"><i class="fa fa-check"></i><b>16.1</b> Datos Espaciales</a><ul>
<li class="chapter" data-level="16.1.1" data-path="mapas.html"><a href="mapas.html#que-son"><i class="fa fa-check"></i><b>16.1.1</b> ¿Qué son?</a></li>
<li class="chapter" data-level="16.1.2" data-path="mapas.html"><a href="mapas.html#estructura-de-los-datos-espaciales"><i class="fa fa-check"></i><b>16.1.2</b> Estructura de los Datos Espaciales</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="mapas.html"><a href="mapas.html#datos-espaciales-en-r"><i class="fa fa-check"></i><b>16.2</b> Datos Espaciales en R</a></li>
<li class="chapter" data-level="16.3" data-path="mapas.html"><a href="mapas.html#special-features-en-r"><i class="fa fa-check"></i><b>16.3</b> Special Features en R</a><ul>
<li class="chapter" data-level="16.3.1" data-path="mapas.html"><a href="mapas.html#estructura"><i class="fa fa-check"></i><b>16.3.1</b> Estructura</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="mapas.html"><a href="mapas.html#manejo-de-datos-espaciales"><i class="fa fa-check"></i><b>16.4</b> Manejo de Datos Espaciales</a><ul>
<li class="chapter" data-level="16.4.1" data-path="mapas.html"><a href="mapas.html#modificaciones"><i class="fa fa-check"></i><b>16.4.1</b> Modificaciones</a></li>
<li class="chapter" data-level="16.4.2" data-path="mapas.html"><a href="mapas.html#crear-nuevos-shapefiles-con-st_write"><i class="fa fa-check"></i><b>16.4.2</b> .4 Crear nuevos shapefiles con <code>st_write</code></a></li>
<li class="chapter" data-level="16.4.3" data-path="mapas.html"><a href="mapas.html#incorporar-datos-de-otras-bases-con-merge"><i class="fa fa-check"></i><b>16.4.3</b> Incorporar datos de otras bases con <code>merge</code></a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="mapas.html"><a href="mapas.html#mapear-en-r"><i class="fa fa-check"></i><b>16.5</b> Mapear en R</a></li>
<li class="chapter" data-level="16.6" data-path="mapas.html"><a href="mapas.html#mapeando-variables"><i class="fa fa-check"></i><b>16.6</b> Mapeando variables</a><ul>
<li class="chapter" data-level="16.6.1" data-path="mapas.html"><a href="mapas.html#mapas-animados-con-gganimate"><i class="fa fa-check"></i><b>16.6.1</b> Mapas animados con gganimate</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="mapas.html"><a href="mapas.html#inferencia-a-partir-de-datos-espaciales"><i class="fa fa-check"></i><b>16.7</b> Inferencia a partir de Datos Espaciales</a><ul>
<li class="chapter" data-level="16.7.1" data-path="mapas.html"><a href="mapas.html#indicadores-locales-de-asociacion-espacial-lisa"><i class="fa fa-check"></i><b>16.7.1</b> Indicadores locales de asociación espacial (LISA)</a></li>
<li class="chapter" data-level="16.7.2" data-path="mapas.html"><a href="mapas.html#matriz-de-pesos-espaciales"><i class="fa fa-check"></i><b>16.7.2</b> Matriz de Pesos Espaciales</a></li>
<li class="chapter" data-level="16.7.3" data-path="mapas.html"><a href="mapas.html#morans-i"><i class="fa fa-check"></i><b>16.7.3</b> Moran’s I</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AnalizaR datos políticos</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapas" class="section level1">
<h1><span class="header-section-number">Capítulo 16</span> Generación de mapas</h1>
<p><em>Por Andrea Escobar y Gabriel Ortiz</em></p>
<hr />
<p><strong>Lecturas de referencia</strong></p>
<ul>
<li>Brunsdon, C., &amp; Comber, L. (2015). An introduction to R for spatial analysis and mapping. Sage.</li>
<li>Pebesma E (2018). “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal. <a href="https://journal.r-project.org/archive/2018/RJ-2018-009/index.html.R-Spatial" class="uri">https://journal.r-project.org/archive/2018/RJ-2018-009/index.html.R-Spatial</a>.</li>
<li><a href="https://r-spatial.github.io/sf/index.html">R-Spatial</a><br />
</li>
<li>D. Kahle and H. Wickham. ggmap: Spatial Visualization with ggplot2. The R Journal, 5(1), 144-161. URL
<a href="http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf" class="uri">http://journal.r-project.org/archive/2013-1/kahle-wickham.pdf</a> (Google Maps)</li>
<li>Luc Anselin. (1995) Local Indicators of Spatial Association-LISA Geographical Analysis 27: 93-115</li>
<li>Lansley, G. &amp; Cheshire, L. (2016). An introduction to Spatial Data Analysis and Visualisation in R.</li>
</ul>
<hr />
<p>En este capítulo veremos cómo podemos trabajar con datos espaciales (<em>spatial data</em>) utilizando R dentro del <code>tidyverse</code>. Aquí nos concentraremos en la riqueza que poseen los datos espaciales tanto como herramienta para el análisis exploratorio de datos sobre diversos fenómenos y también para una visualización y comunicación más atractiva y efectiva de nuestros hallazgos. Es decir, este capítulo tiene como misión principal:</p>
<ol style="list-style-type: decimal">
<li>Caracterizar qué son los datos espaciales.</li>
<li>Explicar por qué estos son interesantes de utilizar para el análisis en ciencia política</li>
<li>Su manejo y manipulación en R, teniendo como foco principal su visualización mediante la creación de mapas estáticos y animados mediante <code>ggplot</code> a partir de su relación con otras variables descriptivas.</li>
</ol>
<p>Por lo que no nos adentraremos en la realización de modelos de inferencia estadística a partir de datos espaciales (<em>Spatial Autoreggresion</em>) y tampoco como generar datos geográficos ya que, en general, siempre estaremos trabajando a partir de bases de datos geográficos ya realizadas con anterioridad.</p>
<p>Los datos a utilizar en este capítulo serán un shapefile (formato del cual hablaremos más adelante) de los estados de Brasil, obtenido del <a href="https://geo.nyu.edu/catalog/stanford-ys298mq8577"><em>Spatial Data Repository de la New York University</em></a>, el cual complementamos con datos de <a href="https://doi.org/10.25222/larr.334">(Freire (2018)</a>.</p>
<p>Por un lado, el repositorio de datos espaciales de NYU provee una multitud de datos espaciales para distintos países y áreas geográficas tanto inter como intra nacionales. En este caso, utilizamos una base de límites estaduales de Brasil al año 1991, provista por el <em>Instituto Brasileiro de Geografia e Estatística</em>, la cual sigue vigente dado a que el último cambio administrativo en Brasil a nivel de estados ocurrió el año 1988. Por otro lado, el trabajo de Freire (2018) intenta explicar la causa de la disminución en las tasas de homicidios del estado de Sao Paulo a partir de la implementación de medidas para la reducción del crimen impulsadas por el gobierno estatal. Lo útil de este trabajo es que recopila datos a nivel estadual de diversos indicadores socioeconómicos como PIB, Índice GINI, años de escolaridad promedio, etc., a lo largo de diez años (1990 - 2010), los cuales podremos unir a nuestro shapefile y utilizarlos para graficar estos factores visualmente.</p>
<div id="datos-espaciales" class="section level2">
<h2><span class="header-section-number">16.1</span> Datos Espaciales</h2>
<div id="que-son" class="section level3">
<h3><span class="header-section-number">16.1.1</span> ¿Qué son?</h3>
<p>Los datos espaciales, o más bien <em>geoespaciales</em>, se refieren a los datos que obtenemos sobre lugares geográficos, es decir, lugares en la superficie de la tierra. El uso de este tipo de datos reconoce “el rol clave que conceptos espaciales como la distancia, la ubicación, proximidad, vecindario y región juegan en la sociedad humana”, permitiendo enfrentarnos a los fenómenos desde una perspectiva multivariada y multidimensional, al entregarnos un nuevo tipo de información adicional a nuestras unidades de estudio (CSISS, 2-3). En la ciencia política la perspectiva espacial para el análisis se ha empleado en trabajos como el de King (1997) sobre cómo realizar inferencias ecológicas en la disciplina y en Gimple y Shuknecht (2003) sobre la accesibilidad de los lugares de votación. Este tipo de datos permite responder preguntas tales como si existe influencia en términos de proximidad de los países vecinos sobre la adopción de ciertas políticas, pero también resultan ser una herramienta clave en la exploración de nuestros datos para observar la existencia de patrones territoriales en los fenómenos estudiados.</p>
<p>Durante el último tiempo, la accesibilidad a datos de tipo espacial se ha vuelto cada vez más ampliamente disponible, con iniciativas por parte de los gobiernos para hacer disponible datos de diverso tipo que se relacionan a los procesos sociales y económicos de los países (Brunsdon y Comber, 2015: 18) y con plataformas que permiten obtener coordenadas geográficos e información adicional relacionada a la ubicación geográfica en todo el mundo como Google Maps, <a href="https://www.openstreetmap.org/">Open Street Map</a>, o desde redes sociales como Twitter o Facebook. Mientras que, para investigadores y estudiantes, bases como la mencionada Spatial Data Repository de la NYU proveen archivos de shapefiles de fácil acceso y manipulación para generar visualizaciones y agregar datos georreferenciados de otras bases.</p>
</div>
<div id="estructura-de-los-datos-espaciales" class="section level3">
<h3><span class="header-section-number">16.1.2</span> Estructura de los Datos Espaciales</h3>
<p>Los archivos en los cuales se contienen datos espaciales usualmente se les conoce como <em>shapefiles</em>, los cuales generalmente se contienen en una carpeta que contiene al menos tres archivos con las extensiones .shp, .dbf y.shx.</p>
<div class="figure">
<img src="00-images/carpeta_shapefile_windows.png" alt="Ejemplo de carpeta que contiene un shapefile en Windows. Nota que el archivo .shp contiene la mayor cantidad de información. Además, esta carpeta contiene un archivo adicional .prj" />
<p class="caption">Ejemplo de carpeta que contiene un shapefile en Windows. Nota que el archivo .shp contiene la mayor cantidad de información. Además, esta carpeta contiene un archivo adicional .prj</p>
</div>
<div class="figure">
<img src="00-images/carpeta_shapefile_mac.png" alt="Ejemplo de carpeta que contiene un shapefile en Mac OSX" />
<p class="caption">Ejemplo de carpeta que contiene un shapefile en Mac OSX</p>
</div>
<p>Este tipo de objetos son usualmente representados por vectores, que consisten en la descripción de la geometría o forma (<em>shape</em>) de los objetos, conteniendo usualmente variables adicionales, llamadas atributos, sobre estos mismos datos. Tomando como ejemplo los datos que usaremos durante este capítulo, nuestra base de datos describe los bordes de los estados de Brasil (geometría) y además contiene información sobre la tasa de homicidios de cada uno de estos y otro tipo de datos socioeconómicos de ellos (atributos). Los datos espaciales son diversos en sus características y son usualmente divididos en tipos de vectores que en todos los casos consisten en un set de par de coordenadas (x,y) (Rspatial):</p>
<ul>
<li>Puntos: Una sola ubicación descrita por un punto como una dirección de una casa geocodificada.</li>
<li>Líneas: Segmento compuesto por una serie de puntos unidos el uno con el otro que no conforman un objeto cerrado.</li>
<li>Polígonos: Superficie plana compuesta por una serie de líneas conectadas la una con la otra que forman un objeto cerrado.</li>
<li>Multi-polígonos: Multi-superficie compuesta por polígonos que no necesariamente deben intersectar.</li>
</ul>
<div class="figure">
<img src="00-images/figura_formas.png" alt="Tipos de formas de datos espaciales. (1) Punto, (2) Línea, (3) Polígono." />
<p class="caption">Tipos de formas de datos espaciales. (1) Punto, (2) Línea, (3) Polígono.</p>
</div>
<hr />
<blockquote>
<p>Tip:
Como hemos mencionado, el <a href="https://geo.nyu.edu/">Repositorio de Datos Espaciales de la NYU</a> puede ser una buena alternativa si es que deseas empezar a trabajar con datos espaciales de tu país, estado, o comuna. Si bien está en inglés, puedes buscar shapefiles fácilmente entrando a la página del Repositorio y seleccionas “Polygon” dentro de la categoría “Data Type”. Una vez es hecho esto, es solo un caso de introducir el nombre del área que te interesa en el buscador, seleccionar un resultado y apretar “Download Shapefile” en el costado superior derecho de la página para obtener tus archivos. Otra ventaja de estos datos es que suelen ser de bajo tamaño sin dejar de tener una calidad suficiente, lo cual es conveniente en el caso de que tu hardware posea limitaciones para trabajar con archivos de mayor tamaño.</p>
</blockquote>
<hr />
</div>
</div>
<div id="datos-espaciales-en-r" class="section level2">
<h2><span class="header-section-number">16.2</span> Datos Espaciales en R</h2>
<p>Durante los últimos años R ha avanzado considerablemente en sus herramientas para manipular y analizar datos geográficos de tal manera que esta sea compatible con el formato y las funcionalidades de otros paquetes del programa. En este capítulo nos concentraremos en el paquete <code>sf</code>, creado en el 2016, el cual se creó en base a las funcionalidades de tres paquetes anteriores: <code>sp</code>, <code>rgeos</code> y <code>rgdal</code> y que implementa el modelo estándar de código abierto <em>simple features</em> (cualidades simples) para la representación de objetos del mundo real en el computador, el cual posee atributos tanto espaciales como no espaciales, basados en geometría 2D con interpolación linear entre vértices (Pebesma, 2018).</p>
</div>
<div id="special-features-en-r" class="section level2">
<h2><span class="header-section-number">16.3</span> Special Features en R</h2>
<p>La principal ventaja que nos entrega el paquete <code>sf</code> es que este permite trabajar con datos espaciales dentro del <code>tidyverse</code>, es decir, poder manejar datos espaciales como si fueran cualquier otro tipo de dataset, utilizando así las funciones de los paquetes de R contenidos dentro del metapaquete <code>tidyverse</code> como <code>ggplot2</code> y <code>dplyr</code>.</p>
<p>Primero, si todavía no lo has hecho, necesitarás cargar el paquete <code>tidyverse</code>. Es importante tener la última versión de <code>tidyverse</code> para correr los geomas de <code>ggplot</code> que usaremos en este capítulo. Puedes actualizar a la última versión con el comando <code>install.packages(&quot;tidyverse&quot;)</code>:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>Ahora necesitamos instalar el paquete <code>sf</code>. Para que este funcione en Mac y Linux se deben tener las versiones recientes de GDAL, GEOS, Proj.4 y UDUNTIS instaladas (Para más información ir a <a href="https://github.com/r-spatial/sf#installling" class="uri">https://github.com/r-spatial/sf#installling</a>). Una vez hecho esto podemos instalar el paquete <code>sf</code>:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" data-line-number="1"><span class="co"># devtools::install_github(&quot;robinlovelace/geocompr&quot;)</span></a></code></pre></div>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1"><span class="co"># install.packages(&quot;sf&quot;)</span></a></code></pre></div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" data-line-number="1"><span class="kw">library</span>(sf)</a></code></pre></div>
<div id="estructura" class="section level3">
<h3><span class="header-section-number">16.3.1</span> Estructura</h3>
<p>Para ver la estructura de los objetos de tipo <code>sf</code> cargamos nuestra base de datos en formato shapefile, utilizando el comando <code>st_read</code> (Nota que estamos cargando el <em>archivo</em> “shp_brasil.shp” dentro de la <em>carpeta</em> “shp_brasil”) y llamando el objeto a la consola:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">shp_brasil &lt;-<span class="st">  </span><span class="kw">st_read</span>(<span class="st">&quot;00-datos/shp_brasil/&quot;</span>)</a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="co">## Reading layer `shp_brasil&#39; from data source `/home/andres/Dropbox/Proyecto de libro/adp-bookdown/00-datos/shp_brasil&#39; using driver `ESRI Shapefile&#39;</span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="co">## Simple feature collection with 28 features and 1 field</span></a>
<a class="sourceLine" id="cb259-4" data-line-number="4"><span class="co">## geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb259-5" data-line-number="5"><span class="co">## dimension:      XY</span></a>
<a class="sourceLine" id="cb259-6" data-line-number="6"><span class="co">## bbox:           xmin: -2200000 ymin: -3700000 xmax: 2400000 ymax: 590000</span></a>
<a class="sourceLine" id="cb259-7" data-line-number="7"><span class="co">## epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb259-8" data-line-number="8"><span class="co">## proj4string:    +proj=poly +lat_0=0 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></a></code></pre></div>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb260-1" data-line-number="1">shp_brasil</a>
<a class="sourceLine" id="cb260-2" data-line-number="2"><span class="co">## Simple feature collection with 28 features and 1 field</span></a>
<a class="sourceLine" id="cb260-3" data-line-number="3"><span class="co">## geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb260-4" data-line-number="4"><span class="co">## dimension:      XY</span></a>
<a class="sourceLine" id="cb260-5" data-line-number="5"><span class="co">## bbox:           xmin: -2200000 ymin: -3700000 xmax: 2400000 ymax: 590000</span></a>
<a class="sourceLine" id="cb260-6" data-line-number="6"><span class="co">## epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb260-7" data-line-number="7"><span class="co">## proj4string:    +proj=poly +lat_0=0 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></a>
<a class="sourceLine" id="cb260-8" data-line-number="8"><span class="co">## First 10 features:</span></a>
<a class="sourceLine" id="cb260-9" data-line-number="9"><span class="co">##     estado                       geometry</span></a>
<a class="sourceLine" id="cb260-10" data-line-number="10"><span class="co">## 1 Rondônia MULTIPOLYGON (((-977421 -89...</span></a>
<a class="sourceLine" id="cb260-11" data-line-number="11"><span class="co">## 2     Acre MULTIPOLYGON (((-2179954 -8...</span></a>
<a class="sourceLine" id="cb260-12" data-line-number="12"><span class="co">## 3 Amazonas MULTIPOLYGON (((-1482456 23...</span></a>
<a class="sourceLine" id="cb260-13" data-line-number="13"><span class="co">## 4  Roraima MULTIPOLYGON (((-686729 582...</span></a>
<a class="sourceLine" id="cb260-14" data-line-number="14"><span class="co">##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 6 rows ]</span></a></code></pre></div>
<p>En la siguiente imagen detallamos las partes de nuestro shapefile con sus nombres:
<img src="00-images/imagen_estructura.png" alt="Estructura de un archivo de tipo sf" /></p>
<p>Como se puede observar en la figura anterior, las simple features son guardados por <code>sf</code> como formato data.frame y con el formato adicional de clase <code>sf</code>, por lo que como se mencionaba anteriormente, podemos tratar a este set de datos como cualquier otro dentro del tidyverse, utilizando sus funciones, pipes (%&gt;%), etc. Aquí cada fila consiste en un simple feature y cada columna consiste en un atributo, la diferencia con el data normal es que encontramos una nueva columna de geometrías simple feature (<em>simple feature geometry column</em> - <code>sfc</code>) que contiene las geometrías simple feature (<em>simple feature geometry</em> - <code>sfg</code>), resultando en un data.frame con una columna extra para la información espacial.</p>
<p>Podemos comprobar esto al revisar el tipo de archivo que hemos cargado con el comando <code>class</code>. Nota que “shp_brasil” es al mismo un archivo de tipo “sf” y de tipo “data.frame”:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1"><span class="kw">class</span>(shp_brasil)</a>
<a class="sourceLine" id="cb261-2" data-line-number="2"><span class="co">## [1] &quot;sf&quot;         &quot;data.frame&quot;</span></a></code></pre></div>
<p>Ahora, si vemos más en detalle nuestros datos podemos encontrarnos con que este estándar puede implementar distintos tipos de geometría en nuestras bases de datos:</p>
<ul>
<li>Un vector numérico para un solo punto (POINT)</li>
<li>Una matriz numérica (cada fila es un punto) para una serie de puntos (MULTIPOINT o LINESTRING)</li>
<li>Una lista de matrices para un set de set de puntos (MULTIINESTRING, POLYGON)</li>
<li>Una lista de listas de matrices (MULTIPOLYGON), la cual se vuelve la más utilizada cuando se representan datos geográficos como la forma y ubicación de países u otras unidades administrativas de estos.</li>
<li>Una lista de cualquiera de los elementos mencionados anteriormente (GEOMETRYCOLLECTION)</li>
</ul>
<p>Utilizando el comando <code>st_geometry</code> podemos ver las geometrías que incluye nuestro shapefile:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb262-1" data-line-number="1"><span class="kw">st_geometry</span>(shp_brasil)</a>
<a class="sourceLine" id="cb262-2" data-line-number="2"><span class="co">## Geometry set for 28 features </span></a>
<a class="sourceLine" id="cb262-3" data-line-number="3"><span class="co">## geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb262-4" data-line-number="4"><span class="co">## dimension:      XY</span></a>
<a class="sourceLine" id="cb262-5" data-line-number="5"><span class="co">## bbox:           xmin: -2200000 ymin: -3700000 xmax: 2400000 ymax: 590000</span></a>
<a class="sourceLine" id="cb262-6" data-line-number="6"><span class="co">## epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb262-7" data-line-number="7"><span class="co">## proj4string:    +proj=poly +lat_0=0 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></a>
<a class="sourceLine" id="cb262-8" data-line-number="8"><span class="co">## First 5 geometries:</span></a>
<a class="sourceLine" id="cb262-9" data-line-number="9"><span class="co">## MULTIPOLYGON (((-977421 -892385, -975932 -89366...</span></a>
<a class="sourceLine" id="cb262-10" data-line-number="10"><span class="co">## MULTIPOLYGON (((-2179954 -836549, -2081720 -877...</span></a>
<a class="sourceLine" id="cb262-11" data-line-number="11"><span class="co">## MULTIPOLYGON (((-1482456 230568, -1478207 21450...</span></a>
<a class="sourceLine" id="cb262-12" data-line-number="12"><span class="co">## MULTIPOLYGON (((-686729 582625, -684216 581302,...</span></a>
<a class="sourceLine" id="cb262-13" data-line-number="13"><span class="co">## MULTIPOLYGON (((883666 -122169, 883026 -123338,...</span></a></code></pre></div>
<p>Una vez cargado nuestro shapefile podemos empezar a generar mapas. Nota que la forma para hacer esto está basada en <code>ggplot</code>; solo tenemos que seleccionar nuestra base de datos y agregar el geoma <code>geom_sf</code>:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil)<span class="op">+</span></a>
<a class="sourceLine" id="cb263-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-10"></span>
<img src="mapas_files/figure-html/unnamed-chunk-10-1.png" alt="Mapa de los estados de Brasil" width="480" />
<p class="caption">
Figura 16.1: Mapa de los estados de Brasil
</p>
</div>
</div>
</div>
<div id="manejo-de-datos-espaciales" class="section level2">
<h2><span class="header-section-number">16.4</span> Manejo de Datos Espaciales</h2>
<p>Ya vimos como cargar shapefiles con el <code>st_read</code>. Ahora que ya tenemos el archivo cargado, procederemos a ver que tipo de modificaciones podemos hacerle para generar nuevos datos a partir de nuestra información, así como incorporar datos de otras bases a nuestro shapefile.</p>
<div id="modificaciones" class="section level3">
<h3><span class="header-section-number">16.4.1</span> Modificaciones</h3>
<p>Existen dos principales maneras en que podemos realizar modificaciones a nuestra base georreferenciada. La primera consiste en aplicar las técnicas que hemos aprendidos ocupando el <code>tidyverse</code>, mientras que la segunda contempla ocupar funciones incorporadas en el paguete <code>sf</code>. En este paquete todas las funciones comienzan con st_ para que se pueda captar fácilmente por la herramienta de <em>completition</em> de Rstudio. Estas funciones se utilizan principalmente para transformar y realizar operaciones geográficas. En esta sección combinaremos ambas técnicas para generar nuevas variables y datos asociados a nuestra base.</p>
<div id="filtrar-y-seleccionar-por-unidades-geograficas" class="section level4">
<h4><span class="header-section-number">16.4.1.1</span> Filtrar y seleccionar por unidades geográficas</h4>
<p>Una de las primeras funciones que podemos utilizar las funciones de <code>dplyr</code> para seleccionar datos dentro de nuestra base. Así, por ejemplo, podemos ocupar <code>filter</code> para seleccionar ciertos estados de Brasil, como por ejemplo el estado de São Paulo:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb264-1" data-line-number="1">shp_brasil <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb264-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(estado <span class="op">==</span><span class="st"> &quot;São Paulo&quot;</span>)</a>
<a class="sourceLine" id="cb264-3" data-line-number="3"><span class="co">## Simple feature collection with 1 feature and 1 field</span></a>
<a class="sourceLine" id="cb264-4" data-line-number="4"><span class="co">## geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb264-5" data-line-number="5"><span class="co">## dimension:      XY</span></a>
<a class="sourceLine" id="cb264-6" data-line-number="6"><span class="co">## bbox:           xmin: 92000 ymin: -2800000 xmax: 1e+06 ymax: -2200000</span></a>
<a class="sourceLine" id="cb264-7" data-line-number="7"><span class="co">## epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb264-8" data-line-number="8"><span class="co">## proj4string:    +proj=poly +lat_0=0 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></a>
<a class="sourceLine" id="cb264-9" data-line-number="9"><span class="co">##      estado                       geometry</span></a>
<a class="sourceLine" id="cb264-10" data-line-number="10"><span class="co">## 1 São Paulo MULTIPOLYGON (((719692 -271...</span></a></code></pre></div>
<p>Esto es más útil cuando lo ocupamos de manera combinada con <code>ggplot</code>, para elegir graficar solo algunos polígonos. Así, podemos graficar el estado de São Paulo:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb265-2" data-line-number="2"><span class="st">         </span><span class="kw">filter</span>(estado <span class="op">==</span><span class="st"> &quot;São Paulo&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb265-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-12"></span>
<img src="mapas_files/figure-html/unnamed-chunk-12-1.png" alt="Mapa del estado de São Paulo" width="480" />
<p class="caption">
Figura 16.2: Mapa del estado de São Paulo
</p>
</div>
<p>Un desafío común que solemos encontrar cuando trabajamos con shapefiles de países completos es la existencia de regiones o zonas insulares que forman parte del país administrativamente pero se encuentras aisladas geográficamente, como por ejemplo la Isla de Pascua en Chile. Por diversos motivos, el acceso a datos sobre estas regiones puede ser más limítado, y suelen dejarse fuera de los análisis. Por esto, nos interesa sacar estas regiones de nuestros shapefile. En Brasil, el Distrito Estadual de Fernando de Noronha, un archipielago de 21 islas ubicado en el Océano Atlántica, corresponde a este tipo de casos (posiblemente lo puedes identificar como un pequeño punto en la parte superior derecha de los mapas anteriores). Podemos eliminar este tipo de datos de nuestro shapefile fácilmente utilizando, de nuevo, la función <code>filter</code>.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb266-1" data-line-number="1">shp_brasil &lt;-<span class="st">  </span>shp_brasil <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb266-2" data-line-number="2"><span class="st">   </span><span class="kw">filter</span>(estado <span class="op">!=</span><span class="st"> &quot;Distrito estadual de Fernando de Noronha (PE)&quot;</span>)</a></code></pre></div>
<p>Esto se ve reflejado en los mapas que haremos a continuación:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil)<span class="op">+</span></a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-14"></span>
<img src="mapas_files/figure-html/unnamed-chunk-14-1.png" alt="Mapa de los Estados de Brasil sin el distrito estadual de Fernando de Noronha" width="480" />
<p class="caption">
Figura 16.3: Mapa de los Estados de Brasil sin el distrito estadual de Fernando de Noronha
</p>
</div>
</div>
<div id="generar-centroides" class="section level4">
<h4><span class="header-section-number">16.4.1.2</span> Generar centroides</h4>
<p>Otra opción es generar una nuevas variables asociadas a nuestras unidades, utilizando el comando <code>mutate</code>. Una acción común es la de generar lo que se denomina “centroides”, es decir, puntos ubicados en el centro de nuestras unidades. Para generar los centroides debemos crear las variables <code>centroid</code>, <code>coords</code>, <code>coords_x</code>y <code>coords_y</code>asociadas a nuestras geometrías, utilizando los comandos <code>map</code>y <code>map_dbl</code> del paquete <code>purr</code> y los comandos <code>st_centroid</code> y <code>st_coordinates</code> del paquete <code>sf</code>:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb268-1" data-line-number="1">shp_brasil &lt;-<span class="st"> </span>shp_brasil <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">centroid =</span> <span class="kw">map</span>(geometry, st_centroid), <span class="dt">coords =</span> <span class="kw">map</span>(centroid, </a>
<a class="sourceLine" id="cb268-2" data-line-number="2">    st_coordinates), <span class="dt">coords_x =</span> <span class="kw">map_dbl</span>(coords, <span class="dv">1</span>), <span class="dt">coords_y =</span> <span class="kw">map_dbl</span>(coords, </a>
<a class="sourceLine" id="cb268-3" data-line-number="3">    <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb268-4" data-line-number="4"><span class="kw">head</span>(shp_brasil)</a>
<a class="sourceLine" id="cb268-5" data-line-number="5"><span class="co">## Simple feature collection with 6 features and 5 fields</span></a>
<a class="sourceLine" id="cb268-6" data-line-number="6"><span class="co">## geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb268-7" data-line-number="7"><span class="co">## dimension:      XY</span></a>
<a class="sourceLine" id="cb268-8" data-line-number="8"><span class="co">## bbox:           xmin: -2200000 ymin: -1500000 xmax: 880000 ymax: 590000</span></a>
<a class="sourceLine" id="cb268-9" data-line-number="9"><span class="co">## epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb268-10" data-line-number="10"><span class="co">## proj4string:    +proj=poly +lat_0=0 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></a>
<a class="sourceLine" id="cb268-11" data-line-number="11"><span class="co">##     estado          centroid            coords coords_x coords_y</span></a>
<a class="sourceLine" id="cb268-12" data-line-number="12"><span class="co">## 1 Rondônia -967595, -1219996 -967595, -1219996  -967595 -1219996</span></a>
<a class="sourceLine" id="cb268-13" data-line-number="13"><span class="co">##                         geometry</span></a>
<a class="sourceLine" id="cb268-14" data-line-number="14"><span class="co">## 1 MULTIPOLYGON (((-977421 -89...</span></a>
<a class="sourceLine" id="cb268-15" data-line-number="15"><span class="co">##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 5 rows ]</span></a></code></pre></div>
<p>Una vez generadas estas variables podemos graficarlas con <code>ggplot</code> y el paquete <code>ggrepel</code> para generar los textos:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1"><span class="kw">library</span>(ggrepel)</a></code></pre></div>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb270-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil) <span class="op">+</span></a>
<a class="sourceLine" id="cb270-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb270-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(coords_x, coords_y, <span class="dt">label =</span> estado), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">min.segment.length =</span> <span class="dv">0</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-17"></span>
<img src="mapas_files/figure-html/unnamed-chunk-17-1.png" alt="Mapa de Brasil con nombres de los estados" width="480" />
<p class="caption">
Figura 16.4: Mapa de Brasil con nombres de los estados
</p>
</div>
</div>
<div id="generar-nuevas-unidades-con-st_union" class="section level4">
<h4><span class="header-section-number">16.4.1.3</span> Generar nuevas unidades con <code>st_union</code></h4>
<p>Aún otra opción interesante es la de generar nuevas variables que agrupen a varias de nuestras unidades geográficas. Al hacer esto, estaremos efectivamente generando nuevas unidades geográficas que van más allá de la información originalmente contenida en nuestro shapefile. Por ejemplo, en 1969 el <em>Instituto Brasileiro de Geografia e Estatística</em> dividió el país en 5 regiones que agrupan a los 27 estados del país. Dado que esta es una división con fines académicos y no es reconocida en términos político-administrativos, no es posible encontrar archivos de tipo shapefile que muestren estas regiones. Sin embargo, utilizando <code>mutate</code> y <code>case_when</code>, podemos fácilmente generar nosotros mismos esta categoría:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">shp_brasil &lt;-<span class="st"> </span>shp_brasil <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb271-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">case_when</span>(estado <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Goiás&quot;</span>,<span class="st">&quot;Mato Grosso&quot;</span>,<span class="st">&quot;Mato Grosso do Sul&quot;</span>,</a>
<a class="sourceLine" id="cb271-3" data-line-number="3">                                         <span class="st">&quot;Distrito Federal&quot;</span>) <span class="op">~</span><span class="st"> &quot;Centro-Oeste&quot;</span>,</a>
<a class="sourceLine" id="cb271-4" data-line-number="4">                            estado <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Acre&quot;</span>,<span class="st">&quot;Amapá&quot;</span>,<span class="st">&quot;Amazonas&quot;</span>,<span class="st">&quot;Pará&quot;</span>,<span class="st">&quot;Rondônia&quot;</span>,</a>
<a class="sourceLine" id="cb271-5" data-line-number="5">                                         <span class="st">&quot;Roraima&quot;</span>,<span class="st">&quot;Tocantins&quot;</span>) <span class="op">~</span><span class="st"> &quot;Norte&quot;</span>,</a>
<a class="sourceLine" id="cb271-6" data-line-number="6">                            estado <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Alagoas&quot;</span>,<span class="st">&quot;Bahia&quot;</span>,<span class="st">&quot;Ceará&quot;</span>,<span class="st">&quot;Maranhão&quot;</span>,<span class="st">&quot;Paraíba&quot;</span>,</a>
<a class="sourceLine" id="cb271-7" data-line-number="7">                                         <span class="st">&quot;Pernambuco&quot;</span>,<span class="st">&quot;Piauí&quot;</span>,<span class="st">&quot;Rio Grande do Norte&quot;</span>,</a>
<a class="sourceLine" id="cb271-8" data-line-number="8">                                         <span class="st">&quot;Sergipe&quot;</span>) <span class="op">~</span><span class="st"> &quot;Nordeste&quot;</span>,</a>
<a class="sourceLine" id="cb271-9" data-line-number="9">                            estado <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Espírito Santo&quot;</span>,<span class="st">&quot;Minas Gerais&quot;</span>,<span class="st">&quot;Rio de Janeiro&quot;</span>,</a>
<a class="sourceLine" id="cb271-10" data-line-number="10">                                          <span class="st">&quot;São Paulo&quot;</span>) <span class="op">~</span><span class="st"> &quot;Sudeste&quot;</span>,</a>
<a class="sourceLine" id="cb271-11" data-line-number="11">                            estado <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Paraná&quot;</span>,<span class="st">&quot;Rio Grande do Sul&quot;</span>,<span class="st">&quot;Santa Catarina&quot;</span>) <span class="op">~</span><span class="st"> &quot;Sul&quot;</span>))</a></code></pre></div>
<p>Una vez generada esta variable, la podemos incorporar a nuestro mapa:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb272-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil)<span class="op">+</span></a>
<a class="sourceLine" id="cb272-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> region))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="mapas_files/figure-html/unnamed-chunk-19-1.png" alt="Mapa de los estados de Brasil según región" width="480" />
<p class="caption">
Figura 16.5: Mapa de los estados de Brasil según región
</p>
</div>
<p>Mejor aún, podemos ocupar esta categoría para generar nuevas geometrías con <code>group_by</code>, <code>summarise</code> y <code>st_union</code>:</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1">shp_brasil_regiones &lt;-<span class="st">  </span>shp_brasil <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb273-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(region)<span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb273-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">geometry =</span> <span class="kw">st_union</span>(geometry)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb273-4" data-line-number="4"><span class="st">  </span><span class="kw">ungroup</span>()</a></code></pre></div>
<p>Podemos graficar este resultado con <code>ggplot</code>:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb274-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_regiones) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb274-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> region))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-21"></span>
<img src="mapas_files/figure-html/unnamed-chunk-21-1.png" alt="Mapa de las regiones de Brasil" width="480" />
<p class="caption">
Figura 16.6: Mapa de las regiones de Brasil
</p>
</div>
<p>Nota que esto no genera objetos completamente “lisos”, es decir, todavía tienen se observan algunas líneas en su interior, probablemente ocasionadas debido los polígonos de nuestro shapefile no se superponen de manera perfecta. Esta es una dificultad común al hacer este tipo de operaciones y puede ocurrir hasta al trabajar con shapefiles más sofísticados. Pese a estas dificultades, este tipo de operaciones puede ser muy útil al, por ejemplo, elaborar distritos electorales compuestos de varias provincias o municipalidades, por ejemplo.</p>
</div>
</div>
<div id="crear-nuevos-shapefiles-con-st_write" class="section level3">
<h3><span class="header-section-number">16.4.2</span> .4 Crear nuevos shapefiles con <code>st_write</code></h3>
<p>Podemos guardar este nuevo shapefile con la función <code>st_write</code>, en la que solo tenemos que seleccionar el objeto que deseamos guardar y la ruta en que queremos que se guarde. En este caso guardaremos el archivo “shp_brasil_regiones.shp” en una carpeta del mismo nombre. Esto genera automáticamente no solo el .shp sino que también todos los otros archivos que componen el shapefile:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1"><span class="kw">st_write</span>(shp_brasil_regiones,<span class="st">&quot;datos/shp_brasil_regiones/shp_brasil_regiones.shp&quot;</span>)</a></code></pre></div>
<hr />
<blockquote>
<p>Advertencia:
El comando <code>st_write</code> no puede sobrescribir archivos ya existentes, e intentar hacer esto reportará automáticamente un error. Si deseas modificar un shapefile que ya has generado previamente, deberás borrarlo manualmente de su carpeta antes de generar los nuevos archivos.</p>
</blockquote>
<hr />
</div>
<div id="incorporar-datos-de-otras-bases-con-merge" class="section level3">
<h3><span class="header-section-number">16.4.3</span> Incorporar datos de otras bases con <code>merge</code></h3>
<p>Primero vamos a ver como incorporar datos de otras bases de datos a nuestro shapefile, ya que usualmente vamos a querer conocer <em>atributos</em> de nuestros lugares geográficos para generar análisis exploratorios o de inferencia estadística. En primer lugar, vamos a cargar la base de datos de Freire (previamente hemos eliminados algunos datos para simplificar la base):</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb276-1" data-line-number="1">base_brasil &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;00-datos/base_brasil.csv&quot;</span>)</a>
<a class="sourceLine" id="cb276-2" data-line-number="2"><span class="kw">head</span>(base_brasil)</a>
<a class="sourceLine" id="cb276-3" data-line-number="3"><span class="co">## # A tibble: 6 x 6</span></a>
<a class="sourceLine" id="cb276-4" data-line-number="4"><span class="co">##   codigo estado  anio tasa_homicidios   gini poblacion_extrema_pobreza</span></a>
<a class="sourceLine" id="cb276-5" data-line-number="5"><span class="co">##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;                     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb276-6" data-line-number="6"><span class="co">## 1     12 Acre    1990            15.8  0.544                     48965</span></a>
<a class="sourceLine" id="cb276-7" data-line-number="7"><span class="co">## 2     12 Acre    1991            25.1 NA                            NA</span></a>
<a class="sourceLine" id="cb276-8" data-line-number="8"><span class="co">## 3     12 Acre    1992            24.7  0.560                     60910</span></a>
<a class="sourceLine" id="cb276-9" data-line-number="9"><span class="co">## 4     12 Acre    1993            26.1  0.553                     57492</span></a>
<a class="sourceLine" id="cb276-10" data-line-number="10"><span class="co">## 5     12 Acre    1994            19.7 NA                            NA</span></a>
<a class="sourceLine" id="cb276-11" data-line-number="11"><span class="co">## 6     12 Acre    1995            22.6  0.582                     38659</span></a></code></pre></div>
<p>Notarás que nuestra base contiene la variable <code>estado</code>. Esta misma variable está presente en nuestro shapefile:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1">shp_brasil<span class="op">$</span>estado</a>
<a class="sourceLine" id="cb277-2" data-line-number="2"><span class="co">## [1] Rondônia  Acre      Amazonas  Roraima   Pará      Amapá     Tocantins</span></a>
<a class="sourceLine" id="cb277-3" data-line-number="3"><span class="co">## [8] Maranhão </span></a>
<a class="sourceLine" id="cb277-4" data-line-number="4"><span class="co">##  [ reached getOption(&quot;max.print&quot;) -- omitted 19 entries ]</span></a>
<a class="sourceLine" id="cb277-5" data-line-number="5"><span class="co">## 28 Levels: Acre Alagoas Amapá Amazonas Bahia ... Tocantins</span></a></code></pre></div>
<p>Previamente nos hemos asegurado de que las observaciones estén codificadas de la misma manera tanto en la base como en el shapefile. De esta forma podemos juntar las bases utilizando el comando <code>merge</code>:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb278-1" data-line-number="1">shp_brasil_datos &lt;-<span class="st"> </span>shp_brasil <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb278-2" data-line-number="2"><span class="st">  </span><span class="kw">merge</span>(base_brasil)</a></code></pre></div>
<p>Utilizando <code>head</code> podemos ver el resultado de esta operación:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="kw">head</span>(shp_brasil_datos)</a>
<a class="sourceLine" id="cb279-2" data-line-number="2"><span class="co">## Simple feature collection with 6 features and 11 fields</span></a>
<a class="sourceLine" id="cb279-3" data-line-number="3"><span class="co">## geometry type:  MULTIPOLYGON</span></a>
<a class="sourceLine" id="cb279-4" data-line-number="4"><span class="co">## dimension:      XY</span></a>
<a class="sourceLine" id="cb279-5" data-line-number="5"><span class="co">## bbox:           xmin: -2200000 ymin: -1300000 xmax: -1400000 ymax: -830000</span></a>
<a class="sourceLine" id="cb279-6" data-line-number="6"><span class="co">## epsg (SRID):    NA</span></a>
<a class="sourceLine" id="cb279-7" data-line-number="7"><span class="co">## proj4string:    +proj=poly +lat_0=0 +lon_0=-54 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</span></a>
<a class="sourceLine" id="cb279-8" data-line-number="8"><span class="co">##      estado centroid coords coords_x coords_y region codigo anio</span></a>
<a class="sourceLine" id="cb279-9" data-line-number="9"><span class="co">##      tasa_homicidios gini poblacion_extrema_pobreza geometry</span></a>
<a class="sourceLine" id="cb279-10" data-line-number="10"><span class="co">##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 6 rows ]</span></a></code></pre></div>
<p>Una vez que tenemos esta información incorporada a nuestro shapefile, estos datos nos servirán cuando empecemos a mapear variables en la sección 4.</p>
</div>
</div>
<div id="mapear-en-r" class="section level2">
<h2><span class="header-section-number">16.5</span> Mapear en R</h2>
<p>Los mapas han sido históricamente la manera principal para almacenar y comunicar datos espaciales, y los objetos y sus atributos pueden ser plasmados fácilmente de manera tal que el ojo humano pueda reconocer rápidamente patrones y anomalías en un mapa bien diseñado <a href="http://www.spatialanalysisonline.com/HTML/index.html">(Spatial Analysis Online)</a>. En esta sección aprenderás a realizar mapas de distinto tipo (tanto estáticos como animados) a partir de datos geográficos y de sus atributos teniendo como base el formato de <code>ggplot2</code>:</p>
<p>En primer lugar, podemos generar visualizaciones más complejas de elementos que ya hemos visto en secciones anteriores. Por ejemplo, podemos mapear cada una de nuestras unidades con un color distinto utilizando el argumento <code>fill</code> de <code>ggplot</code>:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb280-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil)<span class="op">+</span></a>
<a class="sourceLine" id="cb280-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> estado))<span class="op">+</span></a>
<a class="sourceLine" id="cb280-3" data-line-number="3"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-27"></span>
<img src="mapas_files/figure-html/unnamed-chunk-27-1.png" alt="Mapa de Brasil con colores por estado" width="480" />
<p class="caption">
Figura 16.7: Mapa de Brasil con colores por estado
</p>
</div>
<p>También podemos cambiar el color base de nuestra imagen, así como el color de las líneas divisorias entre unidades geográficas:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil)<span class="op">+</span></a>
<a class="sourceLine" id="cb281-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb281-3" data-line-number="3"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-28"></span>
<img src="mapas_files/figure-html/unnamed-chunk-28-1.png" alt="Mapa de los estados de Brasil con fondo blanco y fronteras azules" width="480" />
<p class="caption">
Figura 16.8: Mapa de los estados de Brasil con fondo blanco y fronteras azules
</p>
</div>
<p>También podemos generar una visualización más simple si eliminamos los indicadores de coordenadas que aparecen al borde de nuestro gráfico. Podemos hacer esto con el comando <code>coord_sf</code> y el comando <code>theme_void</code>:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb282-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb282-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb282-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(shp_brasil), <span class="dt">datum =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb282-4" data-line-number="4"><span class="st">  </span><span class="kw">theme_void</span>()</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-29"></span>
<img src="mapas_files/figure-html/unnamed-chunk-29-1.png" alt="Mapa de los estados Brasil sin coordenadas ni líneas cartesianas" width="480" />
<p class="caption">
Figura 16.9: Mapa de los estados Brasil sin coordenadas ni líneas cartesianas
</p>
</div>
<p>O incluso podemos combinar varias de estas opciones en una sola imagen. Por ejemplo, en la siguiente imagen generamos un mapa con bordes negros y colores de relleno distintos para cada estado, donde además se señaliza el punto centroide de cada unidad y se eliminan los indicadores de coordenadas:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> shp_brasil, <span class="kw">aes</span>(<span class="dt">fill =</span> estado)) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_text_repel</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(coords_x, coords_y, <span class="dt">label =</span> estado), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">min.segment.length =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb283-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(shp_brasil), <span class="dt">datum =</span> <span class="ot">NA</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb283-5" data-line-number="5"><span class="st">  </span><span class="kw">theme_void</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb283-6" data-line-number="6"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">fill =</span> <span class="st">&quot;none&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-30"></span>
<img src="mapas_files/figure-html/unnamed-chunk-30-1.png" alt="Mapa de Brasil con colores y nombres por estado y sin coordenadas ni líneas cartesianas" width="480" />
<p class="caption">
Figura 16.10: Mapa de Brasil con colores y nombres por estado y sin coordenadas ni líneas cartesianas
</p>
</div>
</div>
<div id="mapeando-variables" class="section level2">
<h2><span class="header-section-number">16.6</span> Mapeando variables</h2>
<p>Como ya hemos agregado los datos de Freire (2018) a nuestro shapefile, podemos ocupar estas variables para ejemplificar diferencias entre nuestras unidades geográficas. Así, por ejemplo, podemos mostrar el índice Gini para cada estado con el argumento <code>fill</code>. Los datos corresponden al promedio de los años observados:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_datos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(gini <span class="op">!=</span><span class="st"> &quot;NA&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb284-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> gini)) </a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-31"></span>
<img src="mapas_files/figure-html/unnamed-chunk-31-1.png" alt="Mapa de los estados de Brasil según índice Gini" width="480" />
<p class="caption">
Figura 16.11: Mapa de los estados de Brasil según índice Gini
</p>
</div>
<p>También podemos combinar esto con <code>filter</code> para seleccionar solo ciertos años de nuestra base. Por ejemplo, podemos mostrar la cantidad de personas en extrema pobreza para el año 2009 en los diferentes estados:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_datos <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(anio <span class="op">==</span><span class="st"> </span><span class="dv">2009</span>) ) <span class="op">+</span></a>
<a class="sourceLine" id="cb285-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> poblacion_extrema_pobreza)) </a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-32"></span>
<img src="mapas_files/figure-html/unnamed-chunk-32-1.png" alt="Mapa de los estados de Brasil según población en extrema pobreza" width="480" />
<p class="caption">
Figura 16.12: Mapa de los estados de Brasil según población en extrema pobreza
</p>
</div>
<div id="mapas-animados-con-gganimate" class="section level3">
<h3><span class="header-section-number">16.6.1</span> Mapas animados con gganimate</h3>
<p>Cuando estamos trabajando con datos por ciertos periodos de tiempo una visualización que puede ser de utilidad es el mostrar la evolución de una variable a través de ese periodo. Para hacer esto generalmente lo que haríamos es generar varios gráficos de distintos puntos temporales y después unirlos en una sola figura. Por ejemplo, podríamos generar distintos mapas con las tasas de homicidios para cada estado desde el año 2006 hasta el año 2009 e incorporarlos todos a una misma figura con el paquete <code>gridExtra</code>:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">ggplot</span>(shp_brasil_datos <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">filter</span>(anio <span class="op">==</span><span class="st"> </span><span class="dv">2006</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> tasa_homicidios))<span class="op">+</span></a>
<a class="sourceLine" id="cb286-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Año: 2006&quot;</span>)</a>
<a class="sourceLine" id="cb286-4" data-line-number="4">b &lt;-<span class="st"> </span><span class="kw">ggplot</span>(shp_brasil_datos <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">filter</span>(anio <span class="op">==</span><span class="st"> </span><span class="dv">2007</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> tasa_homicidios)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Año: 2007&quot;</span>)</a>
<a class="sourceLine" id="cb286-7" data-line-number="7">c &lt;-<span class="st"> </span><span class="kw">ggplot</span>(shp_brasil_datos <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">filter</span>(anio <span class="op">==</span><span class="st"> </span><span class="dv">2008</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> tasa_homicidios)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Año: 2008&quot;</span>)</a>
<a class="sourceLine" id="cb286-10" data-line-number="10">d &lt;-<span class="st"> </span><span class="kw">ggplot</span>(shp_brasil_datos <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">filter</span>(anio <span class="op">==</span><span class="st"> </span><span class="dv">2009</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> tasa_homicidios)) <span class="op">+</span></a>
<a class="sourceLine" id="cb286-12" data-line-number="12"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Año: 2009&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" data-line-number="1"><span class="kw">library</span>(gridExtra)</a></code></pre></div>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1"><span class="kw">grid.arrange</span>(a,b,c,d)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-35"></span>
<img src="mapas_files/figure-html/unnamed-chunk-35-1.png" alt="Mapas de los estados de Brasil según tasas de homicidios" width="480" />
<p class="caption">
Figura 16.13: Mapas de los estados de Brasil según tasas de homicidios
</p>
</div>
<p>Sin embargo, una opción más dinámica para mostrar estos cambios es la de mostrar los mismos datos en un mismo mapa que cambie a medida que cambie la unidad temporal específica. Al usar tan solo un mapa, esto también nos permite incorporar más unidades temporales; así, por ejemplo, podemos ver las tasas de homicidios en cada estado desde 1990 a la fecha. Para hacer esto primero debemos instalar el paquete <code>gganimate</code>. Como este aún no está disponible desde CRAN, debemos utilizar <code>devtools</code>para instalarlo:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&#39;thomasp85/gganimate&#39;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1"><span class="kw">library</span>(gganimate)</a></code></pre></div>
<p>Una vez hecho esto, podemos generar el objeto utilizando <code>ggplot</code>y el comando <code>transition_manual</code>. En este ultimo seleccionamos como argumento nuestra variable temporal, que en este caso corresponde a “anio”. También al seleccionar la función “{current_frame}” como parte de nuestro subtitulo hace que se muestre automáticamente el año al cambiar la imagen:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb291-1" data-line-number="1">e &lt;-<span class="st"> </span><span class="kw">ggplot</span>(shp_brasil_datos)<span class="op">+</span></a>
<a class="sourceLine" id="cb291-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>tasa_homicidios))<span class="op">+</span></a>
<a class="sourceLine" id="cb291-3" data-line-number="3"><span class="st">  </span><span class="kw">transition_manual</span>(anio)<span class="op">+</span></a>
<a class="sourceLine" id="cb291-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">subtitle =</span> <span class="st">&quot;Año: {current_frame}&quot;</span>)</a></code></pre></div>
<p>Una vez generado el objeto, simplemente utilizamos el comando <code>animate</code> para generar la animación:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb292-1" data-line-number="1"><span class="kw">animate</span>(e)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-39"></span>
<img src="mapas_files/figure-html/unnamed-chunk-39-1.gif" alt="Mapa animado de los estados de Brasil según tasas de homicidios"  />
<p class="caption">
Figura 16.14: Mapa animado de los estados de Brasil según tasas de homicidios
</p>
</div>
<p>También podemos guardar nuestra animación en diferentes formatos. Por ejemplo, podemos guardar nuestra animación en forma de gif con el argumento <code>renderer</code> y el comando <code>gifski_renderer</code>. Solo tenemos que seleccionar una ruta de exportación:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1"><span class="kw">animate</span>(e, <span class="dt">renderer =</span> <span class="kw">gifski_renderer</span>(<span class="st">&quot;00-images/tasas_homicidio_brasil.gif&quot;</span>))</a></code></pre></div>
<p>Para generar otros tipos de archivos animados, podemos revisar la documentación de <code>renderers</code>:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb294-1" data-line-number="1">?renderers</a></code></pre></div>
</div>
</div>
<div id="inferencia-a-partir-de-datos-espaciales" class="section level2">
<h2><span class="header-section-number">16.7</span> Inferencia a partir de Datos Espaciales</h2>
<p>Más allá del análisis exploratorio y descriptivo que podemos realizar con los datos espaciales, estos también son de gran utilidad para realizar inferencia sobre la relación entre distintos fenómenos. La inferencia en base a datos espaciales parte de la base de reconocer que las observaciones en el espacio no pueden ser asumidas todo el tiempo como mutuamente independientes, debido a que las observaciones que están cerca la una de la otra son la mayoría del tiempo similares, por lo que debemos prestar atención a los diferentes patrones de asociación espacial que existen en los fenómenos que estudiamos.</p>
<p>Estos patrones espaciales (que llamamos <em>autocorrelación espacial</em>), miden cómo la distancia influencia una variable en particular, pudiendo ser utilizados como información relevante sobre tipos de influencia que no han sido observadas o consideradas. (Bivand, Pebesma &amp; Gomez-Rubio, 2008: 11).</p>
<div id="indicadores-locales-de-asociacion-espacial-lisa" class="section level3">
<h3><span class="header-section-number">16.7.1</span> Indicadores locales de asociación espacial (LISA)</h3>
<p>En esta sección encontrarás los mecanismos básicos para adentrarse en la correlación espacial, basándonos en los LISA (Local indicator of spatial asociation), indicadores locales de asociación espacial introducidos por (Luc Anselin (1995))[ <a href="https://onlinelibrary.wiley.com/doi/epdf/10.1111/j.1538-4632.1995.tb00338.x" class="uri">https://onlinelibrary.wiley.com/doi/epdf/10.1111/j.1538-4632.1995.tb00338.x</a>]. Estos permiten indicar la existencia de similitud (correlación) entre observaciones próximas las unas a las otras, es decir, si están agrupadas (<em>clustered</em>) espacialmente. Para esto Anselin indica que:</p>
<ul>
<li>El LISA para cada observación da un indicador sobre el grado de clustering espacial significativo de valores similares alrededor de esa observación</li>
<li>La suma de los LISAs de todas las observaciones es proporcional a un indicador global de correlación espacial.</li>
</ul>
<p>Y mediante el testeo de significancia estadística para estos indicadores, se pueden identificar localidades en donde hay un grado significativo de clustering (o repulsión espacial) (Brunsdon &amp; Comber, 2015, 249). Se dice que las variables tienen una correlación espacial positiva cuando valores similares tienden a estar más cercanos entre ellos que los valores distintos (Lansley &amp; Cheschire, 2016, 77)</p>
</div>
<div id="matriz-de-pesos-espaciales" class="section level3">
<h3><span class="header-section-number">16.7.2</span> Matriz de Pesos Espaciales</h3>
<p>El primer paso para realizar este tipo de análisis es determinar el set de vecindarios para cada observación, es decir, identificar los polígonos que comparten fronteras entre ellos. Luego, debemos asignar pesos a cada relación vecina, que permiten definir la fuerza de esta relación en base a cercanía. En las matrices de peso, los vecinos son definidos por un método binario (0,1) en cada fila indicando si existe o no relación.</p>
<p>Para hacer este tipo de análisis primero necesitamos cargar el paquete <code>spdep</code> y guardar las coordenadas de las unidades de nuestro mapa:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="kw">library</span>(spdep)</a></code></pre></div>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb296-1" data-line-number="1">coords &lt;-<span class="st"> </span><span class="kw">coordinates</span>(<span class="kw">as</span>((shp_brasil), <span class="st">&#39;Spatial&#39;</span>))</a></code></pre></div>
<p>También en esta sección trabajaremos con el shapefile al cual hemos agregado datos de la base de Freire (2018), <code>shp_brasil_datos</code>,pero solo ocuparemos datos del último año disponible, correspondiente a 2009:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1">shp_brasil_datos &lt;-<span class="st"> </span>shp_brasil_datos <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">filter</span>(anio <span class="op">==</span><span class="st"> </span><span class="dv">2009</span>)</a></code></pre></div>
<p>Existen tres criterios diferentes para calcular los vecindarios:</p>
<ol style="list-style-type: decimal">
<li>Rook: Considera como vecinos a cualquier par de celdas que compartan alguna arista (borde).</li>
</ol>
<p><img src="00-images/imagen_rook.png" /></p>
<p>Para generar este critero se utiliza el comando <code>poly2nb</code> del paquete <code>spdep</code>. Debemos fijarnos que el argumento <code>queen</code> este fijado en ‘FALSE’.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" data-line-number="1">rook_brasil &lt;-<span class="st"> </span><span class="kw">poly2nb</span>(<span class="kw">as</span>(shp_brasil_datos, <span class="st">&#39;Spatial&#39;</span>),</a>
<a class="sourceLine" id="cb298-2" data-line-number="2">                   <span class="dt">row.names =</span> shp_brasil<span class="op">$</span>estado,</a>
<a class="sourceLine" id="cb298-3" data-line-number="3">                   <span class="dt">queen     =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Podemos plotear con el comando <code>plot.nb</code>:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1"><span class="kw">plot.nb</span>(rook_brasil,coords)</a></code></pre></div>
<p><img src="mapas_files/figure-html/unnamed-chunk-46-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>Y podemos graficar esto por encima de nuestro mapa con <code>ggplot</code>. Primero necesitamos pasar nuestras coordenadas a un dataframe con esta función de <a href="https://mbjoseph.github.io/2015/06/15/nb_ggmap.html">Maxwell B. Joseph</a>.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb300-1" data-line-number="1">nb_to_df &lt;-<span class="st"> </span><span class="cf">function</span>(nb, coords){</a>
<a class="sourceLine" id="cb300-2" data-line-number="2">  x &lt;-<span class="st"> </span>coords[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb300-3" data-line-number="3">  y &lt;-<span class="st"> </span>coords[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb300-4" data-line-number="4">  n &lt;-<span class="st"> </span><span class="kw">length</span>(nb)</a>
<a class="sourceLine" id="cb300-5" data-line-number="5"></a>
<a class="sourceLine" id="cb300-6" data-line-number="6">  cardnb &lt;-<span class="st"> </span><span class="kw">card</span>(nb)</a>
<a class="sourceLine" id="cb300-7" data-line-number="7">  i &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>n, cardnb)</a>
<a class="sourceLine" id="cb300-8" data-line-number="8">  j &lt;-<span class="st"> </span><span class="kw">unlist</span>(nb)</a>
<a class="sourceLine" id="cb300-9" data-line-number="9">  <span class="kw">return</span>(<span class="kw">data.frame</span>(<span class="dt">x=</span>x[i], <span class="dt">xend=</span>x[j],</a>
<a class="sourceLine" id="cb300-10" data-line-number="10">                    <span class="dt">y=</span>y[i], <span class="dt">yend=</span>y[j]))</a>
<a class="sourceLine" id="cb300-11" data-line-number="11">}</a></code></pre></div>
<p>Generamos el dataframe:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1">rook_brasil_df &lt;-<span class="st"> </span><span class="kw">nb_to_df</span>(rook_brasil, coords)</a></code></pre></div>
<p>Y ahora podemos generar el gráfico con los los geomas <code>geom_point</code>y <code>geom_segment</code>:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb302-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_datos) <span class="op">+</span></a>
<a class="sourceLine" id="cb302-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb302-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> rook_brasil_df,</a>
<a class="sourceLine" id="cb302-4" data-line-number="4">             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))<span class="op">+</span></a>
<a class="sourceLine" id="cb302-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> rook_brasil_df,</a>
<a class="sourceLine" id="cb302-6" data-line-number="6">               <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">xend =</span> xend, <span class="dt">y =</span> y, <span class="dt">yend =</span> yend))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-49"></span>
<img src="mapas_files/figure-html/unnamed-chunk-49-1.png" alt="Mapa de vecinos, criterio Rook" width="480" />
<p class="caption">
Figura 16.15: Mapa de vecinos, criterio Rook
</p>
</div>
<ol start="2" style="list-style-type: decimal">
<li>Queen: Considera como vecinos a cualquier par de celdas que compartan alguna arista o un punto.</li>
</ol>
<p><img src="00-images/imagen_queen.png" /></p>
<p>Para generar este criterio igualmente utilizamos el comando <code>poly2nb</code> y generamos el dataframe:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1">queen_brasil &lt;-<span class="st"> </span><span class="kw">poly2nb</span>(<span class="kw">as</span>(shp_brasil_datos, <span class="st">&#39;Spatial&#39;</span>),</a>
<a class="sourceLine" id="cb303-2" data-line-number="2">                   <span class="dt">row.names =</span> shp_brasil<span class="op">$</span>estado)</a>
<a class="sourceLine" id="cb303-3" data-line-number="3">queen_brasil_df &lt;-<span class="st"> </span><span class="kw">nb_to_df</span>(queen_brasil, coords)</a></code></pre></div>
<p>Y ahora podemos generar el gráfico, lo cual hacemos directamente sobre nuestro mapa de Brasil:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb304-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_datos) <span class="op">+</span></a>
<a class="sourceLine" id="cb304-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb304-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> queen_brasil_df,</a>
<a class="sourceLine" id="cb304-4" data-line-number="4">             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))<span class="op">+</span></a>
<a class="sourceLine" id="cb304-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> queen_brasil_df,</a>
<a class="sourceLine" id="cb304-6" data-line-number="6">               <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">xend =</span> xend, <span class="dt">y =</span> y, <span class="dt">yend =</span> yend))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-51"></span>
<img src="mapas_files/figure-html/unnamed-chunk-51-1.png" alt="Mapa de vecinos, criterio Queen" width="480" />
<p class="caption">
Figura 16.16: Mapa de vecinos, criterio Queen
</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>K-nearest: Los vecindarios se generan en base la distancia entre vecinos, donde “k” se refiere al número de vecinos de una determinada locación, calculada como la distancia entre los puntos centrales de los polígonos. Se aplica usualmente cuando las áreas tienen diferentes tamaños para asegurarse que cada lugar tenga el mismo número de vecinos, independiente de cuán grande sean las áreas vecinas (Fuente: <a href="https://geodacenter.github.io/glossary.html" class="uri">https://geodacenter.github.io/glossary.html</a> ).</li>
</ol>
<p>En este caso utilizaremos a los seis vecinos más cercanos. Esto lo podemos hacer con el comando <code>knn2nb</code>. También generamos inmediatamente el dataframe:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1">kn_brasil &lt;-<span class="st"> </span><span class="kw">knn2nb</span>(<span class="kw">knearneigh</span>(coords, <span class="dt">k =</span> <span class="dv">6</span>), </a>
<a class="sourceLine" id="cb305-2" data-line-number="2">                   <span class="dt">row.names =</span> shp_brasil_datos<span class="op">$</span>estado)</a>
<a class="sourceLine" id="cb305-3" data-line-number="3">kn_brasil_df &lt;-<span class="st"> </span><span class="kw">nb_to_df</span>(kn_brasil,coords)</a></code></pre></div>
<p>Y generamos el mapa con ggplot:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb306-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_datos) <span class="op">+</span></a>
<a class="sourceLine" id="cb306-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb306-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> kn_brasil_df,</a>
<a class="sourceLine" id="cb306-4" data-line-number="4">             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))<span class="op">+</span></a>
<a class="sourceLine" id="cb306-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_segment</span>(<span class="dt">data =</span> kn_brasil_df,</a>
<a class="sourceLine" id="cb306-6" data-line-number="6">               <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">xend =</span> xend, <span class="dt">y =</span> y, <span class="dt">yend =</span> yend))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-53"></span>
<img src="mapas_files/figure-html/unnamed-chunk-53-1.png" alt="Mapa de vecinos, criterio k-nearest" width="480" />
<p class="caption">
Figura 16.17: Mapa de vecinos, criterio k-nearest
</p>
</div>
<p>Nota que si bien Rook y Queen generan, para nuestro caso, resultados similares en cuanto a la vecindad en nuestro mapa, el modelo k-nearest añade muchas más relaciones</p>
</div>
<div id="morans-i" class="section level3">
<h3><span class="header-section-number">16.7.3</span> Moran’s I</h3>
<p>El Moran’s I es la estadística más utilizada para identificar autocorrelación espacial:</p>
<p><span class="math display">\[ I = \frac{n}{\sum_{i=1}^{n}(yi - \bar{y})^2} \frac{\sum_{i=1}^{n}\sum_{j=1}^{n}wij(yi - \bar{y})(yj - \bar{y})}{\sum_{i=1}^{n}\sum_{j=1}^{n}wij}\]</span></p>
<p>Esta fórmula si bien parece compleja, no es más que una versión expandida de la fórmula para computar el coeficiente de correlación, al cual se le agrega una matriz de pesos espaciales <a href="http://rspatial.org/analysis/rst/3-spauto.html">RSpatial</a> mediante la cual se puede testear y visualizar la presencia de autocorrelación espacial.</p>
<p>Esta estadística es utilizada para realizar un test que permite evaluar la significancia de la correlación espacial. Primero, realizaremos un test a nivel global que crea una sola medida de correlación espacial. Este test de Moran creará una medida de correlación entre -1 y 1 en donde:</p>
<p>• 1 determina una correlación espacial positiva perfecta (que indica que nuestros datos están agrupados en clusters)
• 0 significa que nuestros datos están distribuidos aleatoriamente
• -1 representa autocorrelación espacial negativa (valores disímiles están cercanos entre sí).</p>
<p><img src="00-images/imagen_autocorrelacion.png" /></p>
<p>Utilizando la simulación de Monte Carlo en donde los valores son asignados aleatoriamente a los polígionos para computar el Moran’s I, lo cual es repetido varias veces para establecer una distribución de los valores esperados. Luego de esto, el valor observado del Moran’s I es comparado con la distribución simulada para ver cuán probable es que los valores observadores puedan ser considerados como aleatorios y así determinar si existe autocorrelación espacial significativa (Rspatial)</p>
<p>Para hacer el Moran’s I test utilizaremos el comando <code>moran.test</code>. La variable para la cual identificaremos su nivel de correlacion espacial es la variable de índice gini, y ocuparemos el criterio Queen. Para esto debemos generar un objeto de tipo <code>listw</code>(matriz de pesos) basado en el criterio Queen:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" data-line-number="1">queen_brasil_lw &lt;-<span class="st"> </span><span class="kw">nb2listw</span>(queen_brasil)</a></code></pre></div>
<p>Con esto podemos generar el test de Moran’s I, donde seleccionamos matriz de pesos el objeto que acabamos de crear:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb308-1" data-line-number="1"><span class="kw">moran.test</span>(shp_brasil_datos<span class="op">$</span>tasa_homicidios, <span class="dt">listw =</span> queen_brasil_lw)</a>
<a class="sourceLine" id="cb308-2" data-line-number="2"><span class="co">## </span></a>
<a class="sourceLine" id="cb308-3" data-line-number="3"><span class="co">##  Moran I test under randomisation</span></a>
<a class="sourceLine" id="cb308-4" data-line-number="4"><span class="co">## </span></a>
<a class="sourceLine" id="cb308-5" data-line-number="5"><span class="co">## data:  shp_brasil_datos$tasa_homicidios  </span></a>
<a class="sourceLine" id="cb308-6" data-line-number="6"><span class="co">## weights: queen_brasil_lw    </span></a>
<a class="sourceLine" id="cb308-7" data-line-number="7"><span class="co">## </span></a>
<a class="sourceLine" id="cb308-8" data-line-number="8"><span class="co">## Moran I statistic standard deviate = 1, p-value = 0.1</span></a>
<a class="sourceLine" id="cb308-9" data-line-number="9"><span class="co">## alternative hypothesis: greater</span></a>
<a class="sourceLine" id="cb308-10" data-line-number="10"><span class="co">## sample estimates:</span></a>
<a class="sourceLine" id="cb308-11" data-line-number="11"><span class="co">## Moran I statistic       Expectation          Variance </span></a>
<a class="sourceLine" id="cb308-12" data-line-number="12"><span class="co">##             0.113            -0.038             0.019</span></a></code></pre></div>
<p>El resultado del test de Moran’s I nos muestra que existe una leve relación de correlación positiva, versus una expectativa de una leve relación negativa. Pero el test resulta no ser significativo estadísticamente al tener un valor-p menor a una significancia del 0.05. Por ende, podemos señalar que la tasa de homicidios no presenta altos grados de autocorrelación espacial cuando estamos analizando estos datos a nivel estadual en Brasil.</p>
<p>También realizamos un scatter plot para visualizar el tipo y fuerza de la correlación espacial en la distribución de nuestros datos. Para generar el scatter plot utilizamos el comando <code>moran.test</code>:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" data-line-number="1"><span class="kw">moran.plot</span>(shp_brasil_datos<span class="op">$</span>tasa_homicidios, <span class="dt">listw =</span> queen_brasil_lw)</a></code></pre></div>
<p><img src="mapas_files/figure-html/unnamed-chunk-56-1.png" width="480" style="display: block; margin: auto;" /></p>
<p>En este mapa la curva del gráfico indica el valor del Moran’s I, es decir, la medida global de autocorrelación espacial de nuestros datos. Como ya vimos en el test anterior, esta es ligeramente positiva. El eje horizontal del gráfico muestra los datos de las tasas de homicidios a nivel estatal en Brasil y el eje vertical muestra estos mismos datos, pero laggeados espacialmente. Los cuatro cuadrantes del gráfico describen el valor de la observación en relación a sus vecinos: alta-alta, baja-baja (autocorrelación espacial positiva), baja-alta o alta-baja (correlación espacial negativa), y el gráfico también puntualiza en los valores considerados como outliers en esta relación, como el Distrito Federal o Acre. (Fuente: <a href="https://geodacenter.github.io/glossary.html" class="uri">https://geodacenter.github.io/glossary.html</a>)</p>
<p>Si bien el test de Moran nos permite identificar si es que existe clustering a nivel global, no nos permite identificar si existen clusters locales significantes en la variable que estamos analizando (Lansley &amp; Cheschire, 2016, 78). Es por esto que realizamos un test de Moran’s I a nivel local en donde se calculan los indicadores locales de asociación espacial para cada unidad de nuestros datos y se testea si es que esta relación es estadísticamente significativa, lo que nos entrega datos sobre los patrones geográficos de la relación de los datos espaciales y si existen desviaciones locales de los patrones globales de autocorrelación espacial.</p>
<p>Para hacer este test de Moran’s I utilizamos <code>localmoran</code>. Sin embargo, en esta ocasión generamos el objeto <code>listw</code> inmediatamente al interior del comando, al cual le agregamos un argumento nuevo <code>style</code>. Nota también que no realizamos el test de inmediato, sino que generamos un objeto con él, el cual después utilizaremos para mapear la correlación espacial:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb310-1" data-line-number="1">lmoran_brasil &lt;-<span class="st"> </span><span class="kw">localmoran</span>(<span class="dt">x =</span> shp_brasil_datos<span class="op">$</span>gini,</a>
<a class="sourceLine" id="cb310-2" data-line-number="2">           <span class="dt">listw =</span> <span class="kw">nb2listw</span>(queen_brasil, <span class="dt">style =</span> <span class="st">&quot;B&quot;</span>))</a></code></pre></div>
<p>Una vez obtenidos estos datos para cada polígono, podemos mapearlos para indicar cómo varía la correlación espacial en las zonas que estamos estudiando. Primero unimos los resultados a nuestro shapefile:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" data-line-number="1">mapa_moran &lt;-<span class="st"> </span><span class="kw">cbind</span>(shp_brasil_datos, lmoran_brasil)</a></code></pre></div>
<p>A continuación podemos mapear los resultados con <code>ggplot</code>:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb312-1" data-line-number="1"><span class="kw">ggplot</span>(mapa_moran)<span class="op">+</span></a>
<a class="sourceLine" id="cb312-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> Ii))<span class="op">+</span></a>
<a class="sourceLine" id="cb312-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Estadísitico Moran Local&quot;</span>)</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-59"></span>
<img src="mapas_files/figure-html/unnamed-chunk-59-1.png" alt="Moran's I a nivel local para distintos valores de Gini" width="480" />
<p class="caption">
Figura 16.18: Moran’s I a nivel local para distintos valores de Gini
</p>
</div>
<p>Este mapa nos permite observar la variación en la autocorrelación a lo largo del espacio, pero no es posible identificar si los patrones geográficos de autocorrelación son clusters con valores altos o bajos, lo que nos permitirá analizar el tipo de autocorrelación espacial que existe y su nivel de significancia. Para esto debemos crear un mapa de clusters LISA, que creará una etiqueta basada en los tipos de relación que se comparte con sus vecinos (alta-alta, baja-alta, insignificante, etc) en relación a los valores de la variable que estamos analizando (Gini).</p>
<p>Para poder realizar esto, primero se deben realizar una serie de transformaciones que detallamos a continuación:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" data-line-number="1"><span class="co">#Genera el mapa de cluster LISA</span></a>
<a class="sourceLine" id="cb313-2" data-line-number="2">cuadrante &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="dt">mode=</span><span class="st">&quot;numeric&quot;</span>,<span class="dt">length=</span><span class="kw">nrow</span>(lmoran_brasil)) </a>
<a class="sourceLine" id="cb313-3" data-line-number="3"></a>
<a class="sourceLine" id="cb313-4" data-line-number="4"><span class="co">#Centra la variable de interés en su media</span></a>
<a class="sourceLine" id="cb313-5" data-line-number="5">m_gini&lt;-<span class="st"> </span>shp_brasil_datos<span class="op">$</span>gini <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(shp_brasil_datos<span class="op">$</span>gini)</a>
<a class="sourceLine" id="cb313-6" data-line-number="6"></a>
<a class="sourceLine" id="cb313-7" data-line-number="7"><span class="co">#Centra el Moran&#39;s local en la media</span></a>
<a class="sourceLine" id="cb313-8" data-line-number="8">m_lmoran &lt;-<span class="st"> </span>lmoran_brasil[,<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(lmoran_brasil[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb313-9" data-line-number="9"></a>
<a class="sourceLine" id="cb313-10" data-line-number="10"><span class="co">#Umbral de significancia</span></a>
<a class="sourceLine" id="cb313-11" data-line-number="11">signif &lt;-<span class="st"> </span><span class="fl">0.1</span></a>
<a class="sourceLine" id="cb313-12" data-line-number="12"></a>
<a class="sourceLine" id="cb313-13" data-line-number="13"><span class="co">#Crea el cuadrante de datos</span></a>
<a class="sourceLine" id="cb313-14" data-line-number="14">cuadrante[m_gini <span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>m_lmoran<span class="op">&gt;</span><span class="dv">0</span>] &lt;-<span class="st"> &quot;Alto-Alto&quot;</span></a>
<a class="sourceLine" id="cb313-15" data-line-number="15">cuadrante[m_gini <span class="op">&lt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>m_lmoran<span class="op">&lt;</span><span class="dv">0</span>] &lt;-<span class="st"> &quot;Bajo-Bajo&quot;</span></a>
<a class="sourceLine" id="cb313-16" data-line-number="16">cuadrante[m_gini <span class="op">&lt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>m_lmoran<span class="op">&gt;</span><span class="dv">0</span>] &lt;-<span class="st"> &quot;Bajo-Alto&quot;</span></a>
<a class="sourceLine" id="cb313-17" data-line-number="17">cuadrante[m_gini <span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>m_lmoran<span class="op">&lt;</span><span class="dv">0</span>] &lt;-<span class="st"> &quot;Alto-Bajo&quot;</span></a>
<a class="sourceLine" id="cb313-18" data-line-number="18">cuadrante[lmoran_brasil[,<span class="dv">5</span>]<span class="op">&gt;</span>signif] &lt;-<span class="st"> &quot;Insignificante&quot;</span></a></code></pre></div>
<p>A continuación podemos generar el gráfico con <code>ggplot</code>. Nota que utilizamos `scale_fill_manual&quot; para cambiar los colores de modo que reflejen la intensidad de la autocorrelación:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb314-1" data-line-number="1"><span class="kw">ggplot</span>(shp_brasil_datos, <span class="kw">aes</span>(<span class="dt">fill =</span> cuadrante))<span class="op">+</span></a>
<a class="sourceLine" id="cb314-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb314-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">fill =</span> <span class="st">&quot;Cuadrante&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb314-4" data-line-number="4"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;lightblue&quot;</span>, <span class="st">&quot;white&quot;</span>))</a></code></pre></div>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-61"></span>
<img src="mapas_files/figure-html/unnamed-chunk-61-1.png" alt="Patrones Geográficos de Clusterización para distintos valores de Gini" width="480" />
<p class="caption">
Figura 16.19: Patrones Geográficos de Clusterización para distintos valores de Gini
</p>
</div>
<p>Este mapa nos entrega una mayor información sobre los patrones geográficos de autocorrelación espacial. Este mapa nos muestra si es que existen clusters, es decir, regiones en donde en su núcleo existe autocorrelación espacial positiva, por ende, nos muestra regiones clusterizadas más que lugares individuales. Es importante señalar que estos mapas no son significativos, sino que nos permiten encontrar lugares o relaciones que pueden ser interesantes para un análisis posterior.</p>
<p>Podemos interpretar en este caso que en la mayor parte de Brasil, existe una correlación espacial insignificante para los valores de Gini, es decir, su valor no está influenciado por la proximidad de otros valores similares. Sin embargo, en algunos estados del noreste de Brasil podemos observar que existe un clusters en donde se concentran altos valores de Gini que tienen vecinos también con altos valores en esa misma variable (<em>hot spots</em>), indicando que esas regiones contribuyen significativamente hacia una autocorrelación espacial positiva a nivel global. Por otro lado, en los estados que están coloreados con celeste encontramos clusters que concentran valores bajos de Gini en donde sus vecinos poseen altos valores de la misma variable y, por ende, contribuyen significativamente a una autocorrelación espacial negativa a nivel global (ya que esta está ocurre cuando valores disímiles son próximos entre sí).</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="qta.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["adp-bookdown.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
