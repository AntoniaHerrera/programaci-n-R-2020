<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>analizaR datos políticos</title>
  <meta name="description" content="Proyecto de libro">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="analizaR datos políticos" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Proyecto de libro" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="analizaR datos políticos" />
  
  <meta name="twitter:description" content="Proyecto de libro" />
  

<meta name="author" content="Francisco Urdinez y Andrés Cruz">


<meta name="date" content="2017-12-27">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
<link rel="prev" href="rbas.html">
<link rel="next" href="bin.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><b><a href="./index.html">analizaR datos políticos</a></b></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Inicio</a></li>
<li class="chapter" data-level="1" data-path="prefacio.html"><a href="prefacio.html"><i class="fa fa-check"></i><b>1</b> Prefacio</a><ul>
<li class="chapter" data-level="1.1" data-path="prefacio.html"><a href="prefacio.html#agradecimientos"><i class="fa fa-check"></i><b>1.1</b> Agradecimientos</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduccion.html"><a href="introduccion.html"><i class="fa fa-check"></i><b>2</b> Introducción</a><ul>
<li class="chapter" data-level="2.1" data-path="introduccion.html"><a href="introduccion.html#organizacion-del-libro"><i class="fa fa-check"></i><b>2.1</b> Organización del libro</a></li>
<li class="chapter" data-level="2.2" data-path="introduccion.html"><a href="introduccion.html#prerrequisitos"><i class="fa fa-check"></i><b>2.2</b> Prerrequisitos</a></li>
</ul></li>
<li class="part"><span><b>I Manejo de datos</b></span></li>
<li class="chapter" data-level="3" data-path="rbas.html"><a href="rbas.html"><i class="fa fa-check"></i><b>3</b> R básico</a><ul>
<li class="chapter" data-level="3.1" data-path="rbas.html"><a href="rbas.html#instalacion"><i class="fa fa-check"></i><b>3.1</b> Instalación</a><ul>
<li class="chapter" data-level="3.1.1" data-path="rbas.html"><a href="rbas.html#r"><i class="fa fa-check"></i><b>3.1.1</b> R</a></li>
<li class="chapter" data-level="3.1.2" data-path="rbas.html"><a href="rbas.html#rstudio"><i class="fa fa-check"></i><b>3.1.2</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="rbas.html"><a href="rbas.html#partes-de-rstudio"><i class="fa fa-check"></i><b>3.2</b> Partes de RStudio</a><ul>
<li class="chapter" data-level="3.2.1" data-path="rbas.html"><a href="rbas.html#consola"><i class="fa fa-check"></i><b>3.2.1</b> Consola</a></li>
<li class="chapter" data-level="3.2.2" data-path="rbas.html"><a href="rbas.html#script"><i class="fa fa-check"></i><b>3.2.2</b> Script</a></li>
<li class="chapter" data-level="3.2.3" data-path="rbas.html"><a href="rbas.html#objetos"><i class="fa fa-check"></i><b>3.2.3</b> Objetos</a></li>
<li class="chapter" data-level="3.2.4" data-path="rbas.html"><a href="rbas.html#archivos-graficos-paquetes-ayuda"><i class="fa fa-check"></i><b>3.2.4</b> Archivos / gráficos / paquetes / ayuda</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="rbas.html"><a href="rbas.html#ejercicios"><i class="fa fa-check"></i><b>3.3</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="manejo.html"><a href="manejo.html"><i class="fa fa-check"></i><b>4</b> Manejo</a><ul>
<li class="chapter" data-level="4.1" data-path="manejo.html"><a href="manejo.html#nuestra-base-de-datos"><i class="fa fa-check"></i><b>4.1</b> Nuestra base de datos</a></li>
<li class="chapter" data-level="4.2" data-path="manejo.html"><a href="manejo.html#describir-la-base"><i class="fa fa-check"></i><b>4.2</b> Describir la base</a></li>
<li class="chapter" data-level="4.3" data-path="manejo.html"><a href="manejo.html#ordenar-la-base-con-arrange"><i class="fa fa-check"></i><b>4.3</b> Ordenar la base con <code>arrange()</code></a></li>
<li class="chapter" data-level="4.4" data-path="manejo.html"><a href="manejo.html#seleccionar-columnas-de-la-base-con-select"><i class="fa fa-check"></i><b>4.4</b> Seleccionar columnas de la base con <code>select()</code></a></li>
<li class="chapter" data-level="4.5" data-path="manejo.html"><a href="manejo.html#renombrar-columnas-de-la-base-con-rename"><i class="fa fa-check"></i><b>4.5</b> Renombrar columnas de la base con <code>rename()</code></a></li>
<li class="chapter" data-level="4.6" data-path="manejo.html"><a href="manejo.html#filtrar-observaciones-de-la-base-con-filter"><i class="fa fa-check"></i><b>4.6</b> Filtrar observaciones de la base con <code>filter()</code></a></li>
<li class="chapter" data-level="4.7" data-path="manejo.html"><a href="manejo.html#crear-nuevas-variables-en-la-base-con-mutate"><i class="fa fa-check"></i><b>4.7</b> Crear nuevas variables en la base con <code>mutate()</code></a></li>
<li class="chapter" data-level="4.8" data-path="manejo.html"><a href="manejo.html#concatenar-comandos-las-pipes"><i class="fa fa-check"></i><b>4.8</b> Concatenar comandos: las pipes (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="4.9" data-path="manejo.html"><a href="manejo.html#ejercicios-1"><i class="fa fa-check"></i><b>4.9</b> Ejercicios</a></li>
</ul></li>
<li class="part"><span><b>II Modelos</b></span></li>
<li class="chapter" data-level="5" data-path="bin.html"><a href="bin.html"><i class="fa fa-check"></i><b>5</b> Modelos binarios</a><ul>
<li class="chapter" data-level="5.1" data-path="bin.html"><a href="bin.html#conceptos-principales"><i class="fa fa-check"></i><b>5.1</b> Conceptos principales</a></li>
<li class="chapter" data-level="5.2" data-path="bin.html"><a href="bin.html#aplicacion-en-r"><i class="fa fa-check"></i><b>5.2</b> Aplicación en R</a></li>
<li class="chapter" data-level="5.3" data-path="bin.html"><a href="bin.html#estimar-los-modelos"><i class="fa fa-check"></i><b>5.3</b> Estimar los modelos</a></li>
<li class="chapter" data-level="5.4" data-path="bin.html"><a href="bin.html#visualizacion-de-resultados"><i class="fa fa-check"></i><b>5.4</b> Visualización de resultados</a></li>
<li class="chapter" data-level="5.5" data-path="bin.html"><a href="bin.html#ajuste-de-los-modelos"><i class="fa fa-check"></i><b>5.5</b> Ajuste de los modelos</a></li>
<li class="chapter" data-level="5.6" data-path="bin.html"><a href="bin.html#bondad-de-ajuste"><i class="fa fa-check"></i><b>5.6</b> Bondad de ajuste</a><ul>
<li class="chapter" data-level="5.6.1" data-path="bin.html"><a href="bin.html#pseudo-r2"><i class="fa fa-check"></i><b>5.6.1</b> <span class="math inline">\(Pseudo-R^2\)</span></a></li>
<li class="chapter" data-level="5.6.2" data-path="bin.html"><a href="bin.html#aic"><i class="fa fa-check"></i><b>5.6.2</b> AIC</a></li>
<li class="chapter" data-level="5.6.3" data-path="bin.html"><a href="bin.html#bic"><i class="fa fa-check"></i><b>5.6.3</b> BIC</a></li>
<li class="chapter" data-level="5.6.4" data-path="bin.html"><a href="bin.html#brier-score"><i class="fa fa-check"></i><b>5.6.4</b> Brier Score</a></li>
<li class="chapter" data-level="5.6.5" data-path="bin.html"><a href="bin.html#porcentaje-de-predicciones-correctas"><i class="fa fa-check"></i><b>5.6.5</b> Porcentaje de predicciones correctas</a></li>
<li class="chapter" data-level="5.6.6" data-path="bin.html"><a href="bin.html#roc-plot"><i class="fa fa-check"></i><b>5.6.6</b> ROC plot</a></li>
<li class="chapter" data-level="5.6.7" data-path="bin.html"><a href="bin.html#separation-plots"><i class="fa fa-check"></i><b>5.6.7</b> Separation plots</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="surv.html"><a href="surv.html"><i class="fa fa-check"></i><b>6</b> Modelos de supervivencia</a><ul>
<li class="chapter" data-level="6.1" data-path="surv.html"><a href="surv.html#el-modelo-cox-de-riesgos-proporcionales"><i class="fa fa-check"></i><b>6.1</b> El modelo Cox de riesgos proporcionales:</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="creditos.html"><a href="creditos.html"><i class="fa fa-check"></i>Créditos</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">analizaR datos políticos</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manejo" class="section level1">
<h1><span class="header-section-number">Capítulo 4</span> Manejo</h1>
<p><strong>F: EN GENERAL YO METERIA MAS SUB-SUBTITULOS, CASI UNO POR FUNCION. POR EJ, UNO PARA ARRANGE (4.3.1), OTRO PARA SELECT (4.4.1)… O AL LADO DEL TITULO PONDRIA LA FUNCION: 4.4. SELECCIONAR COLUMNAS CON </strong>‘SELECT’*****</p>
<p>Cuando hablamos de análisis de datos, casi siempre nos referimos a análisis de <em>bases de datos</em>. Aunque hay varios formatos de bases de datos disponibles, en ciencias sociales generalmente usamos y creamos <em>bases de datos tabulares</em>, que son las que este libro tratará. Muy probablemente el lector estará familiarizado con la estructura básica de este tipo de bases, gracias a las planillas de Microsoft Excel, Google Spreadsheets y/o LibreOffice Calc. La primera fila suele ser un <strong>header</strong> o encabezado, que indica qué datos registran las celdas de esa columna. En general, queremos que nuestras bases de datos tabulares tengan una estructura <em>tidy</em>, como la siguiente:</p>
<p><img src="http://garrettgman.github.io/images/tidy-4.png" alt="Tidy Data" /> (traducir!)</p>
<p>La idea de una base <em>tidy</em> es simple: cada columna es una variable, cada fila una observación (de acuerdo a la unidad de análisis) y, por lo tanto, cada celda es una observación. <em>(explicar que este nombre lo tomamos del dios Wickham y que es una idea tan simple que mucha gente no la va a entender. Quien solo ha trabajado con Stata o Excel nunca vio datos no-tidy)</em></p>
<div id="nuestra-base-de-datos" class="section level2">
<h2><span class="header-section-number">4.1</span> Nuestra base de datos</h2>
<p>Para este capítulo usaremos una sección de la base de datos de <em>Quality of Government</em>(QoG, 2017)[<a href="https://qog.pol.gu.se" class="uri">https://qog.pol.gu.se</a>], un proyecto que registra diversos datos de países. Sus primeras observaciones son las siguientes:</p>
<table>
<thead>
<tr class="header">
<th align="left">cname</th>
<th align="right">wdi_gdppppcon2011</th>
<th align="right">wdi_pop</th>
<th align="right">ti_cpi</th>
<th align="right">lp_muslim80</th>
<th align="right">fh_ipolity2</th>
<th align="left">region</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Afghanistan</td>
<td align="right">5.8e+10</td>
<td align="right">3.1e+07</td>
<td align="right">8</td>
<td align="right">99.3</td>
<td align="right">2.0</td>
<td align="left">Southern Asia</td>
</tr>
<tr class="even">
<td align="left">Albania</td>
<td align="right">2.9e+10</td>
<td align="right">2.9e+06</td>
<td align="right">31</td>
<td align="right">20.5</td>
<td align="right">8.1</td>
<td align="left">Southern Europe</td>
</tr>
<tr class="odd">
<td align="left">Algeria</td>
<td align="right">5.1e+11</td>
<td align="right">3.8e+07</td>
<td align="right">36</td>
<td align="right">99.1</td>
<td align="right">4.2</td>
<td align="left">Northern Africa</td>
</tr>
<tr class="even">
<td align="left">Angola</td>
<td align="right">1.5e+11</td>
<td align="right">2.3e+07</td>
<td align="right">23</td>
<td align="right">0.0</td>
<td align="right">3.2</td>
<td align="left">Middle Africa</td>
</tr>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">9.9e+11</td>
<td align="right">2.3e+07</td>
<td align="right">81</td>
<td align="right">0.2</td>
<td align="right">10.0</td>
<td align="left">Australia and New Zealand</td>
</tr>
<tr class="even">
<td align="left">Austria</td>
<td align="right">3.7e+11</td>
<td align="right">8.5e+06</td>
<td align="right">69</td>
<td align="right">0.6</td>
<td align="right">10.0</td>
<td align="left">Western Europe</td>
</tr>
</tbody>
</table>
<p>Las variables son las siguientes:</p>
<table>
<colgroup>
<col width="17%" />
<col width="82%" />
</colgroup>
<thead>
<tr class="header">
<th>variable</th>
<th>descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>cname</td>
<td>Nombre del país</td>
</tr>
<tr class="even">
<td>wdi_gdppppcon2011</td>
<td>GDP PPP, en dólares del 2011, según los datos de WDI (p. 635 del codebook)</td>
</tr>
<tr class="odd">
<td>wdi_pop</td>
<td>Población, según los datos de WDI (p. 665)</td>
</tr>
<tr class="even">
<td>ti_cpi</td>
<td>Índice de Percepción de la Corrupción de TI. Va de 0 a 100, con 0 lo más corrupto (p. 560)</td>
</tr>
<tr class="odd">
<td>lp_muslim80</td>
<td>Porcentaje de población de religión musulmana, para 1980, según LP (p. 447)</td>
</tr>
<tr class="even">
<td>fh_ipolity2</td>
<td>Nivel de democracia según FH. Va de 0 a 10, con 0 como menos democrático (p. 291)</td>
</tr>
<tr class="odd">
<td>region</td>
<td>Región del país, según WDI (añadida a la base)</td>
</tr>
</tbody>
</table>
<p>Para comenzar a trabajar carguemos el paquete <code>tidyverse</code>, uno de los centrales del libro, que nos dará funciones útiles para trabajar con nuestra base datos.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>Ahora carguemos la base de datos a nuestro ambiente de trabajo en R. Vamos a llamarla “qog_mod” (QoG modificada). El archivo está en formato .csv, por lo que utilizaremos la función del tidyverse <code>read_csv()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;00-datos/04_qog_mod.csv&quot;</span>)
## Parsed with column specification:
## cols(
##   cname = col_character(),
##   wdi_gdppppcon2011 = col_double(),
##   wdi_pop = col_integer(),
##   ti_cpi = col_double(),
##   lp_muslim80 = col_double(),
##   fh_ipolity2 = col_double(),
##   region = col_character()
## )</code></pre></div>
<p>(hay que decidir cómo se va a hacer esto: desde carpeta local, url, paquete, etc.) <em>(F:opino que creemos un url del libro y usemos los html, en el paquete ADP solo pondria funciones)</em></p>
</div>
<div id="describir-la-base" class="section level2">
<h2><span class="header-section-number">4.2</span> Describir la base</h2>
<p>(aquí podría ir <code>describe_all()</code> u otra función de descripción de la base, habría que decidir si esto tiene sentido en términos pedagógicos; otra opción es hacer otro capítulo con <code>group_by()</code>, <code>tabyl()</code>, <code>crosstab()</code>, etc; me inclino por esta última opción)</p>
<p>Para aproximarnos a nuestra base recién cargada tenemos varias opciones. Podemos, como antes, simplemente usar su nombre como un comando para un resumen rápido:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod
## # A tibble: 139 x 7
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8        99.3        2.02
##  2     Albania           2.9e+10   2897366     31        20.5        8.08
##  3     Algeria           5.1e+11  38186136     36        99.1        4.25
##  4      Angola           1.5e+11  23448202     23         0.0        3.25
##  5   Australia           9.9e+11  23125868     81         0.2       10.00
##  6     Austria           3.7e+11   8479375     69         0.6       10.00
##  7     Bahamas           8.5e+09    377841     71         0.0       10.00
##  8     Bahrain           5.7e+10   1349427     48        95.0        0.83
##  9  Bangladesh           4.5e+11 157157392     27        85.9        6.42
## 10    Barbados           4.3e+09    282503     75         0.2       10.00
## # ... with 129 more rows, and 1 more variables: region &lt;chr&gt;</code></pre></div>
<p>También podemos utilizar la función <code>glimpse()</code> para tener un resumen desde otra perspectiva:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(qog_mod)
## Observations: 139
## Variables: 7
## $ cname             &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Albania&quot;, &quot;Algeria&quot;, &quot;Angola...
## $ wdi_gdppppcon2011 &lt;dbl&gt; 5.8e+10, 2.9e+10, 5.1e+11, 1.5e+11, 9.9e+11,...
## $ wdi_pop           &lt;int&gt; 30682500, 2897366, 38186136, 23448202, 23125...
## $ ti_cpi            &lt;dbl&gt; 8, 31, 36, 23, 81, 69, 71, 48, 27, 75, 75, 6...
## $ lp_muslim80       &lt;dbl&gt; 99.3, 20.5, 99.1, 0.0, 0.2, 0.6, 0.0, 95.0, ...
## $ fh_ipolity2       &lt;dbl&gt; 2.02, 8.08, 4.25, 3.25, 10.00, 10.00, 10.00,...
## $ region            &lt;chr&gt; &quot;Southern Asia&quot;, &quot;Southern Europe&quot;, &quot;Norther...</code></pre></div>
<p>Una alternativa que nos permite ver la base completa es la función <code>View()</code>, análoga a clickear nuestro objeto en la pestaña “Environment” de Rstudio:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(qog_mod)</code></pre></div>
</div>
<div id="ordenar-la-base-con-arrange" class="section level2">
<h2><span class="header-section-number">4.3</span> Ordenar la base con <code>arrange()</code></h2>
<p>Una de las operaciones más comunes con bases de datos es ordenarlas de acuerdo a alguna de las variables. Esto nos puede dar insights (¿traducción?) inmediatos sobre nuestras observaciones. Por ejemplo, ordenemos la base de acuerdo a población:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(qog_mod, wdi_pop)
## # A tibble: 139 x 7
##                    cname wdi_gdppppcon2011 wdi_pop ti_cpi lp_muslim80
##                    &lt;chr&gt;             &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1              Dominica           7.2e+08   72005     58         0.0
##  2            Seychelles           2.2e+09   89900     54         0.3
##  3                 Tonga           5.1e+08  105139     31         0.0
##  4              Kiribati           1.8e+08  108544     31         0.0
##  5              St Lucia           1.9e+09  182305     71         0.0
##  6 Sao Tome and Principe           5.4e+08  182386     42         0.0
##  7                 Samoa           1.0e+09  190390     52         0.0
##  8              Barbados           4.3e+09  282503     75         0.2
##  9               Iceland           1.3e+10  323764     78         0.0
## 10               Bahamas           8.5e+09  377841     71         0.0
## # ... with 129 more rows, and 2 more variables: fh_ipolity2 &lt;dbl&gt;,
## #   region &lt;chr&gt;</code></pre></div>
<p>El lector debe notar cómo el primer argumento, “qog_mod”, toma la base de datos y los siguientes enuncian <strong>cómo</strong> ordenarla, en este caso, por “wdi_pop”, la variable de población.</p>
<p>Debe notar también cómo el comando anterior no crea ningún objeto, solo muestra los resultados en la consola. Para crear uno tenemos que seguir la fórmula típica de asignación:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod_ordenada &lt;-<span class="st"> </span><span class="kw">arrange</span>(qog_mod, wdi_pop)</code></pre></div>
<p>Podemos realizar ambas operaciones, mostrar los resultados y crear el objeto, rodeando este último comando con paréntesis:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">( qog_mod_ordenada &lt;-<span class="st"> </span><span class="kw">arrange</span>(qog_mod, wdi_pop) )
## # A tibble: 139 x 7
##                    cname wdi_gdppppcon2011 wdi_pop ti_cpi lp_muslim80
##                    &lt;chr&gt;             &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1              Dominica           7.2e+08   72005     58         0.0
##  2            Seychelles           2.2e+09   89900     54         0.3
##  3                 Tonga           5.1e+08  105139     31         0.0
##  4              Kiribati           1.8e+08  108544     31         0.0
##  5              St Lucia           1.9e+09  182305     71         0.0
##  6 Sao Tome and Principe           5.4e+08  182386     42         0.0
##  7                 Samoa           1.0e+09  190390     52         0.0
##  8              Barbados           4.3e+09  282503     75         0.2
##  9               Iceland           1.3e+10  323764     78         0.0
## 10               Bahamas           8.5e+09  377841     71         0.0
## # ... with 129 more rows, and 2 more variables: fh_ipolity2 &lt;dbl&gt;,
## #   region &lt;chr&gt;</code></pre></div>
<p>La operación para ordenar realizada antes iba de menor a mayor, en términos de población. Si queremos el orden inverso (decreciente), basta con añadir un signo menos (-) antes de la variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(qog_mod, <span class="op">-</span>wdi_pop)
## # A tibble: 139 x 7
##               cname wdi_gdppppcon2011    wdi_pop ti_cpi lp_muslim80
##               &lt;chr&gt;             &lt;dbl&gt;      &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1            China           1.6e+13 1357379968     40         2.4
##  2            India           6.6e+12 1279498880     36        11.6
##  3    United States           1.6e+13  316497536     73         0.8
##  4        Indonesia           2.4e+12  251268272     32        43.4
##  5           Brazil           3.1e+12  204259376     42         0.1
##  6 Pakistan (1971-)           8.1e+11  181192640     28        96.8
##  7          Nigeria           9.4e+11  172816512     25        45.0
##  8       Bangladesh           4.5e+11  157157392     27        85.9
##  9            Japan           4.5e+12  127338624     74         0.0
## 10           Mexico           2.0e+12  123740112     34         0.0
## # ... with 129 more rows, and 2 more variables: fh_ipolity2 &lt;dbl&gt;,
## #   region &lt;chr&gt;</code></pre></div>
<p>¡Con eso tenemos los países con mayor población en el mundo! ¿Qué pasa si queremos los países con mayor población <strong>dentro de cada región</strong>? Tendríamos que realizar un ordenamiento en dos pasos: primero por región y luego por población. Con <code>arrange()</code> esto es simple:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(qog_mod, region, <span class="op">-</span>wdi_pop)
## # A tibble: 139 x 7
##                  cname wdi_gdppppcon2011  wdi_pop ti_cpi lp_muslim80
##                  &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1           Australia           9.9e+11 23125868     81         0.2
##  2         New Zealand           1.5e+11  4442100     91         0.0
##  3                Cuba           2.3e+11 11362505     46         0.0
##  4               Haiti           1.7e+10 10431249     19         0.0
##  5  Dominican Republic           1.2e+11 10281408     29         0.0
##  6             Jamaica           2.3e+10  2714734     38         0.1
##  7 Trinidad and Tobago           4.1e+10  1348240     38         6.5
##  8             Bahamas           8.5e+09   377841     71         0.0
##  9            Barbados           4.3e+09   282503     75         0.2
## 10            St Lucia           1.9e+09   182305     71         0.0
## # ... with 129 more rows, and 2 more variables: fh_ipolity2 &lt;dbl&gt;,
## #   region &lt;chr&gt;</code></pre></div>
<p>A propósito del resultado anterior, el lector puede deducir que cuando <code>arrange()</code> ordena variables categóricas (en vez de numéricas) lo hace alfabéticamente. Añadir un signo menos (-) antes de la variable hará que el orden sea al revés en términos del alfabeto:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(qog_mod, <span class="kw">desc</span>(region), <span class="op">-</span>wdi_pop) <span class="co"># no sé por qué - no funciona, ARREGLAR</span>
## # A tibble: 139 x 7
##                   cname wdi_gdppppcon2011  wdi_pop ti_cpi lp_muslim80
##                   &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1       France (1963-)           2.5e+12 65925496     71         3.0
##  2          Netherlands           7.6e+11 16804432     83         1.0
##  3              Belgium           4.5e+11 11182817     75         1.1
##  4              Austria           3.7e+11  8479375     69         0.6
##  5          Switzerland           4.4e+11  8089346     85         0.3
##  6           Luxembourg           4.9e+10   543360     80         0.0
##  7               Turkey           1.4e+12 75010200     50        99.2
##  8                 Iraq           5.1e+11 33781384     16        95.8
##  9         Saudi Arabia           1.5e+12 30201052     46        98.8
## 10 United Arab Emirates           5.6e+11  9039978     69        94.9
## # ... with 129 more rows, and 2 more variables: fh_ipolity2 &lt;dbl&gt;,
## #   region &lt;chr&gt;</code></pre></div>
</div>
<div id="seleccionar-columnas-de-la-base-con-select" class="section level2">
<h2><span class="header-section-number">4.4</span> Seleccionar columnas de la base con <code>select()</code></h2>
<p>A veces queremos trabajar solo con algunas variables de una base de datos. Para esto existe la función <code>select()</code>. Pensemos que queremos solo el nombre de cada país (cname) y su porcentaje de población musulmana para 1980:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(qog_mod, cname, lp_muslim80)
## # A tibble: 139 x 2
##          cname lp_muslim80
##          &lt;chr&gt;       &lt;dbl&gt;
##  1 Afghanistan        99.3
##  2     Albania        20.5
##  3     Algeria        99.1
##  4      Angola         0.0
##  5   Australia         0.2
##  6     Austria         0.6
##  7     Bahamas         0.0
##  8     Bahrain        95.0
##  9  Bangladesh        85.9
## 10    Barbados         0.2
## # ... with 129 more rows</code></pre></div>
<p>Al igual que para <code>arrange()</code>, aquí el primer argumento designa la base a modificar y los demás cómo se debería hacer eso -en este caso, qué variables deben ser seleccionadas.</p>
<p>Añadir un signo menos (-) aquí indica qué variables <em>no</em> seleccionar. Por ejemplo, quitemos el porcentaje de población musulmana para 1980 de la base:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(qog_mod, <span class="op">-</span>lp_muslim80)
## # A tibble: 139 x 6
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi fh_ipolity2
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8        2.02
##  2     Albania           2.9e+10   2897366     31        8.08
##  3     Algeria           5.1e+11  38186136     36        4.25
##  4      Angola           1.5e+11  23448202     23        3.25
##  5   Australia           9.9e+11  23125868     81       10.00
##  6     Austria           3.7e+11   8479375     69       10.00
##  7     Bahamas           8.5e+09    377841     71       10.00
##  8     Bahrain           5.7e+10   1349427     48        0.83
##  9  Bangladesh           4.5e+11 157157392     27        6.42
## 10    Barbados           4.3e+09    282503     75       10.00
## # ... with 129 more rows, and 1 more variables: region &lt;chr&gt;</code></pre></div>
<p>Aparte de seleccionar variables específicas, <code>select()</code> es capaz de entender referencias a intervalos de variables. Por ejemplo, podemos querer las cuatro primeras variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(qog_mod, cname<span class="op">:</span>ti_cpi)
## # A tibble: 139 x 4
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8
##  2     Albania           2.9e+10   2897366     31
##  3     Algeria           5.1e+11  38186136     36
##  4      Angola           1.5e+11  23448202     23
##  5   Australia           9.9e+11  23125868     81
##  6     Austria           3.7e+11   8479375     69
##  7     Bahamas           8.5e+09    377841     71
##  8     Bahrain           5.7e+10   1349427     48
##  9  Bangladesh           4.5e+11 157157392     27
## 10    Barbados           4.3e+09    282503     75
## # ... with 129 more rows
<span class="kw">select</span>(qog_mod, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) <span class="co"># lo mismo, aunque no recomendado</span>
## # A tibble: 139 x 4
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8
##  2     Albania           2.9e+10   2897366     31
##  3     Algeria           5.1e+11  38186136     36
##  4      Angola           1.5e+11  23448202     23
##  5   Australia           9.9e+11  23125868     81
##  6     Austria           3.7e+11   8479375     69
##  7     Bahamas           8.5e+09    377841     71
##  8     Bahrain           5.7e+10   1349427     48
##  9  Bangladesh           4.5e+11 157157392     27
## 10    Barbados           4.3e+09    282503     75
## # ... with 129 more rows</code></pre></div>
<p>Otra herramienta para complejizar nuestra selección se encuentra en las funciones de ayuda. Entre ellas, <code>starts_with</code> es de particular utilidad, permitiendo seleccionar variables que empiecen con cierto patrón. Por ejemplo, podríamos querer, a partir del nombre del país, todas las variables que provengan de los World Development Indicators (WDI) del Banco Mundial:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(qog_mod, cname, <span class="kw">starts_with</span>(<span class="st">&quot;wdi_&quot;</span>))
## # A tibble: 139 x 3
##          cname wdi_gdppppcon2011   wdi_pop
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;
##  1 Afghanistan           5.8e+10  30682500
##  2     Albania           2.9e+10   2897366
##  3     Algeria           5.1e+11  38186136
##  4      Angola           1.5e+11  23448202
##  5   Australia           9.9e+11  23125868
##  6     Austria           3.7e+11   8479375
##  7     Bahamas           8.5e+09    377841
##  8     Bahrain           5.7e+10   1349427
##  9  Bangladesh           4.5e+11 157157392
## 10    Barbados           4.3e+09    282503
## # ... with 129 more rows</code></pre></div>
<p>Otra función de ayuda útil es <code>everything()</code>, que se lee como “todas las demás variables”. Es especialmente útil para cambiar el orden de las variables en una bases de datos. Por ejemplo, pasemos región al segundo lugar entre las variables:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(qog_mod, cname, region, <span class="kw">everything</span>())
## # A tibble: 139 x 7
##          cname                    region wdi_gdppppcon2011   wdi_pop
##          &lt;chr&gt;                     &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;
##  1 Afghanistan             Southern Asia           5.8e+10  30682500
##  2     Albania           Southern Europe           2.9e+10   2897366
##  3     Algeria           Northern Africa           5.1e+11  38186136
##  4      Angola             Middle Africa           1.5e+11  23448202
##  5   Australia Australia and New Zealand           9.9e+11  23125868
##  6     Austria            Western Europe           3.7e+11   8479375
##  7     Bahamas                 Caribbean           8.5e+09    377841
##  8     Bahrain              Western Asia           5.7e+10   1349427
##  9  Bangladesh             Southern Asia           4.5e+11 157157392
## 10    Barbados                 Caribbean           4.3e+09    282503
## # ... with 129 more rows, and 3 more variables: ti_cpi &lt;dbl&gt;,
## #   lp_muslim80 &lt;dbl&gt;, fh_ipolity2 &lt;dbl&gt;</code></pre></div>
</div>
<div id="renombrar-columnas-de-la-base-con-rename" class="section level2">
<h2><span class="header-section-number">4.5</span> Renombrar columnas de la base con <code>rename()</code></h2>
<p>La notación para el GDP es un poco confusa. ¿Y si queremos cambiar el nombre de la variable? Aprovechemos también de cambiar el nombre de la variable de identificación por país.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rename</span>(qog_mod, <span class="dt">wdi_gdp =</span> wdi_gdppppcon2011, <span class="dt">country_name =</span> cname)
## # A tibble: 139 x 7
##    country_name wdi_gdp   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##           &lt;chr&gt;   &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1  Afghanistan 5.8e+10  30682500      8        99.3        2.02
##  2      Albania 2.9e+10   2897366     31        20.5        8.08
##  3      Algeria 5.1e+11  38186136     36        99.1        4.25
##  4       Angola 1.5e+11  23448202     23         0.0        3.25
##  5    Australia 9.9e+11  23125868     81         0.2       10.00
##  6      Austria 3.7e+11   8479375     69         0.6       10.00
##  7      Bahamas 8.5e+09    377841     71         0.0       10.00
##  8      Bahrain 5.7e+10   1349427     48        95.0        0.83
##  9   Bangladesh 4.5e+11 157157392     27        85.9        6.42
## 10     Barbados 4.3e+09    282503     75         0.2       10.00
## # ... with 129 more rows, and 1 more variables: region &lt;chr&gt;</code></pre></div>
</div>
<div id="filtrar-observaciones-de-la-base-con-filter" class="section level2">
<h2><span class="header-section-number">4.6</span> Filtrar observaciones de la base con <code>filter()</code></h2>
<p>Es muy común el querer filtrar nuestras observaciones de acuerdo a algún tipo de criterio lógico. Para esto R cuenta con operadores lógicos. Los más comunes son los siguientes:</p>
<table>
<thead>
<tr class="header">
<th align="center">operador</th>
<th>descripción</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">==</td>
<td>es igual a</td>
</tr>
<tr class="even">
<td align="center">!=</td>
<td>es distinto a</td>
</tr>
<tr class="odd">
<td align="center">&gt;</td>
<td>es mayor a</td>
</tr>
<tr class="even">
<td align="center">&lt;</td>
<td>es menor a</td>
</tr>
<tr class="odd">
<td align="center">&gt;=</td>
<td>es mayor o igual a</td>
</tr>
<tr class="even">
<td align="center">&lt;=</td>
<td>es menor o igual a</td>
</tr>
<tr class="odd">
<td align="center">&amp;</td>
<td>y (intersección)</td>
</tr>
<tr class="even">
<td align="center"></td>
<td></td>
</tr>
</tbody>
</table>
<p>Por ejemplo, podríamos querer solo los países (observaciones) sudamericanos. Hacer esto con <code>filter()</code> es simple, con la ayuda de operadores lógicos:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(qog_mod, region <span class="op">==</span><span class="st"> &quot;South America&quot;</span>)
## # A tibble: 11 x 7
##        cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##        &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1   Bolivia           6.3e+10  10399931     34         0.0         7.6
##  2    Brazil           3.1e+12 204259376     42         0.1         8.7
##  3     Chile           3.8e+11  17575832     71         0.0        10.0
##  4  Colombia           5.8e+11  47342364     36         0.2         7.2
##  5   Ecuador           1.7e+11  15661312     35         0.0         7.1
##  6    Guyana           5.1e+09    761033     27         9.0         7.8
##  7  Paraguay           5.3e+10   6465669     24         0.0         8.1
##  8      Peru           3.5e+11  30565460     38         0.0         8.5
##  9  Suriname           8.4e+09    533450     36        13.0         7.9
## 10   Uruguay           6.6e+10   3407969     73         0.0        10.0
## 11 Venezuela           5.4e+11  30276044     20         0.0         5.2
## # ... with 1 more variables: region &lt;chr&gt;</code></pre></div>
<p>¿Qué pasa si queremos solo las filas de países sudamericanos con más de 10 millones de habitantes (nos quedamos con 8 de 12)?</p>
<p>¿Cuáles son los filtros que aplican los siguientes comandos?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(qog_mod, fh_ipolity2 <span class="op">&gt;</span><span class="st"> </span><span class="dv">9</span>)
## # A tibble: 39 x 7
##             cname wdi_gdppppcon2011  wdi_pop ti_cpi lp_muslim80
##             &lt;chr&gt;             &lt;dbl&gt;    &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1      Australia           9.9e+11 23125868     81         0.2
##  2        Austria           3.7e+11  8479375     69         0.6
##  3        Bahamas           8.5e+09   377841     71         0.0
##  4       Barbados           4.3e+09   282503     75         0.2
##  5        Belgium           4.5e+11 11182817     75         1.1
##  6         Canada           1.5e+12 35158304     81         0.6
##  7     Cape Verde           3.1e+09   507258     58         0.0
##  8          Chile           3.8e+11 17575832     71         0.0
##  9     Costa Rica           6.5e+10  4706433     53         0.0
## 10 Cyprus (1975-)           2.6e+10  1141652     63        18.5
## # ... with 29 more rows, and 2 more variables: fh_ipolity2 &lt;dbl&gt;,
## #   region &lt;chr&gt;

<span class="kw">filter</span>(qog_mod, wdi_pop <span class="op">&gt;</span><span class="st"> </span><span class="fl">10e7</span>)
## # A tibble: 10 x 7
##               cname wdi_gdppppcon2011    wdi_pop ti_cpi lp_muslim80
##               &lt;chr&gt;             &lt;dbl&gt;      &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1       Bangladesh           4.5e+11  157157392     27        85.9
##  2           Brazil           3.1e+12  204259376     42         0.1
##  3            China           1.6e+13 1357379968     40         2.4
##  4            India           6.6e+12 1279498880     36        11.6
##  5        Indonesia           2.4e+12  251268272     32        43.4
##  6            Japan           4.5e+12  127338624     74         0.0
##  7           Mexico           2.0e+12  123740112     34         0.0
##  8          Nigeria           9.4e+11  172816512     25        45.0
##  9 Pakistan (1971-)           8.1e+11  181192640     28        96.8
## 10    United States           1.6e+13  316497536     73         0.8
## # ... with 2 more variables: fh_ipolity2 &lt;dbl&gt;, region &lt;chr&gt;

<span class="kw">filter</span>(qog_mod, cname <span class="op">!=</span><span class="st"> &quot;Albania&quot;</span>)
## # A tibble: 138 x 7
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8        99.3        2.02
##  2     Algeria           5.1e+11  38186136     36        99.1        4.25
##  3      Angola           1.5e+11  23448202     23         0.0        3.25
##  4   Australia           9.9e+11  23125868     81         0.2       10.00
##  5     Austria           3.7e+11   8479375     69         0.6       10.00
##  6     Bahamas           8.5e+09    377841     71         0.0       10.00
##  7     Bahrain           5.7e+10   1349427     48        95.0        0.83
##  8  Bangladesh           4.5e+11 157157392     27        85.9        6.42
##  9    Barbados           4.3e+09    282503     75         0.2       10.00
## 10     Belgium           4.5e+11  11182817     75         1.1        9.50
## # ... with 128 more rows, and 1 more variables: region &lt;chr&gt;

<span class="kw">filter</span>(qog_mod, lp_muslim80 <span class="op">&gt;=</span><span class="st"> </span><span class="dv">95</span>)
## # A tibble: 15 x 7
##               cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80
##               &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1      Afghanistan           5.8e+10  30682500      8          99
##  2          Algeria           5.1e+11  38186136     36          99
##  3          Bahrain           5.7e+10   1349427     48          95
##  4             Iran           1.2e+12  77152448     25          98
##  5             Iraq           5.1e+11  33781384     16          96
##  6           Kuwait           2.7e+11   3593689     43          95
##  7            Libya           1.2e+11   6265987     15          98
##  8         Maldives           4.5e+09    393000     25         100
##  9       Mauritania           1.4e+10   3872684     30          99
## 10          Morocco           2.4e+11  33452686     37          99
## 11             Oman           1.5e+11   3906912     47          99
## 12 Pakistan (1971-)           8.1e+11 181192640     28          97
## 13     Saudi Arabia           1.5e+12  30201052     46          99
## 14          Tunisia           1.2e+11  10886500     41          99
## 15           Turkey           1.4e+12  75010200     50          99
## # ... with 2 more variables: fh_ipolity2 &lt;dbl&gt;, region &lt;chr&gt;

<span class="kw">filter</span>(qog_mod, region <span class="op">==</span><span class="st"> &quot;South America&quot;</span> <span class="op">&amp;</span><span class="st"> </span>wdi_pop <span class="op">&gt;</span><span class="st"> </span><span class="fl">10e6</span>)
## # A tibble: 7 x 7
##       cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##       &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1   Bolivia           6.3e+10  10399931     34         0.0         7.6
## 2    Brazil           3.1e+12 204259376     42         0.1         8.7
## 3     Chile           3.8e+11  17575832     71         0.0        10.0
## 4  Colombia           5.8e+11  47342364     36         0.2         7.2
## 5   Ecuador           1.7e+11  15661312     35         0.0         7.1
## 6      Peru           3.5e+11  30565460     38         0.0         8.5
## 7 Venezuela           5.4e+11  30276044     20         0.0         5.2
## # ... with 1 more variables: region &lt;chr&gt;

<span class="kw">filter</span>(qog_mod, region <span class="op">==</span><span class="st"> &quot;South America&quot;</span> <span class="op">|</span><span class="st"> </span>region <span class="op">==</span><span class="st"> &quot;South-Eastern Asia&quot;</span>)
## # A tibble: 19 x 7
##               cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80
##               &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1          Bolivia           6.3e+10  10399931     34         0.0
##  2           Brazil           3.1e+12 204259376     42         0.1
##  3         Cambodia           4.5e+10  15078564     20         2.4
##  4            Chile           3.8e+11  17575832     71         0.0
##  5         Colombia           5.8e+11  47342364     36         0.2
##  6          Ecuador           1.7e+11  15661312     35         0.0
##  7           Guyana           5.1e+09    761033     27         9.0
##  8        Indonesia           2.4e+12 251268272     32        43.4
##  9             Laos           3.2e+10   6579985     26         1.0
## 10 Malaysia (1966-)           6.9e+11  29465372     50        49.4
## 11         Paraguay           5.3e+10   6465669     24         0.0
## 12             Peru           3.5e+11  30565460     38         0.0
## 13      Philippines           6.2e+11  97571680     36         4.3
## 14        Singapore           4.2e+11   5399200     86        17.4
## 15          Vietnam           4.6e+11  89708896     31         1.0
## 16         Suriname           8.4e+09    533450     36        13.0
## 17         Thailand           1.0e+12  67451424     35         3.9
## 18          Uruguay           6.6e+10   3407969     73         0.0
## 19        Venezuela           5.4e+11  30276044     20         0.0
## # ... with 2 more variables: fh_ipolity2 &lt;dbl&gt;, region &lt;chr&gt;</code></pre></div>
</div>
<div id="crear-nuevas-variables-en-la-base-con-mutate" class="section level2">
<h2><span class="header-section-number">4.7</span> Crear nuevas variables en la base con <code>mutate()</code></h2>
<p>Muchas veces queremos crear nuevas variables, a partir de las que ya tenemos. Por ejemplo, podríamos querer el GDP per capita, en vez del absoluto. Tenemos los ingredientes para calcularlo: el GDP absoluto y la población. Creemos una nueva variable, entonces:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(qog_mod, <span class="dt">gdp_ppp_per_capita =</span> wdi_gdppppcon2011<span class="op">/</span>wdi_pop)
## # A tibble: 139 x 8
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8        99.3        2.02
##  2     Albania           2.9e+10   2897366     31        20.5        8.08
##  3     Algeria           5.1e+11  38186136     36        99.1        4.25
##  4      Angola           1.5e+11  23448202     23         0.0        3.25
##  5   Australia           9.9e+11  23125868     81         0.2       10.00
##  6     Austria           3.7e+11   8479375     69         0.6       10.00
##  7     Bahamas           8.5e+09    377841     71         0.0       10.00
##  8     Bahrain           5.7e+10   1349427     48        95.0        0.83
##  9  Bangladesh           4.5e+11 157157392     27        85.9        6.42
## 10    Barbados           4.3e+09    282503     75         0.2       10.00
## # ... with 129 more rows, and 2 more variables: region &lt;chr&gt;,
## #   gdp_ppp_per_capita &lt;dbl&gt;</code></pre></div>
<p>Otra nueva variable que podría interesarnos es el número de musulmanes por país. Con la proporción de musulmanes y la población total del país podemos hacer una buena estimación:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(qog_mod, <span class="dt">n_muslim =</span> wdi_pop <span class="op">*</span><span class="st"> </span>lp_muslim80)
## # A tibble: 139 x 8
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8        99.3        2.02
##  2     Albania           2.9e+10   2897366     31        20.5        8.08
##  3     Algeria           5.1e+11  38186136     36        99.1        4.25
##  4      Angola           1.5e+11  23448202     23         0.0        3.25
##  5   Australia           9.9e+11  23125868     81         0.2       10.00
##  6     Austria           3.7e+11   8479375     69         0.6       10.00
##  7     Bahamas           8.5e+09    377841     71         0.0       10.00
##  8     Bahrain           5.7e+10   1349427     48        95.0        0.83
##  9  Bangladesh           4.5e+11 157157392     27        85.9        6.42
## 10    Barbados           4.3e+09    282503     75         0.2       10.00
## # ... with 129 more rows, and 2 more variables: region &lt;chr&gt;,
## #   n_muslim &lt;dbl&gt;</code></pre></div>
<p>¡Es posible crear más de una variable con el mismo comando! Creemos las dos de antes, a la vez:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(qog_mod, 
       <span class="dt">gdp_ppp_per_capita =</span> wdi_gdppppcon2011<span class="op">/</span>wdi_pop,
       <span class="dt">n_muslim           =</span> wdi_pop <span class="op">*</span><span class="st"> </span>lp_muslim80)
## # A tibble: 139 x 9
##          cname wdi_gdppppcon2011   wdi_pop ti_cpi lp_muslim80 fh_ipolity2
##          &lt;chr&gt;             &lt;dbl&gt;     &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Afghanistan           5.8e+10  30682500      8        99.3        2.02
##  2     Albania           2.9e+10   2897366     31        20.5        8.08
##  3     Algeria           5.1e+11  38186136     36        99.1        4.25
##  4      Angola           1.5e+11  23448202     23         0.0        3.25
##  5   Australia           9.9e+11  23125868     81         0.2       10.00
##  6     Austria           3.7e+11   8479375     69         0.6       10.00
##  7     Bahamas           8.5e+09    377841     71         0.0       10.00
##  8     Bahrain           5.7e+10   1349427     48        95.0        0.83
##  9  Bangladesh           4.5e+11 157157392     27        85.9        6.42
## 10    Barbados           4.3e+09    282503     75         0.2       10.00
## # ... with 129 more rows, and 3 more variables: region &lt;chr&gt;,
## #   gdp_ppp_per_capita &lt;dbl&gt;, n_muslim &lt;dbl&gt;</code></pre></div>
</div>
<div id="concatenar-comandos-las-pipes" class="section level2">
<h2><span class="header-section-number">4.8</span> Concatenar comandos: las pipes (<code>%&gt;%</code>)</h2>
<p>A menudo no queremos hacer una sola de las operaciones con bases de datos reseñadas antes, sino que una seguidilla de estas. Si quisiéramos crear una nueva base a través de, por ejemplo, (1) seleccionar las variables de país, población y GDP, (2) crear la variable de GDP per capita, y (3) ordenar los países de mayor a menor según GDP per capita, nuestro procedimiento en R sería algo como esto:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod_seguidilla_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">select</span>(qog_mod, cname, wdi_pop, wdi_gdppppcon2011)
qog_mod_seguidilla_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">mutate</span>(qog_mod_seguidilla_<span class="dv">1</span>, 
                               <span class="dt">gdp_ppp_per_capita =</span> wdi_gdppppcon2011<span class="op">/</span>wdi_pop)
qog_mod_seguidilla_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">arrange</span>(qog_mod_seguidilla_<span class="dv">2</span>, <span class="op">-</span>gdp_ppp_per_capita)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod_seguidilla_<span class="dv">3</span>
## # A tibble: 139 x 4
##                   cname   wdi_pop wdi_gdppppcon2011 gdp_ppp_per_capita
##                   &lt;chr&gt;     &lt;int&gt;             &lt;dbl&gt;              &lt;dbl&gt;
##  1                Qatar   2101288           2.8e+11             133395
##  2           Luxembourg    543360           4.9e+10              89889
##  3            Singapore   5399200           4.2e+11              77721
##  4               Kuwait   3593689           2.7e+11              74181
##  5               Norway   5079623           3.2e+11              63322
##  6 United Arab Emirates   9039978           5.6e+11              62056
##  7          Switzerland   8089346           4.4e+11              54912
##  8        United States 316497536           1.6e+13              51282
##  9         Saudi Arabia  30201052           1.5e+12              48963
## 10              Ireland   4598294           2.1e+11              46182
## # ... with 129 more rows</code></pre></div>
<p>El lector notará que esto es bastante complicado y nos deja con dos <strong>objetos intermedios</strong> que no nos interesan, “qog_mod_seguidilla_1” y “qog_mod_seguidilla_2”.</p>
<p>La solución del paquete tidyverse que estamos utilizando son <strong>las pipes</strong>. El lector notará que en las tres funciones de nuestra seguidilla anterior (select, mutate y arrange) el primer argumento es la base de datos a tratar. En vez de crear objetos intermedios podemos “chutear” la base de datos a través de nuestros comandos con pipes, omitiendo los primeros argumentos:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod_seguidilla &lt;-<span class="st"> </span>qog_mod <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(cname, wdi_pop, wdi_gdppppcon2011) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gdp_ppp_per_capita =</span> wdi_gdppppcon2011<span class="op">/</span>wdi_pop) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>gdp_ppp_per_capita)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qog_mod_seguidilla
## # A tibble: 139 x 4
##                   cname   wdi_pop wdi_gdppppcon2011 gdp_ppp_per_capita
##                   &lt;chr&gt;     &lt;int&gt;             &lt;dbl&gt;              &lt;dbl&gt;
##  1                Qatar   2101288           2.8e+11             133395
##  2           Luxembourg    543360           4.9e+10              89889
##  3            Singapore   5399200           4.2e+11              77721
##  4               Kuwait   3593689           2.7e+11              74181
##  5               Norway   5079623           3.2e+11              63322
##  6 United Arab Emirates   9039978           5.6e+11              62056
##  7          Switzerland   8089346           4.4e+11              54912
##  8        United States 316497536           1.6e+13              51282
##  9         Saudi Arabia  30201052           1.5e+12              48963
## 10              Ireland   4598294           2.1e+11              46182
## # ... with 129 more rows</code></pre></div>
<p>Las pipes pueden leerse como “pero luego”. Nuestra seguidilla anterior, entonces, se leería de la siguiente forma:</p>
<blockquote>
<p>qog_mod_seguilla es igual a qog_mod; pero luego seleccionamos las variables cname, wdi_pop, wdi_gdppppcon2011; pero luego creamos la variable gdp_ppp_per_capita; pero luego ordenamos la base en forma decreciente según gdp_ppp_per_capita.</p>
</blockquote>
</div>
<div id="ejercicios-1" class="section level2">
<h2><span class="header-section-number">4.9</span> Ejercicios</h2>
<ul>
<li>Cree una base nueva, llamada qog_mod_2, con una nueva variable llamada “porc_muslim”, que sea el porcentaje de población musulmana del país.</li>
<li>Cree una base nueva, llamada qog_mod_3, que incluya solo países latinoamericanos, China y Sudáfrica.</li>
<li>Cree una base nueva, llamada qog_mod_4, que incluya solo países con población mayor a la media de población entre todos los países. Debe contener solo las variables de nombre del país, región y población (en ese orden). Ordene la base según población, de mayor a menor. ¡Use pipes!</li>
</ul>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="rbas.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bin.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
