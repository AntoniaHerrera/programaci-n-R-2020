<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 9 Manejo avanzado de datos políticos | AnalizaR Datos Políticos</title>
  <meta name="description" content="Manual aplicado para politólogos y relacionistas internacionales en R" />
  <meta name="generator" content="bookdown  and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 9 Manejo avanzado de datos políticos | AnalizaR Datos Políticos" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Manual aplicado para politólogos y relacionistas internacionales en R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 9 Manejo avanzado de datos políticos | AnalizaR Datos Políticos" />
  
  <meta name="twitter:description" content="Manual aplicado para politólogos y relacionistas internacionales en R" />
  

<meta name="author" content="Francisco Urdinez y Andrés Cruz Labrín (editores)" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="surv.html">
<link rel="next" href="pca.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
<script src="libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="libs/wordcloud2-0.0.1/hover.js"></script>
<script src="libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>
<script>
% https://stackoverflow.com/a/4425214/8242291
var links = document.links;

for (var i = 0, linksLength = links.length; i < linksLength; i++) {

    if (links[i].hostname != window.location.hostname) {
        links[i].target = '_blank';
    }

}
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #2a211c;
    color: #bdae9d;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #bdae9d;  padding-left: 4px; }
div.sourceCode
  { color: #bdae9d; background-color: #2a211c; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ffff00; } /* Alert */
code span.an { color: #0066ff; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #44aa43; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #43a8ed; font-weight: bold; } /* ControlFlow */
code span.ch { color: #049b0a; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #0066ff; font-weight: bold; font-style: italic; } /* Comment */
code span.do { color: #0066ff; font-style: italic; } /* Documentation */
code span.dt { text-decoration: underline; } /* DataType */
code span.dv { color: #44aa43; } /* DecVal */
code span.er { color: #ffff00; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #44aa43; } /* Float */
code span.fu { color: #ff9358; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #0066ff; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #43a8ed; font-weight: bold; } /* Keyword */
code span.op { } /* Operator */
code span.pp { font-weight: bold; } /* Preprocessor */
code span.sc { color: #049b0a; } /* SpecialChar */
code span.ss { color: #049b0a; } /* SpecialString */
code span.st { color: #049b0a; } /* String */
code span.va { } /* Variable */
code span.vs { color: #049b0a; } /* VerbatimString */
code span.wa { color: #ffff00; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><b><a href="./index.html"><img style="float: left; margin-right: 5px;" src="favicon.ico"></img>AnalizaR datos políticos</a></b></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#inicio"><i class="fa fa-check"></i><b>1.1</b> Inicio</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#como-contribuir"><i class="fa fa-check"></i><b>1.2</b> ¿Cómo contribuir?</a><ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#sobre-los-autores-y-autoras"><i class="fa fa-check"></i><b>1.2.1</b> Sobre los autores y autoras</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#prefacio"><i class="fa fa-check"></i><b>1.3</b> Prefacio</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#agradecimientos"><i class="fa fa-check"></i><b>1.3.1</b> Agradecimientos</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#que-esperar-del-libro"><i class="fa fa-check"></i><b>1.4</b> Qué esperar del libro</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#estructura-del-libro"><i class="fa fa-check"></i><b>1.5</b> Estructura del libro</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#prerrequisitos"><i class="fa fa-check"></i><b>1.6</b> Prerrequisitos</a></li>
</ul></li>
<li class="part"><span><b>I Introducción a R</b></span></li>
<li class="chapter" data-level="2" data-path="rbas.html"><a href="rbas.html"><i class="fa fa-check"></i><b>2</b> R básico</a><ul>
<li class="chapter" data-level="2.1" data-path="rbas.html"><a href="rbas.html#instalacion"><i class="fa fa-check"></i><b>2.1</b> Instalación</a><ul>
<li class="chapter" data-level="2.1.1" data-path="rbas.html"><a href="rbas.html#r"><i class="fa fa-check"></i><b>2.1.1</b> R</a></li>
<li class="chapter" data-level="2.1.2" data-path="rbas.html"><a href="rbas.html#rstudio"><i class="fa fa-check"></i><b>2.1.2</b> RStudio</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rbas.html"><a href="rbas.html#partes-de-rstudio"><i class="fa fa-check"></i><b>2.2</b> Partes de RStudio</a><ul>
<li class="chapter" data-level="2.2.1" data-path="rbas.html"><a href="rbas.html#consola"><i class="fa fa-check"></i><b>2.2.1</b> Consola</a></li>
<li class="chapter" data-level="2.2.2" data-path="rbas.html"><a href="rbas.html#script"><i class="fa fa-check"></i><b>2.2.2</b> Script</a></li>
<li class="chapter" data-level="2.2.3" data-path="rbas.html"><a href="rbas.html#objetos"><i class="fa fa-check"></i><b>2.2.3</b> Objetos</a></li>
<li class="chapter" data-level="2.2.4" data-path="rbas.html"><a href="rbas.html#archivos-graficos-paquetes-ayuda"><i class="fa fa-check"></i><b>2.2.4</b> Archivos / gráficos / paquetes / ayuda</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html"><i class="fa fa-check"></i><b>3</b> Manejo de datos</a><ul>
<li class="chapter" data-level="3.1" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#introduccion-1"><i class="fa fa-check"></i><b>3.1</b> Introducción</a><ul>
<li class="chapter" data-level="3.1.1" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#nuestra-base-de-datos"><i class="fa fa-check"></i><b>3.1.1</b> Nuestra base de datos</a></li>
<li class="chapter" data-level="3.1.2" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#describir-la-base"><i class="fa fa-check"></i><b>3.1.2</b> Describir la base</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#operaciones-en-bases"><i class="fa fa-check"></i><b>3.2</b> Operaciones en bases</a><ul>
<li class="chapter" data-level="3.2.1" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#ordenar-una-base"><i class="fa fa-check"></i><b>3.2.1</b> Ordenar una base</a></li>
<li class="chapter" data-level="3.2.2" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#seleccionar-columnas"><i class="fa fa-check"></i><b>3.2.2</b> Seleccionar columnas</a></li>
<li class="chapter" data-level="3.2.3" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#renombrar-columnas"><i class="fa fa-check"></i><b>3.2.3</b> Renombrar columnas</a></li>
<li class="chapter" data-level="3.2.4" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#filtrar-observaciones"><i class="fa fa-check"></i><b>3.2.4</b> Filtrar observaciones</a></li>
<li class="chapter" data-level="3.2.5" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#crear-nuevas-variables"><i class="fa fa-check"></i><b>3.2.5</b> Crear nuevas variables</a></li>
<li class="chapter" data-level="3.2.6" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#concatenar-comandos"><i class="fa fa-check"></i><b>3.2.6</b> Concatenar comandos</a></li>
<li class="chapter" data-level="3.2.7" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#operaciones-agrupadas"><i class="fa fa-check"></i><b>3.2.7</b> Operaciones agrupadas</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="manejo-de-datos.html"><a href="manejo-de-datos.html#reformatear-bases"><i class="fa fa-check"></i><b>3.3</b> Reformatear bases</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dataviz.html"><a href="dataviz.html"><i class="fa fa-check"></i><b>4</b> Visualización de datos</a><ul>
<li class="chapter" data-level="4.1" data-path="dataviz.html"><a href="dataviz.html#por-que-quiero-visualizar-mis-datos"><i class="fa fa-check"></i><b>4.1</b> ¿Por qué quiero visualizar mis datos?</a></li>
<li class="chapter" data-level="4.2" data-path="dataviz.html"><a href="dataviz.html#primeros-pasos"><i class="fa fa-check"></i><b>4.2</b> Primeros pasos</a><ul>
<li class="chapter" data-level="4.2.1" data-path="dataviz.html"><a href="dataviz.html#las-capas-del-multiverso-ggplotidiano"><i class="fa fa-check"></i><b>4.2.1</b> Las capas del multiverso ggplotidiano</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dataviz.html"><a href="dataviz.html#elecciones-locales-y-visualizacion-de-datos"><i class="fa fa-check"></i><b>4.3</b> Elecciones locales y visualización de datos</a><ul>
<li class="chapter" data-level="4.3.1" data-path="dataviz.html"><a href="dataviz.html#grafico-de-barras"><i class="fa fa-check"></i><b>4.3.1</b> Gráfico de barras</a></li>
<li class="chapter" data-level="4.3.2" data-path="dataviz.html"><a href="dataviz.html#grafico-de-linea"><i class="fa fa-check"></i><b>4.3.2</b> Gráfico de Línea</a></li>
<li class="chapter" data-level="4.3.3" data-path="dataviz.html"><a href="dataviz.html#boxplot"><i class="fa fa-check"></i><b>4.3.3</b> Boxplot</a></li>
<li class="chapter" data-level="4.3.4" data-path="dataviz.html"><a href="dataviz.html#histograma"><i class="fa fa-check"></i><b>4.3.4</b> Histograma</a></li>
<li class="chapter" data-level="4.3.5" data-path="dataviz.html"><a href="dataviz.html#relacion-entre-variables"><i class="fa fa-check"></i><b>4.3.5</b> Relación entre variables</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dataviz.html"><a href="dataviz.html#para-seguir-aprendiendo"><i class="fa fa-check"></i><b>4.4</b> Para seguir aprendiendo</a><ul>
<li class="chapter" data-level="4.4.1" data-path="dataviz.html"><a href="dataviz.html#otros-paquetes"><i class="fa fa-check"></i><b>4.4.1</b> Otros paquetes:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="carga.html"><a href="carga.html"><i class="fa fa-check"></i><b>5</b> Carga de bases</a><ul>
<li class="chapter" data-level="5.1" data-path="carga.html"><a href="carga.html#carga-intro"><i class="fa fa-check"></i><b>5.1</b> Introducción</a></li>
<li class="chapter" data-level="5.2" data-path="carga.html"><a href="carga.html#carga-formatos"><i class="fa fa-check"></i><b>5.2</b> Distintos formatos de bases</a><ul>
<li class="chapter" data-level="5.2.1" data-path="carga.html"><a href="carga.html#archivos-separados-por-delimitadores-.csv-y-.tsv"><i class="fa fa-check"></i><b>5.2.1</b> Archivos separados por delimitadores (.csv y .tsv)</a></li>
<li class="chapter" data-level="5.2.2" data-path="carga.html"><a href="carga.html#carga-r"><i class="fa fa-check"></i><b>5.2.2</b> Archivos creados con R (.Rdata y .rds)</a></li>
<li class="chapter" data-level="5.2.3" data-path="carga.html"><a href="carga.html#carga-etiquetas"><i class="fa fa-check"></i><b>5.2.3</b> Datos con etiquetas (Stata o SPSS)</a></li>
<li class="chapter" data-level="5.2.4" data-path="carga.html"><a href="carga.html#carga-excel"><i class="fa fa-check"></i><b>5.2.4</b> Archivos de Excel</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="carga.html"><a href="carga.html#multiples-bases-de-datos-a-la-vez"><i class="fa fa-check"></i><b>5.3</b> Múltiples bases de datos a la vez</a></li>
<li class="chapter" data-level="5.4" data-path="carga.html"><a href="carga.html#carga-grandes"><i class="fa fa-check"></i><b>5.4</b> Bases de datos tabulares grandes</a></li>
</ul></li>
<li class="part"><span><b>II Modelos</b></span></li>
<li class="chapter" data-level="6" data-path="lineal.html"><a href="lineal.html"><i class="fa fa-check"></i><b>6</b> Modelos lineales</a><ul>
<li class="chapter" data-level="6.1" data-path="lineal.html"><a href="lineal.html#introduccion-2"><i class="fa fa-check"></i><b>6.1</b> Introducción</a></li>
<li class="chapter" data-level="6.2" data-path="lineal.html"><a href="lineal.html#aplicacion-en-r"><i class="fa fa-check"></i><b>6.2</b> Aplicación en <code>R</code></a><ul>
<li class="chapter" data-level="6.2.1" data-path="lineal.html"><a href="lineal.html#estadisticos-descriptivos"><i class="fa fa-check"></i><b>6.2.1</b> Estadísticos Descriptivos</a></li>
<li class="chapter" data-level="6.2.2" data-path="lineal.html"><a href="lineal.html#estadisticos-descriptivos-y-distribucion-de-las-variables-del-modelo"><i class="fa fa-check"></i><b>6.2.2</b> Estadísticos descriptivos y distribución de las variables del modelo</a></li>
<li class="chapter" data-level="6.2.3" data-path="lineal.html"><a href="lineal.html#matriz-de-correlacion-de-variables-independientes"><i class="fa fa-check"></i><b>6.2.3</b> Matriz de correlación de variables independientes</a></li>
<li class="chapter" data-level="6.2.4" data-path="lineal.html"><a href="lineal.html#distribucion-de-las-variables-de-interes"><i class="fa fa-check"></i><b>6.2.4</b> Distribución de las variables de interés</a></li>
<li class="chapter" data-level="6.2.5" data-path="lineal.html"><a href="lineal.html#relacion-entre-la-variable-dependiente-e-independiente"><i class="fa fa-check"></i><b>6.2.5</b> Relación entre la variable dependiente e independiente</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="lineal.html"><a href="lineal.html#modelo-bivariado-regresion-lineal-simple"><i class="fa fa-check"></i><b>6.3</b> Modelo bivariado: regresión lineal simple</a><ul>
<li class="chapter" data-level="6.3.1" data-path="lineal.html"><a href="lineal.html#estimando-un-modelo-lineal-en-r"><i class="fa fa-check"></i><b>6.3.1</b> Estimando un modelo lineal en <code>R</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="lineal.html"><a href="lineal.html#representacion-grafica"><i class="fa fa-check"></i><b>6.3.2</b> Representación gráfica</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="lineal.html"><a href="lineal.html#modelo-multivariado-regresion-multiple"><i class="fa fa-check"></i><b>6.4</b> Modelo multivariado: regresión múltiple</a><ul>
<li class="chapter" data-level="6.4.1" data-path="lineal.html"><a href="lineal.html#ajuste-del-modelo"><i class="fa fa-check"></i><b>6.4.1</b> Ajuste del modelo</a></li>
<li class="chapter" data-level="6.4.2" data-path="lineal.html"><a href="lineal.html#inferencia-en-modelos-lineales-multiples"><i class="fa fa-check"></i><b>6.4.2</b> Inferencia en modelos lineales múltiples</a></li>
<li class="chapter" data-level="6.4.3" data-path="lineal.html"><a href="lineal.html#supuestos-de-ols"><i class="fa fa-check"></i><b>6.4.3</b> Supuestos de OLS</a></li>
<li class="chapter" data-level="6.4.4" data-path="lineal.html"><a href="lineal.html#errores-estandares-robustos"><i class="fa fa-check"></i><b>6.4.4</b> Errores estándares robustos</a></li>
<li class="chapter" data-level="6.4.5" data-path="lineal.html"><a href="lineal.html#un-caso-especial-de-heterocedasticidad-la-varianza-del-error-asociada-a-clusters"><i class="fa fa-check"></i><b>6.4.5</b> Un caso especial de Heterocedasticidad: la varianza del error asociada a clusters</a></li>
<li class="chapter" data-level="6.4.6" data-path="lineal.html"><a href="lineal.html#un-supuesto-adicional-para-poder-realizar-inferencia"><i class="fa fa-check"></i><b>6.4.6</b> Un supuesto adicional para poder realizar <strong>inferencia</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="logit.html"><a href="logit.html"><i class="fa fa-check"></i><b>7</b> Modelos logísticos</a><ul>
<li class="chapter" data-level="7.1" data-path="logit.html"><a href="logit.html#nociones-basicas"><i class="fa fa-check"></i><b>7.1</b> Nociones básicas</a></li>
<li class="chapter" data-level="7.2" data-path="logit.html"><a href="logit.html#aplicacion-en-r-1"><i class="fa fa-check"></i><b>7.2</b> Aplicación en <code>R</code></a><ul>
<li class="chapter" data-level="7.2.1" data-path="logit.html"><a href="logit.html#estimar-los-modelos"><i class="fa fa-check"></i><b>7.2.1</b> Estimar los modelos</a></li>
<li class="chapter" data-level="7.2.2" data-path="logit.html"><a href="logit.html#crear-tablas"><i class="fa fa-check"></i><b>7.2.2</b> Crear tablas</a></li>
<li class="chapter" data-level="7.2.3" data-path="logit.html"><a href="logit.html#visualizacion-de-resultados"><i class="fa fa-check"></i><b>7.2.3</b> Visualización de resultados</a></li>
<li class="chapter" data-level="7.2.4" data-path="logit.html"><a href="logit.html#ajuste-de-los-modelos"><i class="fa fa-check"></i><b>7.2.4</b> Ajuste de los modelos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="surv.html"><a href="surv.html"><i class="fa fa-check"></i><b>8</b> Modelos de supervivencia</a><ul>
<li class="chapter" data-level="8.1" data-path="surv.html"><a href="surv.html#nociones-basicas-1"><i class="fa fa-check"></i><b>8.1</b> Nociones básicas</a></li>
<li class="chapter" data-level="8.2" data-path="surv.html"><a href="surv.html#el-modelo-cox-de-riesgos-proporcionales"><i class="fa fa-check"></i><b>8.2</b> El modelo Cox de riesgos proporcionales</a></li>
<li class="chapter" data-level="8.3" data-path="surv.html"><a href="surv.html#aplicacion-en-r-2"><i class="fa fa-check"></i><b>8.3</b> Aplicación en <code>R</code></a><ul>
<li class="chapter" data-level="8.3.1" data-path="surv.html"><a href="surv.html#modelos-de-supervivencia-e-interpretacion-sus-coeficientes-como-hazard-ratios."><i class="fa fa-check"></i><b>8.3.1</b> Modelos de supervivencia e interpretación sus coeficientes como Hazard Ratios.</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Aplicaciones</b></span></li>
<li class="chapter" data-level="9" data-path="manejo-av.html"><a href="manejo-av.html"><i class="fa fa-check"></i><b>9</b> Manejo avanzado de datos políticos</a><ul>
<li class="chapter" data-level="9.1" data-path="manejo-av.html"><a href="manejo-av.html#introduccion-3"><i class="fa fa-check"></i><b>9.1</b> Introducción</a></li>
<li class="chapter" data-level="9.2" data-path="manejo-av.html"><a href="manejo-av.html#como-aprovechar-countrycode"><i class="fa fa-check"></i><b>9.2</b> ¿Cómo aprovechar <code>countrycode</code>?</a></li>
<li class="chapter" data-level="9.3" data-path="manejo-av.html"><a href="manejo-av.html#como-imputar-datos-faltantes"><i class="fa fa-check"></i><b>9.3</b> ¿Cómo imputar datos faltantes?</a></li>
<li class="chapter" data-level="9.4" data-path="manejo-av.html"><a href="manejo-av.html#imputar-datos-usando-amelia"><i class="fa fa-check"></i><b>9.4</b> Imputar datos usando Amelia</a><ul>
<li class="chapter" data-level="9.4.1" data-path="manejo-av.html"><a href="manejo-av.html#diagnosticos"><i class="fa fa-check"></i><b>9.4.1</b> Diagnosticos</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="manejo-av.html"><a href="manejo-av.html#regresiones-luego-de-imputar-datos"><i class="fa fa-check"></i><b>9.5</b> Regresiones luego de imputar datos</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="pca.html"><a href="pca.html"><i class="fa fa-check"></i><b>10</b> Creación de índices con PCA</a><ul>
<li class="chapter" data-level="10.1" data-path="pca.html"><a href="pca.html#aplicacion-en-r-3"><i class="fa fa-check"></i><b>10.1</b> Aplicación en <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="casos.html"><a href="casos.html"><i class="fa fa-check"></i><b>11</b> Selección de casos a partir de regresiones</a><ul>
<li class="chapter" data-level="11.1" data-path="casos.html"><a href="casos.html#que-casos-de-estudio-debo-seleccionar-para-testear-mi-hipotesis"><i class="fa fa-check"></i><b>11.1</b> ¿Qué casos de estudio debo seleccionar para testear mi hipótesis?</a><ul>
<li class="chapter" data-level="11.1.1" data-path="casos.html"><a href="casos.html#casos-tipicos"><i class="fa fa-check"></i><b>11.1.1</b> Casos Típicos</a></li>
<li class="chapter" data-level="11.1.2" data-path="casos.html"><a href="casos.html#casos-desviados"><i class="fa fa-check"></i><b>11.1.2</b> Casos desviados</a></li>
<li class="chapter" data-level="11.1.3" data-path="casos.html"><a href="casos.html#casos-influyentes"><i class="fa fa-check"></i><b>11.1.3</b> Casos Influyentes</a></li>
<li class="chapter" data-level="11.1.4" data-path="casos.html"><a href="casos.html#casos-extremos"><i class="fa fa-check"></i><b>11.1.4</b> Casos extremos</a></li>
<li class="chapter" data-level="11.1.5" data-path="casos.html"><a href="casos.html#casos-mas-similares"><i class="fa fa-check"></i><b>11.1.5</b> Casos más similares</a></li>
<li class="chapter" data-level="11.1.6" data-path="casos.html"><a href="casos.html#casos-mas-diferentes"><i class="fa fa-check"></i><b>11.1.6</b> Casos más diferentes</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="casos.html"><a href="casos.html#la-relevancia-de-combinar-metodos"><i class="fa fa-check"></i><b>11.2</b> La relevancia de combinar métodos</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="web-mining.html"><a href="web-mining.html"><i class="fa fa-check"></i><b>12</b> Mínería de datos</a></li>
<li class="chapter" data-level="13" data-path="redes.html"><a href="redes.html"><i class="fa fa-check"></i><b>13</b> Análisis de redes</a><ul>
<li class="chapter" data-level="13.1" data-path="redes.html"><a href="redes.html#introduccion-4"><i class="fa fa-check"></i><b>13.1</b> Introducción</a></li>
<li class="chapter" data-level="13.2" data-path="redes.html"><a href="redes.html#conceptos-iniciales"><i class="fa fa-check"></i><b>13.2</b> Conceptos iniciales</a><ul>
<li class="chapter" data-level="13.2.1" data-path="redes.html"><a href="redes.html#nodos-y-enlaces"><i class="fa fa-check"></i><b>13.2.1</b> Nodos y enlaces</a></li>
<li class="chapter" data-level="13.2.2" data-path="redes.html"><a href="redes.html#matriz-de-adyacencia"><i class="fa fa-check"></i><b>13.2.2</b> Matriz de adyacencia</a></li>
<li class="chapter" data-level="13.2.3" data-path="redes.html"><a href="redes.html#pesos-y-direccion"><i class="fa fa-check"></i><b>13.2.3</b> Pesos y dirección</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="redes.html"><a href="redes.html#bases-de-datos-de-redes"><i class="fa fa-check"></i><b>13.3</b> Bases de datos de redes</a></li>
<li class="chapter" data-level="13.4" data-path="redes.html"><a href="redes.html#disposicion-grafica"><i class="fa fa-check"></i><b>13.4</b> Disposición gráfica</a><ul>
<li class="chapter" data-level="13.4.1" data-path="redes.html"><a href="redes.html#color-y-forma-en-la-representacion-visual"><i class="fa fa-check"></i><b>13.4.1</b> Color y forma en la representación visual</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="redes.html"><a href="redes.html#analisis-basico-de-redes"><i class="fa fa-check"></i><b>13.5</b> Análisis básico de redes</a><ul>
<li class="chapter" data-level="13.5.1" data-path="redes.html"><a href="redes.html#medidas-de-centralidad"><i class="fa fa-check"></i><b>13.5.1</b> Medidas de centralidad</a></li>
<li class="chapter" data-level="13.5.2" data-path="redes.html"><a href="redes.html#comunidades-en-las-redes"><i class="fa fa-check"></i><b>13.5.2</b> Comunidades en las redes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="qta.html"><a href="qta.html"><i class="fa fa-check"></i><b>14</b> Análisis cuantitativo de texto</a><ul>
<li class="chapter" data-level="14.1" data-path="qta.html"><a href="qta.html#introduccion-5"><i class="fa fa-check"></i><b>14.1</b> Introducción</a></li>
<li class="chapter" data-level="14.2" data-path="qta.html"><a href="qta.html#exploracion-de-la-bases-de-datos"><i class="fa fa-check"></i><b>14.2</b> Exploración de la bases de datos</a></li>
<li class="chapter" data-level="14.3" data-path="qta.html"><a href="qta.html#calculo-de-frecuencias"><i class="fa fa-check"></i><b>14.3</b> Cálculo de frecuencias</a><ul>
<li class="chapter" data-level="14.3.1" data-path="qta.html"><a href="qta.html#cuales-son-los-diez-hashtags-mas-usados-de-las-cuentas-de-los-diputados"><i class="fa fa-check"></i><b>14.3.1</b> ¿Cuáles son los diez hashtags más usados de las cuentas de los diputados?</a></li>
<li class="chapter" data-level="14.3.2" data-path="qta.html"><a href="qta.html#frecuencias-por-genero-cantidad-de-hashtags-usados-por-los-diputados-en-total"><i class="fa fa-check"></i><b>14.3.2</b> Frecuencias por género: cantidad de hashtags usados por los diputados en total</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="qta.html"><a href="qta.html#wordcloud-de-hashtags"><i class="fa fa-check"></i><b>14.4</b> Wordcloud de hashtags</a></li>
<li class="chapter" data-level="14.5" data-path="qta.html"><a href="qta.html#graficar-los-hashtags-mas-utilizados-por-grupos-de-interes"><i class="fa fa-check"></i><b>14.5</b> Graficar los hashtags más utilizados por grupos de interés</a><ul>
<li class="chapter" data-level="14.5.1" data-path="qta.html"><a href="qta.html#hashtags-mas-usados-entre-las-diputadas"><i class="fa fa-check"></i><b>14.5.1</b> Hashtags más usados entre las diputadas</a></li>
<li class="chapter" data-level="14.5.2" data-path="qta.html"><a href="qta.html#hashtags-mas-usados-entre-los-diputados"><i class="fa fa-check"></i><b>14.5.2</b> Hashtags más usados entre los diputados</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="qta.html"><a href="qta.html#hashtags-de-genero-por-caracteristicas-del-diputado"><i class="fa fa-check"></i><b>14.6</b> Hashtags de género por características del diputado</a><ul>
<li class="chapter" data-level="14.6.1" data-path="qta.html"><a href="qta.html#por-el-genero-del-diputado"><i class="fa fa-check"></i><b>14.6.1</b> Por el género del diputado</a></li>
<li class="chapter" data-level="14.6.2" data-path="qta.html"><a href="qta.html#por-la-coalicion-de-los-diputados"><i class="fa fa-check"></i><b>14.6.2</b> Por la coalición de los diputados</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="qta.html"><a href="qta.html#variacion-temporal-del-uso-de-estos-hashtags"><i class="fa fa-check"></i><b>14.7</b> Variación temporal del uso de estos hashtags</a><ul>
<li class="chapter" data-level="14.7.1" data-path="qta.html"><a href="qta.html#frecuencia-semanal-de-olafeminista"><i class="fa fa-check"></i><b>14.7.1</b> Frecuencia semanal de #olafeminista</a></li>
<li class="chapter" data-level="14.7.2" data-path="qta.html"><a href="qta.html#frecuencia-semanal-de-tres-hashtags-de-genero"><i class="fa fa-check"></i><b>14.7.2</b> Frecuencia semanal de tres hashtags de género</a></li>
<li class="chapter" data-level="14.7.3" data-path="qta.html"><a href="qta.html#grafiquemos-los-hashtags-de-genero-por-semana"><i class="fa fa-check"></i><b>14.7.3</b> Grafiquemos los hashtags de género por semana</a></li>
<li class="chapter" data-level="14.7.4" data-path="qta.html"><a href="qta.html#ponderamos-en-relacion-al-total-de-hashtags-por-semana"><i class="fa fa-check"></i><b>14.7.4</b> Ponderamos en relación al total de hashtags por semana</a></li>
<li class="chapter" data-level="14.7.5" data-path="qta.html"><a href="qta.html#grafiquemos-los-hashtags-interesantes-ponderados-por-el-total-semanal"><i class="fa fa-check"></i><b>14.7.5</b> Grafiquemos los hashtags interesantes ponderados por el total semanal</a></li>
<li class="chapter" data-level="14.7.6" data-path="qta.html"><a href="qta.html#diputadas"><i class="fa fa-check"></i><b>14.7.6</b> Diputadas</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="qta.html"><a href="qta.html#hashtags-de-genero-por-semana-a-nivel-de-diputados-ponderados-por-semana"><i class="fa fa-check"></i><b>14.8</b> Hashtags de género por semana a nivel de diputados (ponderados por semana)</a></li>
<li class="chapter" data-level="14.9" data-path="qta.html"><a href="qta.html#comentarios-finales"><i class="fa fa-check"></i><b>14.9</b> Comentarios finales</a></li>
<li class="chapter" data-level="14.10" data-path="qta.html"><a href="qta.html#anexo-problemas-que-se-presentan-cuando-analizas-discursos-debates-o-leyes"><i class="fa fa-check"></i><b>14.10</b> Anexo: Problemas que se presentan cuando analizas discursos, debates o leyes</a></li>
<li class="chapter" data-level="14.11" data-path="qta.html"><a href="qta.html#tidy-text"><i class="fa fa-check"></i><b>14.11</b> <code>Tidy text</code></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="mapas.html"><a href="mapas.html"><i class="fa fa-check"></i><b>15</b> Generación de mapas</a><ul>
<li class="chapter" data-level="15.1" data-path="mapas.html"><a href="mapas.html#datos-espaciales"><i class="fa fa-check"></i><b>15.1</b> Datos Espaciales</a><ul>
<li class="chapter" data-level="15.1.1" data-path="mapas.html"><a href="mapas.html#que-son"><i class="fa fa-check"></i><b>15.1.1</b> ¿Qué son?</a></li>
<li class="chapter" data-level="15.1.2" data-path="mapas.html"><a href="mapas.html#estructura-de-los-datos-espaciales"><i class="fa fa-check"></i><b>15.1.2</b> Estructura de los Datos Espaciales</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="mapas.html"><a href="mapas.html#datos-espaciales-en-r"><i class="fa fa-check"></i><b>15.2</b> Datos Espaciales en R</a></li>
<li class="chapter" data-level="15.3" data-path="mapas.html"><a href="mapas.html#special-features-en-r"><i class="fa fa-check"></i><b>15.3</b> Special Features en R</a><ul>
<li class="chapter" data-level="15.3.1" data-path="mapas.html"><a href="mapas.html#estructura"><i class="fa fa-check"></i><b>15.3.1</b> Estructura</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="mapas.html"><a href="mapas.html#manejo-de-datos-espaciales"><i class="fa fa-check"></i><b>15.4</b> Manejo de Datos Espaciales</a><ul>
<li class="chapter" data-level="15.4.1" data-path="mapas.html"><a href="mapas.html#modificaciones"><i class="fa fa-check"></i><b>15.4.1</b> Modificaciones</a></li>
<li class="chapter" data-level="15.4.2" data-path="mapas.html"><a href="mapas.html#crear-nuevos-shapefiles-con-st_write"><i class="fa fa-check"></i><b>15.4.2</b> Crear nuevos shapefiles con <code>st_write</code></a></li>
<li class="chapter" data-level="15.4.3" data-path="mapas.html"><a href="mapas.html#incorporar-datos-de-otras-bases-con-merge"><i class="fa fa-check"></i><b>15.4.3</b> Incorporar datos de otras bases con <code>merge</code></a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="mapas.html"><a href="mapas.html#mapear-en-r"><i class="fa fa-check"></i><b>15.5</b> Mapear en R</a></li>
<li class="chapter" data-level="15.6" data-path="mapas.html"><a href="mapas.html#mapeando-variables"><i class="fa fa-check"></i><b>15.6</b> Mapeando variables</a><ul>
<li class="chapter" data-level="15.6.1" data-path="mapas.html"><a href="mapas.html#mapas-animados-con-gganimate"><i class="fa fa-check"></i><b>15.6.1</b> Mapas animados con <code>gganimate</code></a></li>
</ul></li>
<li class="chapter" data-level="15.7" data-path="mapas.html"><a href="mapas.html#inferencia-a-partir-de-datos-espaciales"><i class="fa fa-check"></i><b>15.7</b> Inferencia a partir de Datos Espaciales</a><ul>
<li class="chapter" data-level="15.7.1" data-path="mapas.html"><a href="mapas.html#indicadores-locales-de-asociacion-espacial-lisa"><i class="fa fa-check"></i><b>15.7.1</b> Indicadores locales de asociación espacial (LISA)</a></li>
<li class="chapter" data-level="15.7.2" data-path="mapas.html"><a href="mapas.html#matriz-de-pesos-espaciales"><i class="fa fa-check"></i><b>15.7.2</b> Matriz de Pesos Espaciales</a></li>
<li class="chapter" data-level="15.7.3" data-path="mapas.html"><a href="mapas.html#morans-i"><i class="fa fa-check"></i><b>15.7.3</b> Moran’s I</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">AnalizaR Datos Políticos</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manejo-av" class="section level1">
<h1><span class="header-section-number">Capítulo 9</span> Manejo avanzado de datos políticos</h1>
<p><em>Por Andrés Cruz Labrín y Francisco Urdinez</em></p>
<hr />
<p><strong>Lecturas de referencia</strong></p>
<ul>
<li><p>Lall, R. (2016). How multiple imputation makes a difference. <em>Political Analysis, 24</em>(4), 414-433.</p></li>
<li><p>Honaker, J., King, G., &amp; Blackwell, M. (2011). Amelia II: A program for missing data. <em>Journal of Statistical Software, 45</em>(7), 1-47.</p></li>
<li><p>Allison, P. D. (2001). <em>Missing data</em> (Vol. 136). Sage publications.</p></li>
<li><p>Graham, J. W. (2009). Missing data analysis: Making it work in the real world. <em>Annual Review of Psychology, 60</em>, 549-576.</p></li>
</ul>
<hr />
<div id="introduccion-3" class="section level2">
<h2><span class="header-section-number">9.1</span> Introducción</h2>
<p>En este capítulo tratamos dos problemas que son muy recurrente entre quienes usamos datos de países tomados de diferentes fuentes (<a href="https://data.worldbank.org/">World Bank Data</a>, <a href="https://www.v-dem.net/es/">V-Dem</a>, <a href="http://info.worldbank.org/governance/wgi/#home">World, Governance Indicators</a>, <a href="http://www.correlatesofwar.org/">Correlates of War</a>, etc). El primero de ellos es el de la estandarización de los “códigos” que se utiliza para cada país. Estos códigos son importantes, porque a partir de estos es que unimos dos o más bases de datos de diferentes fuentes. Piense por ejemplo el siguiente escenario: su base tiene una variable llamada “país” donde Brasil es codificado en mayúsculas como “BRASIL”. Luego toma datos del Banco Mundial y los datos de Brasil están como “Brazil”, y luego toma datos de Correlates of War donde Brasil es el código 140. Si este problema se repite para los más de 200 países de su muestra, ¿cómo resuelve de manera rápida este rompecabezas?</p>
<p>El segundo problema es que muchas veces nuestros datos tienen datos faltantes, o como se les llama comunmente, “missing values”. Cuando hay datos faltantes en una regresión <code>R</code> simplemente elimina la observación que tiene el dato faltante ya sea en su variable dependiente, independiente o controles (a esta eliminación se le llama <em>listwise deletion</em>). Imagine que queremos comparar diez países de América Latina en la evolución de su tasa de desempleo entre 2008 y 2018 y, sin embargo, uno de ellos no tiene datos para el trienio 2010-2013. ¿Podemos rellenar estos valores “adivinando” los valores que no observamos? A este proceso se le llama imputación.</p>
<p>Decidir si imputar o no es una una decisión del investigador. Que la imputación sea adecuada dependerá de si los datos sean faltantes de manera <strong>aleatoria</strong>. Este dilema se presenta cuando estos datos son usados para crear gráficos y no queremos que queden incompletos. También, en algunos modelos avanzados, como los espaciales, tener valores faltantes puede impedirnos ejecutar los comandos. Para estos casos, podemos considerar imputar estos datos, es decir, completar los datos faltantes a partir de la información que tenemos para los otros países. Hacer esto tiene un costo que discutiremos en breve, ya que, como toda solución, no es perfecta.</p>
<p>Para ejemplificar este ejercicio vamos a usar la base de datos sobre tratados internacionales creada por <a href="https://www.carstenschulz.eu/">Carsten Schulz</a> en base al repositorio de <a href="https://treaties.un.org/">Naciones Unidas con todos los tratados internacionales vigentes</a>. En este repositorio se alojan todos los tratados internacionales celebrados entre estados, con sus textos, e informaciones sobre los firmantes. La base del ejemplo está simplificada, apenas tenemos dos tratados internacionales en vez de las decenas que originalmente utiliza Schulz para estudiar qué lleva a un país a unirse a un acuerdo internacional. Los tratados del ejemplo son el Tratado de Prohibición Completa de los Ensayos Nucleares de 1996 y El Estatuto de Roma de 1998, que es el instrumento constitutivo de la Corte Penal Internacional y sólo tenemos los países del continente americano. Empezamos por cargar su base de datos, desde nuestro paquete <code>paqueteadp</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="co">## ── Attaching packages ──────────────── tidyverse 1.2.1 ──</span>
<span class="co">## ✔ ggplot2 3.1.0       ✔ purrr   0.3.1  </span>
<span class="co">## ✔ tibble  2.0.1       ✔ dplyr   0.8.0.1</span>
<span class="co">## ✔ tidyr   0.8.3       ✔ stringr 1.4.0  </span>
<span class="co">## ✔ readr   1.3.1       ✔ forcats 0.4.0</span>
<span class="co">## ── Conflicts ─────────────────── tidyverse_conflicts() ──</span>
<span class="co">## ✖ dplyr::filter() masks stats::filter()</span>
<span class="co">## ✖ dplyr::lag()    masks stats::lag()</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(paqueteadp)</code></pre>
<p>Puede demorar uno o dos minutos la carga de los datos.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(tratados_int)</code></pre>
<p>Ahora la base se ha cargado en nuestra sesión de <code>R</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()
<span class="co">## [1] &quot;tratados_int&quot;</span></code></pre>
<p>Cada tratado viene acompañado de información del proceso de incorporación doméstica del tratado, es decir, fecha de firma, aceptación, ratificación y delegación. Estas acciones están categorizadas en la variable <code>action_type_string</code> y además son acompañadas de la variable <code>action_date</code> que registra la fecha de cada acción. La variable <code>location</code> registra la ciudad donde se firmó el tratado internacional, y <code>country name</code> el nombre de cada país.</p>
<pre class="sourceCode r"><code class="sourceCode r">skimr<span class="op">::</span><span class="kw">skim</span>(tratados_int)
<span class="co">## Skim summary statistics</span>
<span class="co">##  n obs: 300 </span>
<span class="co">##  n variables: 6 </span>
<span class="co">## </span>
<span class="co">## ── Variable type:character ──────────────────────────────</span>
<span class="co">##            variable missing complete   n min max empty n_unique</span>
<span class="co">##  action_type_string       0      300 300   8  23     0        7</span>
<span class="co">##  [ reached getOption(&quot;max.print&quot;) -- omitted 3 rows ]</span>
<span class="co">## </span>
<span class="co">## ── Variable type:Date ───────────────────────────────────</span>
<span class="co">##       variable missing complete   n        min        max     median</span>
<span class="co">##    action_date     211       89 300 1996-09-24 2016-03-03 1999-03-23</span>
<span class="co">##  n_unique</span>
<span class="co">##        62</span>
<span class="co">##  [ reached getOption(&quot;max.print&quot;) -- omitted 1 row ]</span></code></pre>
</div>
<div id="como-aprovechar-countrycode" class="section level2">
<h2><span class="header-section-number">9.2</span> ¿Cómo aprovechar <code>countrycode</code>?</h2>
<p>Si leíste el Capítulo <a href="surv.html#surv">8</a> sobre modelos de supervivencia, seguramente recuerdes que utilizamos la función <code>countrycode</code> para poder crear el gráfico de Gantt con el tiempo que demoró cada país en implementar mecanismos de democracia directa. Como en ese entonces lo vimos bastante por encima, ¡hagamos otro ejemplo!</p>
<p>Teniendo la base de datos de Schulz, primero queremos agregarle a cada país el índice de capacidades materiales que codifica Correlates of War, el famoso <a href="https://es.wikipedia.org/wiki/%C3%8Dndice_compuesto_de_capacidad_nacional">índice CINC</a>. Este índice es un proxy de poder nacional tal como lo entiende la escuela del realismo, y combina seis indicadores de poder duro, a saber, consumo primario de energía, población total, población urbana, producción de acero y hierro, gasto militar y número de tropas militares. El índice varía de 0 a 1 pues representa la proporción que cada país representa del poder mundial total en un año determinado.</p>
<p>Una vez que hemos agregado estos datos a la base, queremos analizarlos pero únicamente para la región de América Latina.</p>
<p>El paquete <code>countrycode</code> nos permitirá hacerlo de manera simple: lo que hace la función es estandarizar los nombres de los países en base a códigos preexistentes como el de ISO (International Organization for Standardization), el Fondo Monetario Internacional, Naciones Unidas, el proyecto Varieties of Democracy (V-Dem), el Banco Mundial, solo por mencionar algunos. Si logramos que la base de Schulz y la base de Correlates of War identifiquen a cada país con códigos equivalentes, nos aseguraremos que al unir las dos bases de datos no perderemos información.</p>
<p>Cargamos el paquete <code>countrycode</code> y le preguntamos cuáles son los estándares que reconoce en <code>?codelist</code>. Los estándares aparecen en el cuadrante derecho de RStudio.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(countrycode)
?codelist  <span class="co">#lista todos los formatos de origen y destino que soporta el paquete</span></code></pre>
<p>Por la forma en que están registrados los países daría la sensación de que es <code>un.name.es</code>, es decir, los países están registrados con su nombre entero (que en este caso es el nombre oficial que Naciones Unidas da a cada país). Como vamos a unirlo a la base de Correlates of War querremos crear una variable que codifique cada país con la nomenclatura que ellos usan, que se llama <code>cown</code> (Correlates Of War Numbers).</p>
<pre class="sourceCode r"><code class="sourceCode r">tratados_int_estandar &lt;-<span class="st"> </span>tratados_int <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ccode =</span> <span class="kw">countrycode</span>(country_name_es, 
                             <span class="dt">origin =</span> <span class="st">&quot;un.name.es&quot;</span>, 
                             <span class="dt">dest   =</span> <span class="st">&quot;cown&quot;</span>, 
                             <span class="dt">custom_dict =</span> codelist)) 
<span class="co">## Warning in countrycode(country_name_es, origin = &quot;un.name.es&quot;, dest = &quot;cown&quot;, : Some values were not matched unambiguously: Venezuela, República Bolivariana de</span></code></pre>
<p>La variable ‘country_name_es’ de Schultz le da nombre a cada país, pero no podemos saber a priori si todos los países se adaptan al estándar que usamos (<code>un.names.es</code>). Veamos si tenemos algún <em>missing value</em> después de haber creado la variable de códigos de Correlates of War ‘ccode’.</p>
<pre class="sourceCode r"><code class="sourceCode r">tratados_int_estandar <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(ccode))
<span class="co">## # A tibble: 10 x 7</span>
<span class="co">##    treaty_name adoption_date location country_name_es action_type_str…</span>
<span class="co">##    &lt;chr&gt;       &lt;date&gt;        &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;           </span>
<span class="co">##  1 Rome Statu… 1998-07-17    Rome     Venezuela, Rep… Acceptance      </span>
<span class="co">##  2 Rome Statu… 1998-07-17    Rome     Venezuela, Rep… Accession       </span>
<span class="co">##  3 Rome Statu… 1998-07-17    Rome     Venezuela, Rep… Approval        </span>
<span class="co">##  4 Rome Statu… 1998-07-17    Rome     Venezuela, Rep… Ratification    </span>
<span class="co">##  5 Rome Statu… 1998-07-17    Rome     Venezuela, Rep… Signature       </span>
<span class="co">##  6 Rome Statu… 1998-07-17    Rome     Venezuela, Rep… Succession      </span>
<span class="co">##  7 Comprehens… 1996-09-10    New York Venezuela, Rep… Ratification    </span>
<span class="co">##  8 Comprehens… 1996-09-10    New York Venezuela, Rep… Signature       </span>
<span class="co">##  9 Comprehens… 1996-09-10    New York Venezuela, Rep… Succession      </span>
<span class="co">## 10 Comprehens… 1996-09-10    New York Venezuela, Rep… Succession to s…</span>
<span class="co">## # … with 2 more variables: action_date &lt;date&gt;, ccode &lt;int&gt;</span></code></pre>
<p>Vemos que Venezuela no ha sido unida a la base porque su <code>ccode</code> aparece como NA. Esto puede ser por dos razones: o bien el nombre estaba mal escrito y por lo tanto <code>countrycode</code> no supo identificarlo, o bien que Correlates of War no tiene códigos para este país. En este caso, la respuesta es la primera opción.</p>
<p>Schulz registra al país como “Venezuela, República Bolivariana de” y el estándar en español de Naciones Unidas <code>un.names.es</code> lo registra como “Venezuela (República Bolivariana de)”. Esta pequeña diferencia hizo con que a Venezuela no se le adjudique código. Cuando trabajes con nombres de países es casi seguro que te enfrentes a una situación como esta.</p>
<p>Para comprobar los nombres puedes chequear en los nombres oficiales que Naciones Unidas da a cada país en todos los idiomas oficiales que se obtienen en este <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;ved=2ahUKEwiRmPGu9YHgAhWsGbkGHVLYBJIQFjABegQIAhAC&amp;url=https%3A%2F%2Funstats.un.org%2Funsd%2Fgeoinfo%2FUNGEGN%2Fdocs%2F26th-gegn-docs%2FWP%2FWP54_UNGEGN%2520WG%2520Country%2520Names%2520Document%25202011.pdf&amp;usg=AOvVaw3FxPx11WUTRvKfYQZ-DCzf">link</a></p>
<p>Como <code>countrycode</code> no logró unir automáticamente a Venezuela, hay que resolver este tipo de situaciones manualmente con la opción <code>custom_match</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">tratados_int_estandar &lt;-<span class="st"> </span>tratados_int <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ccode =</span> <span class="kw">countrycode</span>(country_name_es, 
                             <span class="dt">origin =</span> <span class="st">&quot;un.name.es&quot;</span>, 
                             <span class="dt">dest   =</span> <span class="st">&quot;cown&quot;</span>, <span class="co">#cown es Correlates of War numérico </span>
                             <span class="dt">custom_dict =</span> codelist,
    <span class="dt">custom_match =</span> <span class="kw">c</span>(<span class="st">&quot;Venezuela, República Bolivariana de&quot;</span> =<span class="st"> &quot;Venezuela (República Bolivariana de)&quot;</span>)))</code></pre>
<p>Ahora veamos si se ha resuelto el problema.</p>
<pre class="sourceCode r"><code class="sourceCode r">tratados_int_estandar <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(ccode))
<span class="co">## # A tibble: 0 x 7</span>
<span class="co">## # … with 7 variables: treaty_name &lt;chr&gt;, adoption_date &lt;date&gt;,</span>
<span class="co">## #   location &lt;chr&gt;, country_name_es &lt;chr&gt;, action_type_string &lt;chr&gt;,</span>
<span class="co">## #   action_date &lt;date&gt;, ccode &lt;chr&gt;</span></code></pre>
<p>¡Perfecto!</p>
<p>Una vez que hemos creado la variable <code>ccode</code> en la base de los tratados internacionales, queremos unir la base de Schulz a Correlates of War. Nosotros bajamos los datos COW desde este <a href="http://www.correlatesofwar.org/data-sets/national-material-capabilities">link</a> y la base ya está disponible en el paquete del libro:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(cinc_cow)</code></pre>
<p>Ahora podemos chequear que la base se ha cargado en nuestra sesión de <code>R</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ls</span>()
<span class="co">## [1] &quot;cinc_cow&quot;              &quot;tratados_int&quot;          &quot;tratados_int_estandar&quot;</span></code></pre>
<p>El código que identifica a cada país es <code>ccode</code>, el mismo que creamos en la base de tratados. También tenemos <code>year</code> que denota el año, <code>milex</code> el gasto militar del país, <code>milper</code> el tamaño del ejército en hombres activos , <code>irst</code> producción de acero y hierro, <code>pec</code> consumo energético, <code>tpop</code> población total, <code>upop</code> población urbana, el <code>cinc</code> que es el índice compuesto de capacidades materiales que nos interesa, y por último <code>version</code> que es la versión de la base. Este índice refleja la fracción del poder global que cada país posee. Por ejemplo, si vemos su valor para los dos países más poderosos del mundo, Estados Unidos y China, veremos que hace algunos años China habría superado a los Estados Unidos. En la literatura de RRII existe un debate respecto a si este índice es un reflejo cabal del poder total de los estados, que podrás ver en <a href="http://as.ucpress.edu/content/45/5/687.full.pdf+html">Chan (2005)</a> y <a href="http://www.tsinghua.edu.cn/publish/iis/7236/20120308004022054904369/2006-The%20Rise%20of%20China%20and%20its%20Power%20Status.pdf">Xuetong (2006)</a>.</p>
<p>Para poder crear la figura usando <code>ggplot</code> hay que saber el código de cada país. Si te resulta útil continuar usando el estándar de COW en tus trabajos, podés bajar la lista completa de códigos en este <a href="cow.la.psu.edu/COW%20State%20list.xls">link</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">subset</span>(cinc_cow, ccode <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;710&quot;</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cinc, <span class="dt">group =</span> ccode, <span class="dt">colour =</span> stateabb))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-14"></span>
<img src="manejo-av_files/figure-html/unnamed-chunk-14-1.png" alt="Índice de capacidades materiales para Estados Unidos y China" width="480" />
<p class="caption">
Figura 9.1: Índice de capacidades materiales para Estados Unidos y China
</p>
</div>
<p>Para unir las dos bases vamos a usar la función <code>left_join</code> del paquete <code>dplyr</code>. De esta forma las estamos pegando de manera horizontal, como si a la base original de Schulz le agregáramos nuevas variables a la derecha de las que había. Sin embargo, hay un detalle a tener en consideración: la base de <code>cinc_cow</code> tiene los datos del índice CINC para más de cien años, pero nosotros aquí necesitamos los valores de cada país en el año específico en que firmaron cada tratado internacional.</p>
<p>Por suerte, dentro del gran <code>tidyverse</code> existe un paquete llamado <code>lubridate</code>. Esta función nos permite tomar una fecha, como por ejemplo en la variable <code>adoption_date</code> y a partir de ella extraer el año en que el tratado internacional fue adoptado para que el valor del índice CINC sea el de este año.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

tratados_int_estandar &lt;-<span class="st"> </span>tratados_int_estandar <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year =</span> lubridate<span class="op">::</span><span class="kw">year</span>(adoption_date)) 

base_unida &lt;-<span class="st"> </span><span class="kw">left_join</span>(tratados_int_estandar <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                          </span><span class="kw">mutate</span>(<span class="dt">ccode =</span> <span class="kw">as.character</span>(ccode)), 
                        cinc_cow <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                          </span><span class="kw">mutate</span>(<span class="dt">ccode =</span> <span class="kw">as.character</span>(ccode)), 
                        <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;ccode&quot;</span>, <span class="st">&quot;year&quot;</span>))</code></pre>
<p>Al haber unido las dos bases, queremos quedarnos únicamente con los países de América del Sur. El problema es que no tenemos una variable que registre la región de cada país. Aquí se vuele útil <code>countrycode</code> una vez más pues tiene incorporada una función por la cual reconoce a qué region pertenece cada país. Creamos la variable <code>region</code> y filtramos América del Sur.</p>
<pre class="sourceCode r"><code class="sourceCode r">base_unida &lt;-<span class="st"> </span>base_unida <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">region =</span> <span class="kw">countrycode</span>(ccode, <span class="dt">origin =</span> <span class="st">&quot;cown&quot;</span>, <span class="dt">dest =</span> <span class="st">&quot;region&quot;</span>))
<span class="co">## Warning in countrycode(ccode, origin = &quot;cown&quot;, dest = &quot;region&quot;): Some values were not matched unambiguously: VENEZUELA (REPÚBLICA BOLIVARIANA DE)</span></code></pre>
<p>Si quieres, puedes abrir la base para ver como se ve la variable <code>región</code> en este momento. Ahora, filtramos la que queremos mantener</p>
<pre class="sourceCode r"><code class="sourceCode r">base_unida_samerica &lt;-<span class="st"> </span>base_unida <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> &quot;South America&quot;</span>)</code></pre>
<p>Así, hemos logrado una base que tiene más variables que la original, y que nos permite filtrar por regiones geográficas del mundo.</p>
<p>De esta forma te hemos ejemplificado la enorme utilidad de <code>countrycode</code> y <code>lubridate</code> cuando estés armando tus bases de datos.</p>
</div>
<div id="como-imputar-datos-faltantes" class="section level2">
<h2><span class="header-section-number">9.3</span> ¿Cómo imputar datos faltantes?</h2>
<p>De manera suscita, existen cuatro tipos diferentes de datos faltantes para decidir si necesitas imputar datos recomendamos una profunda reflexión y también la lectura de los textos de Graham y Allison que están en las lecturas de referencia. Tus datos faltantes pueden ser “estructurales”, faltantes de manera <em>absolutamente</em> aleatoria (esto en la literatura se denomina MCAR), faltantes de manera <em>no</em> aleatoria y los faltantes de manera aleatoria. Solo querremos imputar cuando los datos sean faltantes de manera aleatoria.</p>
<p>Para poner un breve ejemplo de cada tipo de dato faltante, ¿qué significa que haya datos faltantes de manera estructural? En el ejemplo debajo tenemos una variable que codifica si el país tiene vigente una ley de matrimonio entre personas del mismo sexo. La variable siguiente codifica el año en que dicha ley se ha sancionado. Si te fijas, Venezuela y Perú tienen valores faltantes en esta variable, pero la razón es que <em>no tienen</em> en principio una ley de este tipo. Entonces, los datos faltantes son estructurales cuando el dato está faltando porque el dato no existe.</p>
<table>
<thead>
<tr class="header">
<th>ID</th>
<th>Ley de matrimonio igualitario</th>
<th>Año de aprobación</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Argentina</td>
<td>1</td>
<td>2010</td>
</tr>
<tr class="even">
<td>Brasil</td>
<td>1</td>
<td>2013</td>
</tr>
<tr class="odd">
<td>Venezuela</td>
<td>0</td>
<td>NA</td>
</tr>
<tr class="even">
<td>Peru</td>
<td>0</td>
<td>NA</td>
</tr>
</tbody>
</table>
<p>Tendremos datos faltantes de manera <em>absolutamente</em> aleatoria si cuando los datos fueron generados hubo algún criterio de aleatorización. Por ejemplo, si en un cuestionario de diez preguntas hemos preguntado ocho a cada persona de manera aleatoria. Las dos preguntas faltantes para cada persona no estarán explicadas por variables relacionadas al encuestado (su ideología, edad, género, religión, etc).</p>
<p>Puede darse que nuestros datos sean faltantes no aleatoriamente. Este es posiblemente el escenario más frecuente en el que equivocadamente se imputan datos en ciencia política, cuando en verdad no se debería hacer. Los datos faltantes no aleatorios son aquellos cuya condición de faltantes se correlaciona otra variable de tal forma que hay un <em>patrón</em> en la falta de datos. Cuando nos encontramos ante una situación en que faltan datos en nuestra base debemos reflexionar cuidadosamente respecto a qué variables pueden estar explicando esta falta de datos, y si es que existe un sesgo de selección. Por ejemplo, si utilizamos datos del banco mundial respecto a crecimiento del PBI es muy probable que países muy pobres no reporten datos. Esto se debe a que en estos países la calidad de las mediciones no es óptima. También puede darse que las mediciones no se han hecho si el país atraviesa un momento difícil en su economía que repercute sobre las estadísticas nacionales. Por ejemplo, desde 2016 que el Banco Mundial no reporta índices de inflación para Venezuela. Idealmente uno debería corregir este sesgo mediante una covariable en el modelo, usando modelos de selección (no los vemos en el libro, lamentablemente), o simplemente hacer <em>pairwise</em> en las regresiones sabiendo que nuestra muestra puede no ser representativa de la población.</p>
<p>Por último, si asumimos que nuestros datos son faltantes de manera aleatoria (los textos los describen como MAR) estos estarán generados sin un patrón, pero la otra información con la que contamos en la base de datos nos permitiría “adivinar” el valor faltante. Pensemos en el índice CINC, por ejemplo: imagina que tenemos veinte observaciones faltantes en el índice de los Estados Unidos. Como el índice se compone de las otras variables de capacidades materiales, podemos utilizar estas para predecir los valores que faltan.</p>
<p>Tomando este caso vamos a hacer dos escenarios de imputación. El primero es de imputación con fines descriptivos (creación de gráficos). El segundo, quizás más útil, será una imputación para aumentar la cantidad de observaciones en nuestros modelos de regresión.</p>
<p>Utilicemos como ejemplo el gráfico con el índice CINC de Estados Unidos y China solo que lo haremos con puntos para poder ver los valores año a año más facilmente.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">subset</span>(cinc_cow, ccode <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;710&quot;</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cinc, <span class="dt">group =</span> ccode, <span class="dt">colour =</span> stateabb)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1810</span>, <span class="dv">2020</span>, <span class="dv">10</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-18"></span>
<img src="manejo-av_files/figure-html/unnamed-chunk-18-1.png" alt="En vez de ver el índice de capacidades materiales como una línea vemos cada año como un punto para ver mejor datos faltantes" width="480" />
<p class="caption">
Figura 9.2: En vez de ver el índice de capacidades materiales como una línea vemos cada año como un punto para ver mejor datos faltantes
</p>
</div>
<p>¿Cómo se vería el gráfico si Estados Unidos no tuviera datos entre 1950 y 1970?
Primero eliminamos estos datos de la base</p>
<pre class="sourceCode r"><code class="sourceCode r">cinc_cow2 &lt;-<span class="st"> </span>cinc_cow <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cinc_na =</span> <span class="kw">if_else</span>(ccode <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">between</span>(year, <span class="dv">1950</span>, <span class="dv">1970</span>),
                           <span class="ot">NA_real_</span>,
                           cinc))</code></pre>
<p>Luego vemos el gráfico</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">subset</span>(cinc_cow2, ccode <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;710&quot;</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cinc_na,
                 <span class="dt">group =</span> ccode, <span class="dt">colour =</span> stateabb))  <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1810</span>, <span class="dv">2020</span>, <span class="dv">10</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))
<span class="co">## Warning: Removed 21 rows containing missing values (geom_point).</span></code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-20"></span>
<img src="manejo-av_files/figure-html/unnamed-chunk-20-1.png" alt="A la figura le faltan los datos de Estados Unidos entre 1950 y 1970" width="480" />
<p class="caption">
Figura 8.5: A la figura le faltan los datos de Estados Unidos entre 1950 y 1970
</p>
</div>
<p>Es importante en este punto hacer la reflexión del tipo de datos faltantes que tenemos. Vamos a suponer que no habría motivos para asumir que esos datos faltasen en la base, por lo tanto son faltantes aleatoriamente. Para hacer la imputación vamos a usar <code>Amelia</code>.</p>
</div>
<div id="imputar-datos-usando-amelia" class="section level2">
<h2><span class="header-section-number">9.4</span> Imputar datos usando Amelia</h2>
<p><a href="https://gking.harvard.edu/amelia">Amelia II</a> es un programa creado por Gary King, James Honaker y Matthew Blackwell. En <code>R</code> lo consigues mediante <code>install.packages(&quot;Amelia&quot;)</code>. Nos gusta mucho Amelia II, y lo preferimos sobre otros paquetes conocidos como <code>mice</code> por su facilidad, versatilidad y rapidez. El paquete está diseñado para poder indicar cuantas imputaciones queremos que se hagan para cada dato faltante (con la opción <code>m=</code>, que por defecto hace 5 imputaciones), y permite trabajar tanto con bases de datos transversales (como una encuesta) como con datos en panel, como por ejemplo en nuestro caso del índice CINC donde hay datos de muchos años para cada país.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Amelia)
<span class="co">## Loading required package: Rcpp</span>
<span class="co">## ## </span>
<span class="co">## ## Amelia II: Multiple Imputation</span>
<span class="co">## ## (Version 1.7.5, built: 2018-05-07)</span>
<span class="co">## ## Copyright (C) 2005-2019 James Honaker, Gary King and Matthew Blackwell</span>
<span class="co">## ## Refer to http://gking.harvard.edu/amelia/ for more information</span>
<span class="co">## ##</span></code></pre>
<p>Lo primero que querrás confirmar es la cantidad de datos faltantes en tu variable de interés. Para esto recomendamos usar la función <code>skim</code>de <code>skimr</code>. En la variable <code>cinc_na</code> tenemos veinte datos faltantes más que en la variable <code>cinc</code>, que son las observaciones que acabamos de eliminar para hacer el ejemplo.</p>
<pre class="sourceCode r"><code class="sourceCode r">skimr<span class="op">::</span><span class="kw">skim</span>(cinc_cow2)
<span class="co">## Skim summary statistics</span>
<span class="co">##  n obs: 14124 </span>
<span class="co">##  n variables: 12 </span>
<span class="co">## </span>
<span class="co">## ── Variable type:character ──────────────────────────────</span>
<span class="co">##  variable missing complete     n min max empty n_unique</span>
<span class="co">##  stateabb    1937    12187 14124   3   3     0      159</span>
<span class="co">## </span>
<span class="co">## ── Variable type:numeric ────────────────────────────────</span>
<span class="co">##  variable missing complete     n        mean           sd         p0</span>
<span class="co">##         p25        p50         p75          p100     hist</span>
<span class="co">##  [ reached getOption(&quot;max.print&quot;) -- omitted 11 rows ]</span></code></pre>
<p>El segundo paso en la imputación consiste en elegir las variables que utilizarás. Solo necesitas tu variable temporal (<code>year</code>), el ID de cada observación (en este caso tenemos dos: <code>stateabb</code> y <code>ccode</code>) y las variables con las que harás las predicciones de los valores. Dejaremos fuera del análisis a <code>version</code> que es una variable que siempre asume el valor 2011 porque indica el año de la versión de los datos y también eliminaremos <code>cinc</code> que es la variable sin datos faltantes. Llamaremos a este conjunto de variables <code>cinc_cow2_amelia</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">cinc_cow2_amelia &lt;-<span class="st"> </span>cinc_cow2 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st"> </span><span class="kw">select</span>(ccode, stateabb, year, milex, milper, 
        irst, pec, tpop, upop, cinc_na)</code></pre>
<p>Para asegurarnos que nuestra base esté en formato de <em>data frame</em> haremos el siguiente paso</p>
<pre class="sourceCode r"><code class="sourceCode r">cinc_cow2_amelia &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cinc_cow2_amelia)</code></pre>
<p>Llamaremos a la imputación <code>imputado_m1</code>. Para hacer la imputación vamos a necesitar indicar a <code>Amelia</code> algunas opciones del comando: <code>cs</code> es la variable que identifica a las observaciones, en este caso los países. <code>ts</code> es la variable temporal, en este caso el año. <code>m</code> es la cantidad de imputaciones que queremos que simule <code>amelia</code>. Le pediremos que haga una sola, y ahora veremos un ejemplo con 4 imputaciones. Con la opción <code>idvars</code> estamos indicando al comando que la variable <code>ccode</code> identifica a los países, por lo que no debe ser tenida en cuenta en el cálculo de los valores faltantes. Por último, la opción <code>polytime</code> incorpora un término extra a la imputación para dar cuenta de los efectos temporales de los valores. En nuestro caso esta opción es fundamental pues todos los valores faltantes corresponden a veinte años consecutivos. Si definimos la opción <code>1</code> se incorpora un término que modela efectos temporales <em>lineares</em>, si definimos la opción <code>2</code> se modelan efectos cuadráticos, y si definimos la opción <code>3</code> se modelan efectos cúbicos.</p>
<pre class="sourceCode r"><code class="sourceCode r">imputado_m1 &lt;-<span class="st"> </span><span class="kw">amelia</span>(<span class="dt">x =</span> cinc_cow2_amelia, <span class="dt">cs =</span> <span class="st">&quot;stateabb&quot;</span>, <span class="dt">ts =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">m =</span> <span class="dv">1</span>, <span class="dt">idvars =</span> <span class="st">&quot;ccode&quot;</span>, <span class="dt">polytime=</span><span class="dv">1</span>)
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets. </span>
<span class="co">## -- Imputation 1 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="kw">summary</span>(imputado_m1)
<span class="co">## </span>
<span class="co">## Amelia output with 1 imputed datasets.</span>
<span class="co">## Return code:  1 </span>
<span class="co">## Message:  Normal EM convergence. </span>
<span class="co">## </span>
<span class="co">## Chain Lengths:</span>
<span class="co">## --------------</span>
<span class="co">## Imputation 1:  2</span>
<span class="co">## </span>
<span class="co">## Rows after Listwise Deletion:  12166 </span>
<span class="co">## Rows after Imputation:  12187 </span>
<span class="co">## Patterns of missingness in the data:  3 </span>
<span class="co">## </span>
<span class="co">## Fraction Missing for original variables: </span>
<span class="co">## -----------------------------------------</span>
<span class="co">## </span>
<span class="co">##          Fraction Missing</span>
<span class="co">## ccode                0.14</span>
<span class="co">## stateabb             0.14</span>
<span class="co">## year                 0.14</span>
<span class="co">## milex                0.14</span>
<span class="co">## milper               0.14</span>
<span class="co">## irst                 0.14</span>
<span class="co">## pec                  0.14</span>
<span class="co">## tpop                 0.14</span>
<span class="co">##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 2 rows ]</span></code></pre>
<p>Una vez realizada la imputación, la graficaremos para ver cómo se ven nuestros datos. La imputación ha sido guardada como un objeto llamado <code>imp1</code>, así que le damos un nombre.</p>
<pre class="sourceCode r"><code class="sourceCode r">datos_imputados&lt;-imputado_m1<span class="op">$</span>imputations<span class="op">$</span>imp1 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">subset</span>(datos_imputados, ccode <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;710&quot;</span>))) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cinc_na,
                 <span class="dt">group =</span> ccode, <span class="dt">colour =</span> stateabb))  <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1810</span>, <span class="dv">2020</span>, <span class="dv">10</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),
        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))
     </code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-27"></span>
<img src="manejo-av_files/figure-html/unnamed-chunk-27-1.png" alt="Los valores entre 1950 y 1970 para EEUU han sido imputados con `Amelia`" width="480" />
<p class="caption">
Figura 9.3: Los valores entre 1950 y 1970 para EEUU han sido imputados con <code>Amelia</code>
</p>
</div>
<p>Ahora haremos la simulación definiendo cuatro imputaciones en vez de una. Para ello, repetiremos el proceso, con la única diferencia que en la opción <code>m</code> indicaremos 4 en vez de 1.</p>
<pre class="sourceCode r"><code class="sourceCode r">cinc_cow2_amelia &lt;-<span class="st"> </span>cinc_cow2 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st"> </span><span class="kw">select</span>(ccode, stateabb, year, milex, milper, irst, pec, tpop, upop, cinc_na)


cinc_cow2_amelia &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(cinc_cow2_amelia)

<span class="kw">set.seed</span>(<span class="dv">9999</span>) 
imputado_m4 &lt;-<span class="st"> </span><span class="kw">amelia</span>(<span class="dt">x =</span> cinc_cow2_amelia, 
                   <span class="dt">cs =</span> <span class="st">&quot;stateabb&quot;</span>, <span class="dt">ts =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">m =</span> <span class="dv">4</span>, <span class="dt">idvars =</span> <span class="st">&quot;ccode&quot;</span>, <span class="dt">polytime=</span><span class="dv">2</span>)
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets. </span>
<span class="co">## -- Imputation 1 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 2 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 3 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 4 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>

<span class="kw">summary</span>(imputado_m4)
<span class="co">## </span>
<span class="co">## Amelia output with 4 imputed datasets.</span>
<span class="co">## Return code:  1 </span>
<span class="co">## Message:  Normal EM convergence. </span>
<span class="co">## </span>
<span class="co">## Chain Lengths:</span>
<span class="co">## --------------</span>
<span class="co">## Imputation 1:  2</span>
<span class="co">## Imputation 2:  2</span>
<span class="co">## Imputation 3:  2</span>
<span class="co">## Imputation 4:  2</span>
<span class="co">## </span>
<span class="co">## Rows after Listwise Deletion:  12166 </span>
<span class="co">## Rows after Imputation:  12187 </span>
<span class="co">## Patterns of missingness in the data:  3 </span>
<span class="co">## </span>
<span class="co">## Fraction Missing for original variables: </span>
<span class="co">## -----------------------------------------</span>
<span class="co">## </span>
<span class="co">##          Fraction Missing</span>
<span class="co">## ccode                0.14</span>
<span class="co">## stateabb             0.14</span>
<span class="co">## year                 0.14</span>
<span class="co">## milex                0.14</span>
<span class="co">## milper               0.14</span>
<span class="co">## irst                 0.14</span>
<span class="co">## pec                  0.14</span>
<span class="co">## tpop                 0.14</span>
<span class="co">##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 2 rows ]</span>

datos_imputados_<span class="dv">1</span>&lt;-imputado_m4<span class="op">$</span>imputations<span class="op">$</span>imp1 
datos_imputados_<span class="dv">2</span>&lt;-imputado_m4<span class="op">$</span>imputations<span class="op">$</span>imp2 
datos_imputados_<span class="dv">3</span>&lt;-imputado_m4<span class="op">$</span>imputations<span class="op">$</span>imp3 
datos_imputados_<span class="dv">4</span>&lt;-imputado_m4<span class="op">$</span>imputations<span class="op">$</span>imp4 </code></pre>
<p>Hemos llamado a cada una de las imputaciones como <code>datos_imputados</code> y lo que haremos a continuación en unirlos a todos en un solo data frame.</p>
<pre class="sourceCode r"><code class="sourceCode r">imputaciones_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(
  datos_imputados_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">imp =</span> <span class="st">&quot;1&quot;</span>, <span class="dt">obs_original =</span> <span class="kw">row_number</span>()),
  datos_imputados_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">imp =</span> <span class="st">&quot;2&quot;</span>, <span class="dt">obs_original =</span> <span class="kw">row_number</span>()),
  datos_imputados_<span class="dv">3</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">imp =</span> <span class="st">&quot;3&quot;</span>, <span class="dt">obs_original =</span> <span class="kw">row_number</span>()),
  datos_imputados_<span class="dv">4</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">imp =</span> <span class="st">&quot;4&quot;</span>, <span class="dt">obs_original =</span> <span class="kw">row_number</span>())
) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(obs_original, imp, <span class="kw">everything</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(ccode <span class="op">==</span><span class="st"> &quot;2&quot;</span>, <span class="kw">between</span>(year, <span class="dv">1950</span>, <span class="dv">1970</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fuente =</span> <span class="st">&quot;imputaciones_4&quot;</span>)</code></pre>
<p>Para poder analizar los datos imputados de manera gráfica haremos un promedio de las imputaciones.</p>
<pre class="sourceCode r"><code class="sourceCode r">imputaciones_promedio &lt;-<span class="st"> </span>imputaciones_<span class="dv">4</span> <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(ccode, stateabb, year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">cinc_na       =</span> <span class="kw">mean</span>(cinc_na)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fuente =</span> <span class="st">&quot;imputaciones_promedio&quot;</span>)</code></pre>
<p>Unimos las cuatro imputaciones a su promedio.</p>
<pre class="sourceCode r"><code class="sourceCode r">plot_df &lt;-<span class="st"> </span>cinc_cow2 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(ccode, stateabb, year, cinc_na) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(ccode <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;2&quot;</span>, <span class="st">&quot;710&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">fuente =</span> <span class="st">&quot;original&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">bind_rows</span>(imputaciones_<span class="dv">4</span>, imputaciones_promedio)</code></pre>
<p>La figura muestra en valores claros las imputaciones individuales, y en un tono más oscuro el valor promedio de las cuatro imputaciones.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cinc_na, <span class="dt">group =</span> ccode)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plot_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(fuente <span class="op">==</span><span class="st"> &quot;original&quot;</span>), 
             <span class="kw">aes</span>(<span class="dt">color =</span> stateabb))  <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plot_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(fuente <span class="op">==</span><span class="st"> &quot;imputaciones_4&quot;</span>),
             <span class="kw">aes</span>(<span class="dt">color =</span> fuente, <span class="dt">shape =</span> imp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> plot_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(fuente <span class="op">==</span><span class="st"> &quot;imputaciones_promedio&quot;</span>),
             <span class="kw">aes</span>(<span class="dt">color =</span> fuente)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1810</span>, <span class="dv">2020</span>, <span class="dv">10</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="st">&quot;CHN&quot;</span>, <span class="st">&quot;USA&quot;</span>, 
                                <span class="st">&quot;imputaciones_4&quot;</span>,
                                <span class="st">&quot;imputaciones_promedio&quot;</span>),
                     <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;China&quot;</span>, <span class="st">&quot;USA&quot;</span>, 
                                <span class="st">&quot;USA (4 imputaciones)&quot;</span>,
                                 <span class="st">&quot;USA (prom. imputaciones)&quot;</span>),
                     <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;CHN&quot;</span> =<span class="st"> &quot;#F8766D&quot;</span>, <span class="st">&quot;USA&quot;</span> =<span class="st"> &quot;turquoise3&quot;</span>, 
                                <span class="st">&quot;imputaciones_4&quot;</span> =<span class="st"> &quot;lightsteelblue3&quot;</span>, 
                                <span class="st">&quot;imputaciones_promedio&quot;</span> =<span class="st">&quot;navyblue&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;País&quot;</span>,
       <span class="dt">shape =</span> <span class="st">&quot;Número de imputación&quot;) +</span>
<span class="st">  theme(panel.grid.minor = element_blank(),</span>
<span class="st">        axis.text.x = element_text(angle = 90, hjust = 1)) +</span>
<span class="st">  guides(color  = guide_legend(order = 1), </span>
<span class="st">         shape  = guide_legend(order = 2))</span>
<span class="st">## Warning: Removed 21 rows containing missing values (geom_point).</span></code></pre>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-32"></span>
<img src="manejo-av_files/figure-html/unnamed-chunk-32-1.png" alt="Esta figura refleja las cuatro imputaciones que hicimos con `amelia` junto a su promedio" width="480" />
<p class="caption">
Figura 6.8: Esta figura refleja las cuatro imputaciones que hicimos con <code>amelia</code> junto a su promedio
</p>
</div>
<p>Es importante repetir aquí que el ejercicio de imputación cuando hagamos trabajos descriptivos es diferente al ejercicio cuando imputemos para rodar regresiones.</p>
<div class="figure" style="text-align: center"><span id="fig:imp"></span>
<img src="00-images/imputa_1.PNG" alt="El proceso de imputación para análisis visual se hace luego de promediar las imputaciones que hayamos pedido a Amelia" width="60%" />
<p class="caption">
Figura 9.4: El proceso de imputación para análisis visual se hace luego de promediar las imputaciones que hayamos pedido a Amelia
</p>
</div>
<p>De esta forma hemos visto como completar bases de datos con valores faltantes, ya sea mediante una o más imputaciones usando <code>amelia</code>.</p>
<div id="diagnosticos" class="section level3">
<h3><span class="header-section-number">9.4.1</span> Diagnosticos</h3>
<p>El paquete nos ofrece también una herramienta para comparar más de una imputación, si es que no estamos seguros respecto a cuál utilizar. Por ejemplo, supongamos que no sabemos si los efectos temporales serían mejor ajustados con efectos lineares, cuadráticos o cúbicos. Mediante la función <code>tscsPlot</code> veremos el promedio de las imputaciones con su respectivo intérvalo de confianza.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Efectos temporales lineales</span>
imputado_m4_p1 &lt;-<span class="st"> </span><span class="kw">amelia</span>(<span class="dt">x =</span> cinc_cow2_amelia, 
                   <span class="dt">cs =</span> <span class="st">&quot;stateabb&quot;</span>, <span class="dt">ts =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">m =</span> <span class="dv">4</span>, <span class="dt">idvars =</span> <span class="st">&quot;ccode&quot;</span>, <span class="dt">polytime=</span><span class="dv">1</span>)
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets. </span>
<span class="co">## -- Imputation 1 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 2 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 3 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 4 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>

<span class="kw">tscsPlot</span>(imputado_m4_p1, <span class="dt">cs =</span> <span class="kw">c</span>(<span class="st">&quot;USA&quot;</span>), <span class="dt">var =</span> <span class="st">&quot;cinc_na&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Valores imputados para con polytime=1&quot;</span>) 
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets.</span>
 
<span class="co">#Efectos temporales cuadráticos</span>
imputado_m4_p2 &lt;-<span class="st"> </span><span class="kw">amelia</span>(<span class="dt">x =</span> cinc_cow2_amelia, 
                   <span class="dt">cs =</span> <span class="st">&quot;stateabb&quot;</span>, <span class="dt">ts =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">m =</span> <span class="dv">4</span>, <span class="dt">idvars =</span> <span class="st">&quot;ccode&quot;</span>, <span class="dt">polytime=</span><span class="dv">2</span>)
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets. </span>
<span class="co">## -- Imputation 1 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 2 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 3 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 4 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>

<span class="kw">tscsPlot</span>(imputado_m4_p2, <span class="dt">cs =</span> <span class="kw">c</span>(<span class="st">&quot;USA&quot;</span>), <span class="dt">var =</span> <span class="st">&quot;cinc_na&quot;</span>, <span class="dt">main=</span><span class="st">&quot; Valores imputados con polytime=2&quot;</span>) 
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets.</span>


<span class="co"># Efectos temporales cúbicos</span>
imputado_m4_p3 &lt;-<span class="st"> </span><span class="kw">amelia</span>(<span class="dt">x =</span> cinc_cow2_amelia, 
                   <span class="dt">cs =</span> <span class="st">&quot;stateabb&quot;</span>, <span class="dt">ts =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">m =</span> <span class="dv">4</span>, <span class="dt">idvars =</span> <span class="st">&quot;ccode&quot;</span>, <span class="dt">polytime=</span><span class="dv">3</span>)
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets. </span>
<span class="co">## -- Imputation 1 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 2 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 3 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>
<span class="co">## </span>
<span class="co">## -- Imputation 4 --</span>
<span class="co">## </span>
<span class="co">##   1  2</span>

 <span class="kw">tscsPlot</span>(imputado_m4_p3, <span class="dt">cs =</span> <span class="kw">c</span>(<span class="st">&quot;USA&quot;</span>), <span class="dt">var =</span> <span class="st">&quot;cinc_na&quot;</span>, <span class="dt">main=</span><span class="st">&quot; Valores imputados con polytime=1&quot;</span>) 
<span class="co">## Warning: There are observations in the data that are completely missing. </span>
<span class="co">##          These observations will remain unimputed in the final datasets.</span></code></pre>
<p><img src="manejo-av_files/figure-html/unnamed-chunk-33-1.png" width="480" height="80%" style="display: block; margin: auto;" /><img src="manejo-av_files/figure-html/unnamed-chunk-33-2.png" width="480" height="80%" style="display: block; margin: auto;" /><img src="manejo-av_files/figure-html/unnamed-chunk-33-3.png" width="480" height="80%" style="display: block; margin: auto;" />
En este caso no hay una diferencia notable entre las tres opciones. Cuando la cantidad de datos faltantes son más, es posible que sea necesario evaluar varias versiones de la imputación para decidir cuál utilizar.</p>
</div>
</div>
<div id="regresiones-luego-de-imputar-datos" class="section level2">
<h2><span class="header-section-number">9.5</span> Regresiones luego de imputar datos</h2>
<p>A diferencia del proceso para visualización de datos, cuando queremos imputar datos que utilizaremos en análisis de regresiones lo que recomienda la lectura es no promediar las imputaciones, sino promediar los coeficientes de las regresiones obtenidos con cada una de las imputaciones que hemos hecho. El proceso es el siguiente</p>
<div class="figure" style="text-align: center"><span id="fig:imputa3"></span>
<img src="00-images/imputa_2.PNG" alt="El proceso de imputación para análisis de regresión consiste en promediar los coeficientes de los datos imputados, no promediar las bases imputadas." width="60%" />
<p class="caption">
Figura 9.5: El proceso de imputación para análisis de regresión consiste en promediar los coeficientes de los datos imputados, no promediar las bases imputadas.
</p>
</div>
<p>Primero, veamos como se ve la regresión con los datos incompletos para Estados Unidos. Estaremos explicando el índice CINC de cada país por las variables <code>pec</code> y <code>upop</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">modelo_incompleto &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">I</span>(cinc_na<span class="op">*</span><span class="dv">100</span>) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(pec <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">I</span>(upop <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>), <span class="dt">data =</span> cinc_cow2)

texreg<span class="op">::</span><span class="kw">screenreg</span>(modelo_incompleto)
<span class="co">## </span>
<span class="co">## ==========================</span>
<span class="co">##               Model 1     </span>
<span class="co">## --------------------------</span>
<span class="co">## (Intercept)       1.11 ***</span>
<span class="co">##                  (0.03)   </span>
<span class="co">## I(pec/1000)       0.01 ***</span>
<span class="co">##                  (0.00)   </span>
<span class="co">## I(upop/1000)      0.02 ***</span>
<span class="co">##                  (0.00)   </span>
<span class="co">## --------------------------</span>
<span class="co">## R^2               0.18    </span>
<span class="co">## Adj. R^2          0.18    </span>
<span class="co">## Num. obs.     12166       </span>
<span class="co">## RMSE              3.60    </span>
<span class="co">## ==========================</span>
<span class="co">## *** p &lt; 0.001, ** p &lt; 0.01, * p &lt; 0.05</span></code></pre>
<p>Estamos usando el data frame que llamamos <code>imputaciones_4</code> donde guardamos las cuatro imputaciones (<code>imp1</code>, <code>imp2</code>, <code>imp3</code> e <code>imp4</code>) que hicimos en el ejercicio anterior. Haremos una regresión para cada una de las cuatro imputaciones.</p>
<pre class="sourceCode r"><code class="sourceCode r">modelo_imputado_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">I</span>(cinc_na<span class="op">*</span><span class="dv">100</span>) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(pec <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">I</span>(upop <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>), 
                        <span class="dt">data =</span> imputado_m4<span class="op">$</span>imputations<span class="op">$</span><span class="st">&quot;imp1&quot;</span>)

modelo_imputado_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">I</span>(cinc_na<span class="op">*</span><span class="dv">100</span>) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(pec <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">I</span>(upop <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>),
                        <span class="dt">data =</span> imputado_m4<span class="op">$</span>imputations<span class="op">$</span><span class="st">&quot;imp2&quot;</span>)

modelo_imputado_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">I</span>(cinc_na<span class="op">*</span><span class="dv">100</span>) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(pec <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">I</span>(upop <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>),
                        <span class="dt">data =</span> imputado_m4<span class="op">$</span>imputations<span class="op">$</span><span class="st">&quot;imp3&quot;</span>)

modelo_imputado_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">I</span>(cinc_na<span class="op">*</span><span class="dv">100</span>) <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(pec <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">                        </span><span class="kw">I</span>(upop <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>),
                        <span class="dt">data =</span> imputado_m4<span class="op">$</span>imputations<span class="op">$</span><span class="st">&quot;imp4&quot;</span>)


lista_modelos &lt;-<span class="st"> </span><span class="kw">list</span>(modelo_imputado_<span class="dv">1</span>, modelo_imputado_<span class="dv">2</span>,
                      modelo_imputado_<span class="dv">3</span>, modelo_imputado_<span class="dv">4</span>)</code></pre>
<p>Al correr las regresiones las guardamos todas en una lista que llamaremos <code>lista_modelos</code> y luego extraeremos de ella los coeficientes y los errores estándar de cada uno de ellos con la siguiente función</p>
<pre class="sourceCode r"><code class="sourceCode r">df_coefs &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(lista_modelos,
                    <span class="op">~</span><span class="st"> </span><span class="kw">coef</span>(.x) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>())
df_se &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(lista_modelos,
                 <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">diag</span>(<span class="kw">vcov</span>(.x))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">bind_rows</span>())</code></pre>
<p>La función <code>mi.meld</code> del paquete de <code>amelia</code> nos permite combinar todos los coeficientes de las diferentes imputaciones. Luego, para evitar errores en el comando, indicamos que los valores extraídos son numéricos.</p>
<pre class="sourceCode r"><code class="sourceCode r">res_imputado &lt;-<span class="st"> </span><span class="kw">mi.meld</span>(df_coefs, df_se)

coefs_imputados &lt;-<span class="st"> </span>res_imputado[[<span class="st">&quot;q.mi&quot;</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()
se_imputados &lt;-<span class="st"> </span>res_imputado[[<span class="st">&quot;se.mi&quot;</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()</code></pre>
<p>¡Ya estamos cerca! Con los coeficientes y sus respectivos errores estándar podemos calcular la significancia estadística de cada uno de ellos</p>
<pre class="sourceCode r"><code class="sourceCode r">p_values_imputados &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">pt</span>(coefs_imputados <span class="op">/</span><span class="st"> </span>se_imputados, 
                             modelo_imputado_<span class="dv">1</span><span class="op">$</span>df.residual, 
                             <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</code></pre>
<p>Una vez que tenemos todo lo que necesitamos, podemos crear un elemento, que llamamos <code>e_modelo_imputado</code> para poder crear la tabla de <code>texreg</code></p>
<pre class="sourceCode r"><code class="sourceCode r">e_modelo_imputado &lt;-<span class="st"> </span>texreg<span class="op">::</span><span class="kw">extract</span>(modelo_incompleto, 
                                     <span class="dt">include.rsquared =</span> F, 
                                     <span class="dt">include.adjrs    =</span> F, 
                                     <span class="dt">include.rmse     =</span> F)

e_modelo_imputado<span class="op">@</span>gof &lt;-<span class="st"> </span><span class="kw">nobs</span>(modelo_imputado_<span class="dv">1</span>)
e_modelo_imputado<span class="op">@</span>coef &lt;-<span class="st"> </span>coefs_imputados
e_modelo_imputado<span class="op">@</span>se &lt;-<span class="st"> </span>se_imputados
e_modelo_imputado<span class="op">@</span>pvalues &lt;-<span class="st"> </span>p_values_imputados</code></pre>
<p>Finalmente logramos lo que buscábamos. Una regresión donde tenemos más observaciones gracias al proceso de imputación que hemos hecho. En este caso la diferencia de observaciones es muy pequeña, pues pasamos de 12165 a 12187, con casi ninguna diferencia en los coeficientes. Cuando el porcentaje de valores faltantes sea mayor, notarás que el esfuerzo de la imputación hace una diferencia en los resultados.</p>
<pre class="sourceCode r"><code class="sourceCode r">texreg<span class="op">::</span><span class="kw">screenreg</span>(<span class="kw">list</span>(modelo_incompleto, e_modelo_imputado))
<span class="co">## </span>
<span class="co">## ========================================</span>
<span class="co">##               Model 1       Model 2     </span>
<span class="co">## ----------------------------------------</span>
<span class="co">## (Intercept)       1.11 ***      1.11 ***</span>
<span class="co">##                  (0.03)        (0.03)   </span>
<span class="co">## I(pec/1000)       0.01 ***      0.01 ***</span>
<span class="co">##                  (0.00)        (0.00)   </span>
<span class="co">## I(upop/1000)      0.02 ***      0.01 ***</span>
<span class="co">##                  (0.00)        (0.00)   </span>
<span class="co">## ----------------------------------------</span>
<span class="co">## R^2               0.18                  </span>
<span class="co">## Adj. R^2          0.18                  </span>
<span class="co">## Num. obs.     12166         12187       </span>
<span class="co">## RMSE              3.60                  </span>
<span class="co">## ========================================</span>
<span class="co">## *** p &lt; 0.001, ** p &lt; 0.01, * p &lt; 0.05</span></code></pre>
<p>¡Esperamos que hayas encontrado útil el capítulo! Si te interesa profundizar sobre el trabajo con valores faltantes te recomendamos que leas el texto de James Honaker y Gary King <a href="http://gking.harvard.edu/files/pr.pdf">“What to do About Missing Values in Time Series Cross-Section Data” American Journal of Political Science Vol. 54, No. 2 (April, 2010): Pp. 561-581.</a>.</p>
<div class="books">
<p>
<strong>Ejercicios antes de continuar al próximo capítulo</strong>
</p>
<ul>
<li>
<p>
A la base que hemos llamado <code>base_unida</code> agregale una variable de tu elección bajada de Worldwide Governance Indicators. Usa el paquete <code>coutrycode</code> para unir las variables.
</p>
</li>
<li>
<p>
En vez de 4 imputaciones, repite el ejercicio de utilizar datos imputados para modelos de regresión pero esta vez con 6 imputaciones.
</p>
</li>
</ul>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="surv.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pca.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "night",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/arcruz0/libroadp/edit/master/manejo-av.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
