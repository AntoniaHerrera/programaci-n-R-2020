<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>05A - Manejo avanzado de datos | Programación para las Ciencias Sociales</title>
  <meta name="description" content="Sitio web ICP0506" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="05A - Manejo avanzado de datos | Programación para las Ciencias Sociales" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Sitio web ICP0506" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="05A - Manejo avanzado de datos | Programación para las Ciencias Sociales" />
  
  <meta name="twitter:description" content="Sitio web ICP0506" />
  

<meta name="author" content="Andrés Cruz" />


<meta name="date" content="2020-10-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="busqueda-ayuda.html"/>
<link rel="next" href="manejo-av-ej.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Prog. Cs. Sociales</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Inicio</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#links-importantes"><i class="fa fa-check"></i>Links importantes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#cronograma-y-materiales-del-curso"><i class="fa fa-check"></i>Cronograma y materiales del curso</a></li>
</ul></li>
<li class="part"><span><b>I Intro a R, RStudio y R Markdown</b></span></li>
<li class="chapter" data-level="" data-path="rbasico.html"><a href="rbasico.html"><i class="fa fa-check"></i>01 - R básico</a><ul>
<li class="chapter" data-level="" data-path="rbasico.html"><a href="rbasico.html#introducción-comandos-y-código"><i class="fa fa-check"></i>Introducción: comandos y código</a></li>
<li class="chapter" data-level="" data-path="rbasico.html"><a href="rbasico.html#paquetes"><i class="fa fa-check"></i>Paquetes</a></li>
<li class="chapter" data-level="" data-path="rbasico.html"><a href="rbasico.html#comandos-básicos-y-tipos-de-objeto-en-r"><i class="fa fa-check"></i>Comandos básicos y tipos de objeto en R</a></li>
<li class="chapter" data-level="" data-path="rbasico.html"><a href="rbasico.html#sintaxis-de-r-markdown"><i class="fa fa-check"></i>Sintaxis de R Markdown</a></li>
<li class="chapter" data-level="" data-path="rbasico.html"><a href="rbasico.html#siguiente-script"><i class="fa fa-check"></i>Siguiente script</a></li>
</ul></li>
<li class="part"><span><b>II Manejo de datos</b></span></li>
<li class="chapter" data-level="" data-path="manejo-2a.html"><a href="manejo-2a.html"><i class="fa fa-check"></i>02A - Manejo de datos</a><ul>
<li class="chapter" data-level="" data-path="manejo-2a.html"><a href="manejo-2a.html#repaso-de-la-clase-pasada-r-markdown"><i class="fa fa-check"></i>Repaso de la clase pasada: R Markdown</a></li>
<li class="chapter" data-level="" data-path="manejo-2a.html"><a href="manejo-2a.html#manejo-de-bases-de-datos"><i class="fa fa-check"></i>Manejo de bases de datos</a></li>
<li class="chapter" data-level="" data-path="manejo-2a.html"><a href="manejo-2a.html#la-base-de-datos-ideal-tidy"><i class="fa fa-check"></i>La base de datos ideal: tidy</a></li>
<li><a href="manejo-2a.html#operaciones-básicas-en-bases-de-datos-wickham-2014">Operaciones básicas en bases de datos <span>(Wickham, 2014)</span></a></li>
<li class="chapter" data-level="" data-path="manejo-2a.html"><a href="manejo-2a.html#trabajo-con-r"><i class="fa fa-check"></i>Trabajo con R</a></li>
<li class="chapter" data-level="" data-path="manejo-2a.html"><a href="manejo-2a.html#manejo-de-datos-operaciones-básicas"><i class="fa fa-check"></i>Manejo de datos: operaciones básicas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html"><i class="fa fa-check"></i>02B - Manejo de datos (ejercicio)</a><ul>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#contexto"><i class="fa fa-check"></i>Contexto</a></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#a."><i class="fa fa-check"></i>A.</a></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#b."><i class="fa fa-check"></i>B.</a></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#c."><i class="fa fa-check"></i>C.</a></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#d."><i class="fa fa-check"></i>D.</a></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#e."><i class="fa fa-check"></i>E.</a></li>
<li class="chapter" data-level="" data-path="manejo-2b.html"><a href="manejo-2b.html#f."><i class="fa fa-check"></i>F.</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="manejo-2c.html"><a href="manejo-2c.html"><i class="fa fa-check"></i>02C - Manejo de datos (extras)</a><ul>
<li class="chapter" data-level="" data-path="manejo-2c.html"><a href="manejo-2c.html#cargar-y-guardar-bases-de-datos"><i class="fa fa-check"></i>Cargar y guardar bases de datos</a></li>
<li><a href="manejo-2c.html#versiones-iterativas-de-summarize-y-mutate">Versiones iterativas de <code>summarize()</code> y <code>mutate()</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="manejo-2d.html"><a href="manejo-2d.html"><i class="fa fa-check"></i>02D - Manejo de datos (ejercicio int.)</a></li>
<li class="part"><span><b>III Visualización de datos</b></span></li>
<li class="chapter" data-level="" data-path="visualizacion-preceptos.html"><a href="visualizacion-preceptos.html"><i class="fa fa-check"></i>03 - Visualización de datos (preceptos)</a></li>
<li class="chapter" data-level="" data-path="visualizacion-intro.html"><a href="visualizacion-intro.html"><i class="fa fa-check"></i>03A - Visualización de datos (intro)</a><ul>
<li class="chapter" data-level="" data-path="visualizacion-intro.html"><a href="visualizacion-intro.html#inicio-cargar-paquetes-base-de-datos"><i class="fa fa-check"></i>Inicio: cargar paquetes, base de datos</a></li>
<li class="chapter" data-level="" data-path="visualizacion-intro.html"><a href="visualizacion-intro.html#gráficos-univariados"><i class="fa fa-check"></i>Gráficos univariados</a></li>
<li class="chapter" data-level="" data-path="visualizacion-intro.html"><a href="visualizacion-intro.html#gráficos-bivariados"><i class="fa fa-check"></i>Gráficos bivariados</a></li>
<li class="chapter" data-level="" data-path="visualizacion-intro.html"><a href="visualizacion-intro.html#un-poco-de-personalización-etiquetas"><i class="fa fa-check"></i>Un poco de personalización: etiquetas</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualizacion-ext.html"><a href="visualizacion-ext.html"><i class="fa fa-check"></i>03B - Visualización de datos (extensiones)</a><ul>
<li class="chapter" data-level="" data-path="visualizacion-ext.html"><a href="visualizacion-ext.html#cargar-paquetes-y-datos"><i class="fa fa-check"></i>Cargar paquetes y datos</a></li>
<li class="chapter" data-level="" data-path="visualizacion-ext.html"><a href="visualizacion-ext.html#gráfico-de-ránking"><i class="fa fa-check"></i>Gráfico de ránking</a></li>
<li class="chapter" data-level="" data-path="visualizacion-ext.html"><a href="visualizacion-ext.html#facetas"><i class="fa fa-check"></i>Facetas</a></li>
<li class="chapter" data-level="" data-path="visualizacion-ext.html"><a href="visualizacion-ext.html#gráficos-de-líneas"><i class="fa fa-check"></i>Gráficos de líneas</a></li>
<li class="chapter" data-level="" data-path="visualizacion-ext.html"><a href="visualizacion-ext.html#más-personalización"><i class="fa fa-check"></i>Más personalización</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="visualizacion-personalizacion.html"><a href="visualizacion-personalizacion.html"><i class="fa fa-check"></i>03C - Visualización de datos (personalización)</a><ul>
<li class="chapter" data-level="" data-path="visualizacion-personalizacion.html"><a href="visualizacion-personalizacion.html#inicio-cargar-paquetes-base-de-datos-1"><i class="fa fa-check"></i>Inicio: cargar paquetes, base de datos</a></li>
<li class="chapter" data-level="" data-path="visualizacion-personalizacion.html"><a href="visualizacion-personalizacion.html#gráfico-de-ejemplo"><i class="fa fa-check"></i>Gráfico de ejemplo</a></li>
<li class="chapter" data-level="" data-path="visualizacion-personalizacion.html"><a href="visualizacion-personalizacion.html#gráficos-como-objetos-guardar-gráficos-en-el-disco"><i class="fa fa-check"></i>Gráficos como objetos / guardar gráficos en el disco</a></li>
<li class="chapter" data-level="" data-path="visualizacion-personalizacion.html"><a href="visualizacion-personalizacion.html#personalización-de-gráficos"><i class="fa fa-check"></i>Personalización de gráficos</a></li>
</ul></li>
<li class="part"><span><b>IV Búsqueda de ayuda</b></span></li>
<li class="chapter" data-level="" data-path="busqueda-ayuda.html"><a href="busqueda-ayuda.html"><i class="fa fa-check"></i>04 - Guía búsqueda de ayuda</a><ul>
<li class="chapter" data-level="" data-path="busqueda-ayuda.html"><a href="busqueda-ayuda.html#leer-archivos-de-ayuda-de-r"><i class="fa fa-check"></i>Leer archivos de ayuda de R</a></li>
<li class="chapter" data-level="" data-path="busqueda-ayuda.html"><a href="busqueda-ayuda.html#encontrar-funciones-en-línea"><i class="fa fa-check"></i>Encontrar funciones en línea</a></li>
<li class="chapter" data-level="" data-path="busqueda-ayuda.html"><a href="busqueda-ayuda.html#solucionar-problemas"><i class="fa fa-check"></i>Solucionar problemas</a></li>
<li class="chapter" data-level="" data-path="busqueda-ayuda.html"><a href="busqueda-ayuda.html#pedir-ayuda-con-ejemplos-reproducibles-reprex"><i class="fa fa-check"></i>Pedir ayuda con ejemplos reproducibles (reprex)</a></li>
</ul></li>
<li class="part"><span><b>V Manejo avanzado de datos</b></span></li>
<li class="chapter" data-level="" data-path="manejo-av.html"><a href="manejo-av.html"><i class="fa fa-check"></i>05A - Manejo avanzado de datos</a><ul>
<li class="chapter" data-level="" data-path="manejo-av.html"><a href="manejo-av.html#inicio-cargar-paquetes-base-de-datos-2"><i class="fa fa-check"></i>Inicio: cargar paquetes, base de datos</a></li>
<li class="chapter" data-level="" data-path="manejo-av.html"><a href="manejo-av.html#pivotear-bases-de-datos-wide---long"><i class="fa fa-check"></i>Pivotear bases de datos (wide &lt;-&gt; long)</a></li>
<li class="chapter" data-level="" data-path="manejo-av.html"><a href="manejo-av.html#recodificar-variables"><i class="fa fa-check"></i>Recodificar variables</a></li>
<li class="chapter" data-level="" data-path="manejo-av.html"><a href="manejo-av.html#valores-perdidosmissingna"><i class="fa fa-check"></i>Valores perdidos/missing/NA</a></li>
<li class="chapter" data-level="" data-path="manejo-av.html"><a href="manejo-av.html#unir-bases-de-datos"><i class="fa fa-check"></i>Unir bases de datos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="manejo-av-ej.html"><a href="manejo-av-ej.html"><i class="fa fa-check"></i>05B - Manejo avanzado de datos (ejercicio)</a></li>
<li class="part"><span><b>VI Análisis de texto</b></span></li>
<li class="chapter" data-level="" data-path="texto-analisis.html"><a href="texto-analisis.html"><i class="fa fa-check"></i>06A - Análisis de texto</a><ul>
<li class="chapter" data-level="" data-path="texto-analisis.html"><a href="texto-analisis.html#inicio-cargar-paquetes-base-de-datos-3"><i class="fa fa-check"></i>Inicio: cargar paquetes, base de datos</a></li>
<li class="chapter" data-level="" data-path="texto-analisis.html"><a href="texto-analisis.html#tokens-y-frecuencias"><i class="fa fa-check"></i>Tokens y frecuencias</a></li>
<li class="chapter" data-level="" data-path="texto-analisis.html"><a href="texto-analisis.html#separar-el-análisis-de-frecuencias-por-secciones"><i class="fa fa-check"></i>Separar el análisis de frecuencias por secciones</a></li>
<li class="chapter" data-level="" data-path="texto-analisis.html"><a href="texto-analisis.html#obtener-las-palabras-más-distintivas-al-comparar-documentos"><i class="fa fa-check"></i>Obtener las palabras más distintivas al comparar documentos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="texto-cadenas.html"><a href="texto-cadenas.html"><i class="fa fa-check"></i>06B - Cadenas de texto</a><ul>
<li class="chapter" data-level="" data-path="texto-cadenas.html"><a href="texto-cadenas.html#inicio-cargar-paquetes-base-de-datos-4"><i class="fa fa-check"></i>Inicio: cargar paquetes, base de datos</a></li>
<li class="chapter" data-level="" data-path="texto-cadenas.html"><a href="texto-cadenas.html#cadenas-de-texto"><i class="fa fa-check"></i>Cadenas de texto</a></li>
<li class="chapter" data-level="" data-path="texto-cadenas.html"><a href="texto-cadenas.html#algunas-operaciones-simples-con-texto"><i class="fa fa-check"></i>Algunas operaciones simples con texto</a></li>
<li class="chapter" data-level="" data-path="texto-cadenas.html"><a href="texto-cadenas.html#funciones-para-trabajar-con-patrones"><i class="fa fa-check"></i>Funciones para trabajar con patrones</a></li>
<li><a href="texto-cadenas.html#patrones-más-complejos-con-expresiones-regulares-regex">Patrones más complejos con expresiones regulares (<em>regex</em>)</a></li>
<li class="chapter" data-level="" data-path="texto-cadenas.html"><a href="texto-cadenas.html#ejercicio-f"><i class="fa fa-check"></i>(Ejercicio f)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="texto-libros.html"><a href="texto-libros.html"><i class="fa fa-check"></i>06C - Descarga de libros</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado con bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Programación para las Ciencias Sociales</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="manejo-av" class="section level1 unnumbered">
<h1>05A - Manejo avanzado de datos</h1>
<blockquote>
<p>Si quieres correr estos scripts localmente, acá puedes <a href="./static/05_manejo_av.zip">descargar el proyecto comprimido en .zip</a>. Paquetes que necesitas tener instalados antes de comenzar con el proyecto (05A, 05B): <code>tidyverse</code>, <code>janitor</code>.</p>
</blockquote>
<div id="inicio-cargar-paquetes-base-de-datos-2" class="section level2">
<h2>Inicio: cargar paquetes, base de datos</h2>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="manejo-av.html#cb258-1"></a><span class="kw">library</span>(tidyverse)</span></code></pre></div>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="manejo-av.html#cb259-1"></a>df_tasa_robos &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/tasa_robos_wide.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   comuna = col_character(),
##   comuna_id = col_double(),
##   `2012` = col_double(),
##   `2013` = col_double(),
##   `2014` = col_double(),
##   `2015` = col_double(),
##   `2016` = col_double()
## )</code></pre>
<p>Tenemos una base de datos con los casos policiales de robos cada 1.000 habitantes. Contiene información para 340 comunas de Chile, 2012-2016. Su fuente es la <a href="http://www.fnsp.gob.cl/estadisticas-delictuales-por-comuna/">Subsecretaría de Prevención del Delito (2017)</a>.</p>
</div>
<div id="pivotear-bases-de-datos-wide---long" class="section level2">
<h2>Pivotear bases de datos (wide &lt;-&gt; long)</h2>
<p>¿Qué pasa si queremos graficar estos datos, por ejemplo viendo la evolución temporal de la variable en una comuna? El formato de los datos no es el ideal. Aquí los valores de una variable (año) se expandieron hacia las columnas, generando una base en formato <em>wide</em>.</p>
<p>Podemos “alargar” esta base usando la función <code>pivot_longer()</code>, de la siguiente manera:</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="manejo-av.html#cb261-1"></a>df_tasa_robos_long &lt;-<span class="st"> </span>df_tasa_robos <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb261-2"><a href="manejo-av.html#cb261-2"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> <span class="op">-</span><span class="kw">c</span>(comuna, comuna_id), <span class="co"># descartamos vars. que no queremos transformar</span></span>
<span id="cb261-3"><a href="manejo-av.html#cb261-3"></a>               <span class="dt">names_to =</span> <span class="st">&quot;anio&quot;</span>, <span class="dt">values_to =</span> <span class="st">&quot;tasa_robos&quot;</span>)</span>
<span id="cb261-4"><a href="manejo-av.html#cb261-4"></a>df_tasa_robos_long</span></code></pre></div>
<pre><code>## # A tibble: 1,700 x 4
##    comuna    comuna_id anio  tasa_robos
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;
##  1 Algarrobo      5602 2012       4031.
##  2 Algarrobo      5602 2013       3612.
##  3 Algarrobo      5602 2014       3734.
##  4 Algarrobo      5602 2015       4231.
##  5 Algarrobo      5602 2016       3665.
##  6 Alhué         13502 2012        796.
##  7 Alhué         13502 2013        950.
##  8 Alhué         13502 2014       1167.
##  9 Alhué         13502 2015        606.
## 10 Alhué         13502 2016        956.
## # ... with 1,690 more rows</code></pre>
<p>Esta estructura de datos es mucho más amigable para <code>ggplot2</code>:</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="manejo-av.html#cb263-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> df_tasa_robos_long <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(comuna <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;San-Joaquín&quot;</span>, <span class="st">&quot;Macul&quot;</span>)),</span>
<span id="cb263-2"><a href="manejo-av.html#cb263-2"></a>       <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">as.factor</span>(anio), <span class="dt">y =</span> tasa_robos, </span>
<span id="cb263-3"><a href="manejo-av.html#cb263-3"></a>                     <span class="dt">color =</span> comuna, <span class="dt">group =</span> comuna)) <span class="op">+</span></span>
<span id="cb263-4"><a href="manejo-av.html#cb263-4"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="co"># podríamos seguir añadiendo escalas, labs, etc...</span></span></code></pre></div>
<p><img src="uc_2020_bookdown_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p>Noten que <code>pivot_longer()</code> tiene una función recíproca, <code>pivot_wider()</code>:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="manejo-av.html#cb264-1"></a>df_tasa_robos_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb264-2"><a href="manejo-av.html#cb264-2"></a><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;anio&quot;</span>, <span class="dt">values_from =</span> <span class="st">&quot;tasa_robos&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 340 x 7
##    comuna          comuna_id `2012` `2013` `2014` `2015` `2016`
##    &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1 Algarrobo            5602  4031.  3612.  3734.  4231.  3665.
##  2 Alhué               13502   796.   950.  1167.   606.   956.
##  3 Alto-Biobío          8314   225.   305.   245.   139.   103.
##  4 Alto-del-Carmen      3302   208.   209.   397.   293.   315.
##  5 Alto-Hospicio        1107  2589.  2218.  1930.  1962.  1847.
##  6 Ancud               10202   579.   763.   697.   755.   732.
##  7 Andacollo            4103   759.   640.   892.   911.  1075.
##  8 Angol                9201  1400.  1515.  1822.  1939.  1468.
##  9 Antártica           12202     0      0      0      0      0 
## 10 Antofagasta          2101  2178.  1892.  1938.  1671.  1391.
## # ... with 330 more rows</code></pre>
</div>
<div id="recodificar-variables" class="section level2">
<h2>Recodificar variables</h2>
<p>Supongamos que, usando nuestra nueva base <em>long</em>, queremos crear una variable binaria/dummy que indique si la observación es para el gobierno de Piñera I o Bachelet II. Podemos usar <code>if_else()</code> dentro de <code>mutate()</code>:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="manejo-av.html#cb266-1"></a>df_tasa_robos_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb266-2"><a href="manejo-av.html#cb266-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">d_gob_bachelet =</span> <span class="kw">if_else</span>(<span class="dt">condition =</span> anio <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2014</span>, </span>
<span id="cb266-3"><a href="manejo-av.html#cb266-3"></a>                                  <span class="dt">true      =</span> <span class="dv">1</span>,</span>
<span id="cb266-4"><a href="manejo-av.html#cb266-4"></a>                                  <span class="dt">false     =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,700 x 5
##    comuna    comuna_id anio  tasa_robos d_gob_bachelet
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;          &lt;dbl&gt;
##  1 Algarrobo      5602 2012       4031.              0
##  2 Algarrobo      5602 2013       3612.              0
##  3 Algarrobo      5602 2014       3734.              1
##  4 Algarrobo      5602 2015       4231.              1
##  5 Algarrobo      5602 2016       3665.              1
##  6 Alhué         13502 2012        796.              0
##  7 Alhué         13502 2013        950.              0
##  8 Alhué         13502 2014       1167.              1
##  9 Alhué         13502 2015        606.              1
## 10 Alhué         13502 2016        956.              1
## # ... with 1,690 more rows</code></pre>
<p><code>if_else()</code> nos sirve si es que queremos crear variables binarias (numéricas o no). Pero a menudo queremos asignar más categorías. En esos casos podemos usar <code>case_when()</code>:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="manejo-av.html#cb268-1"></a>df_tasa_robos_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb268-2"><a href="manejo-av.html#cb268-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gobierno =</span> <span class="kw">case_when</span>(anio <span class="op">&lt;</span><span class="st"> </span><span class="dv">2014</span>  <span class="op">~</span><span class="st"> &quot;Piñera I&quot;</span>, <span class="co"># condición ~ valor</span></span>
<span id="cb268-3"><a href="manejo-av.html#cb268-3"></a>                              anio <span class="op">==</span><span class="st"> </span><span class="dv">2014</span> <span class="op">~</span><span class="st"> &quot;Cambio de mando&quot;</span>,</span>
<span id="cb268-4"><a href="manejo-av.html#cb268-4"></a>                              anio <span class="op">&gt;</span><span class="st"> </span><span class="dv">2014</span>  <span class="op">~</span><span class="st"> &quot;Bachelet II&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1,700 x 5
##    comuna    comuna_id anio  tasa_robos gobierno       
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;          
##  1 Algarrobo      5602 2012       4031. Piñera I       
##  2 Algarrobo      5602 2013       3612. Piñera I       
##  3 Algarrobo      5602 2014       3734. Cambio de mando
##  4 Algarrobo      5602 2015       4231. Bachelet II    
##  5 Algarrobo      5602 2016       3665. Bachelet II    
##  6 Alhué         13502 2012        796. Piñera I       
##  7 Alhué         13502 2013        950. Piñera I       
##  8 Alhué         13502 2014       1167. Cambio de mando
##  9 Alhué         13502 2015        606. Bachelet II    
## 10 Alhué         13502 2016        956. Bachelet II    
## # ... with 1,690 more rows</code></pre>
<p>Una opción válida al usar <code>case_when()</code> es asignar un valor para “cualquier otro caso”:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="manejo-av.html#cb270-1"></a>df_tasa_robos_long <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb270-2"><a href="manejo-av.html#cb270-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gobierno =</span> <span class="kw">case_when</span>(anio <span class="op">&lt;</span><span class="st"> </span><span class="dv">2014</span>  <span class="op">~</span><span class="st"> &quot;Piñera I&quot;</span>, </span>
<span id="cb270-3"><a href="manejo-av.html#cb270-3"></a>                              anio <span class="op">==</span><span class="st"> </span><span class="dv">2014</span> <span class="op">~</span><span class="st"> &quot;Cambio de mando&quot;</span>,</span>
<span id="cb270-4"><a href="manejo-av.html#cb270-4"></a>                              <span class="ot">TRUE</span>         <span class="op">~</span><span class="st"> &quot;Bachelet II&quot;</span>)) <span class="co"># en cualquier otro caso</span></span></code></pre></div>
<pre><code>## # A tibble: 1,700 x 5
##    comuna    comuna_id anio  tasa_robos gobierno       
##    &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;          
##  1 Algarrobo      5602 2012       4031. Piñera I       
##  2 Algarrobo      5602 2013       3612. Piñera I       
##  3 Algarrobo      5602 2014       3734. Cambio de mando
##  4 Algarrobo      5602 2015       4231. Bachelet II    
##  5 Algarrobo      5602 2016       3665. Bachelet II    
##  6 Alhué         13502 2012        796. Piñera I       
##  7 Alhué         13502 2013        950. Piñera I       
##  8 Alhué         13502 2014       1167. Cambio de mando
##  9 Alhué         13502 2015        606. Bachelet II    
## 10 Alhué         13502 2016        956. Bachelet II    
## # ... with 1,690 more rows</code></pre>
<div id="mini-ejercicio" class="section level3">
<h3>Mini-ejercicio</h3>
<p>Crea la variable <code>d_gob_bachele</code> de antes, pero esta vez usando <code>case_when()</code>. Tu código:</p>
</div>
</div>
<div id="valores-perdidosmissingna" class="section level2">
<h2>Valores perdidos/missing/NA</h2>
<p>Para el resto de la clase trabajaremos también con datos de robos, esta vez para los países del Cono Sur (2006-2016). <a href="https://dataunodc.un.org/crime/theft">La fuente es la Oficina de las Naciones Unidas contra la Droga y el Delito (UNODC)</a>.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="manejo-av.html#cb272-1"></a>df_robos_cono_sur &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/robos_cono_sur.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   pais = col_character(),
##   pais_codigo = col_character(),
##   anio = col_double(),
##   robos_c100k = col_double()
## )</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="manejo-av.html#cb274-1"></a>df_robos_cono_sur</span></code></pre></div>
<pre><code>## # A tibble: 33 x 4
##    pais      pais_codigo  anio robos_c100k
##    &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Argentina ARG          2006        738.
##  2 Argentina ARG          2007        662.
##  3 Argentina ARG          2008        704.
##  4 Argentina ARG          2009         NA 
##  5 Argentina ARG          2010         NA 
##  6 Argentina ARG          2011         NA 
##  7 Argentina ARG          2012         NA 
##  8 Argentina ARG          2013         NA 
##  9 Argentina ARG          2014        668.
## 10 Argentina ARG          2015        626.
## # ... with 23 more rows</code></pre>
<p>Veamos los datos. <a href="https://chequeado.com/el-explicador/se-publicaron-las-estadisticas-de-delitos-que-dicen-los-datos/">¿Qué pasó con las datos de Argentina, 2009-2013?</a></p>
<p>R registra los valores perdidos como “NA”. Esto no es un caracter con las letras N y A, sino que un <strong>valor especial</strong> dentro del vector, sin importar su tipo.</p>
<div id="realizar-operaciones-básicas-en-vectores-con-na" class="section level3">
<h3>Realizar operaciones básicas en vectores con NA</h3>
<p>Intentemos calcular la media por país para la variable “robos_c100k”:</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="manejo-av.html#cb276-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb276-2"><a href="manejo-av.html#cb276-2"></a><span class="st">  </span><span class="kw">group_by</span>(pais) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb276-3"><a href="manejo-av.html#cb276-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">media_robos_c100k =</span> <span class="kw">mean</span>(robos_c100k))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   pais      media_robos_c100k
##   &lt;chr&gt;                 &lt;dbl&gt;
## 1 Argentina               NA 
## 2 Chile                 1070.
## 3 Uruguay               2984.</code></pre>
<p>La mayoría de las operaciones básicas en R (<code>median()</code>, <code>sd()</code>, <code>sum()</code>, etc.) fallarán cuando alguno de los valores en el cálculo sea un NA. Si es que de todas formas queremos utilizar la función, tomando en cuenta solo los valores existentes, prácticamente todas estas operaciones incluyen un argumento <code>na.rm =</code> (NA remove):</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="manejo-av.html#cb279-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb279-2"><a href="manejo-av.html#cb279-2"></a><span class="st">  </span><span class="kw">group_by</span>(pais) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb279-3"><a href="manejo-av.html#cb279-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">media_robos_c100k =</span> <span class="kw">mean</span>(robos_c100k, <span class="dt">na.rm =</span> T))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   pais      media_robos_c100k
##   &lt;chr&gt;                 &lt;dbl&gt;
## 1 Argentina              669.
## 2 Chile                 1070.
## 3 Uruguay               2984.</code></pre>
<p>Por defecto, los modelos de regresión hacen algo como esto, omiten las observaciones que tengan NA en alguna de las variables del modelo. Siempre que estemos en la duda sobre cómo se comporta alguna función ante NAs, deberíamos revisar su archivo de ayuda y buscar algún argumento que incluya “na”:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="manejo-av.html#cb282-1"></a>?lm</span></code></pre></div>
</div>
<div id="filtrar-nas-de-una-base" class="section level3">
<h3>Filtrar NAs de una base</h3>
<p>Lo siguiente no funcionará:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="manejo-av.html#cb283-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb283-2"><a href="manejo-av.html#cb283-2"></a><span class="st">  </span><span class="kw">filter</span>(robos_c100k <span class="op">==</span><span class="st"> </span><span class="ot">NA</span>)</span></code></pre></div>
<p>Lo que debemos utilizar en operaciones lógicas para testear la presencia de NAs es la función <code>is.na()</code>:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="manejo-av.html#cb284-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb284-2"><a href="manejo-av.html#cb284-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(robos_c100k))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 4
##   pais      pais_codigo  anio robos_c100k
##   &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1 Argentina ARG          2009          NA
## 2 Argentina ARG          2010          NA
## 3 Argentina ARG          2011          NA
## 4 Argentina ARG          2012          NA
## 5 Argentina ARG          2013          NA</code></pre>
<p>Podemos realizar una negación en una operación lógica antecediéndola de un signo de exclamación. En este caso, obtendremos solo las observaciones que no tienen NA en “robos_c100k”:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="manejo-av.html#cb286-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb286-2"><a href="manejo-av.html#cb286-2"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(robos_c100k))</span></code></pre></div>
<pre><code>## # A tibble: 28 x 4
##    pais      pais_codigo  anio robos_c100k
##    &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Argentina ARG          2006        738.
##  2 Argentina ARG          2007        662.
##  3 Argentina ARG          2008        704.
##  4 Argentina ARG          2014        668.
##  5 Argentina ARG          2015        626.
##  6 Argentina ARG          2016        616.
##  7 Chile     CHL          2006        942.
##  8 Chile     CHL          2007       1018.
##  9 Chile     CHL          2008       1054.
## 10 Chile     CHL          2009       1136.
## # ... with 18 more rows</code></pre>
</div>
<div id="crear-valores-perdidos" class="section level3">
<h3>Crear valores perdidos</h3>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="manejo-av.html#cb288-1"></a>df_robos_cono_sur</span></code></pre></div>
<pre><code>## # A tibble: 33 x 4
##    pais      pais_codigo  anio robos_c100k
##    &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Argentina ARG          2006        738.
##  2 Argentina ARG          2007        662.
##  3 Argentina ARG          2008        704.
##  4 Argentina ARG          2009         NA 
##  5 Argentina ARG          2010         NA 
##  6 Argentina ARG          2011         NA 
##  7 Argentina ARG          2012         NA 
##  8 Argentina ARG          2013         NA 
##  9 Argentina ARG          2014        668.
## 10 Argentina ARG          2015        626.
## # ... with 23 more rows</code></pre>
<p>Supongamos que no confiamos en los datos más antiguos para Argentina (2006-2008) y también queremos asignarlos como valores perdidos. Una opción podría ser eliminar dichas observaciones con <code>filter()</code>, pero tal vez tenemos información útil en otras variables.</p>
<p>Podríamos asignarle el valor de NA a dichas observaciones con <code>if_else()</code> o <code>case_when()</code>:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="manejo-av.html#cb290-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb290-2"><a href="manejo-av.html#cb290-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robos_c100k =</span> <span class="kw">case_when</span>(</span>
<span id="cb290-3"><a href="manejo-av.html#cb290-3"></a>    pais <span class="op">==</span><span class="st"> &quot;Argentina&quot;</span> <span class="op">&amp;</span><span class="st"> </span>anio <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2008</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA</span>,</span>
<span id="cb290-4"><a href="manejo-av.html#cb290-4"></a>    <span class="ot">TRUE</span>                               <span class="op">~</span><span class="st"> </span>robos_c100k</span>
<span id="cb290-5"><a href="manejo-av.html#cb290-5"></a>  ))</span></code></pre></div>
<p>Lo anterior falla, pese a que la sintaxis de <code>case_when()</code> es correcta! El problema es que cuando creamos valores perdidos debemos decirle explícitamente a R qué tipo de NAs utilizaremos, según el tipo de vector. Los tipos más comunes son <code>NA_character_</code> (para vectores de caracteres, chr) o <code>NA_real_</code> (para vectores de números reales, dbl). Veamos cómo ahora funcionará:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="manejo-av.html#cb291-1"></a>df_robos_cono_sur <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb291-2"><a href="manejo-av.html#cb291-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">robos_c100k =</span> <span class="kw">case_when</span>(</span>
<span id="cb291-3"><a href="manejo-av.html#cb291-3"></a>    pais <span class="op">==</span><span class="st"> &quot;Argentina&quot;</span> <span class="op">&amp;</span><span class="st"> </span>anio <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2008</span> <span class="op">~</span><span class="st"> </span><span class="ot">NA_real_</span>,</span>
<span id="cb291-4"><a href="manejo-av.html#cb291-4"></a>    <span class="ot">TRUE</span>                               <span class="op">~</span><span class="st"> </span>robos_c100k</span>
<span id="cb291-5"><a href="manejo-av.html#cb291-5"></a>  ))</span></code></pre></div>
<pre><code>## # A tibble: 33 x 4
##    pais      pais_codigo  anio robos_c100k
##    &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;
##  1 Argentina ARG          2006         NA 
##  2 Argentina ARG          2007         NA 
##  3 Argentina ARG          2008         NA 
##  4 Argentina ARG          2009         NA 
##  5 Argentina ARG          2010         NA 
##  6 Argentina ARG          2011         NA 
##  7 Argentina ARG          2012         NA 
##  8 Argentina ARG          2013         NA 
##  9 Argentina ARG          2014        668.
## 10 Argentina ARG          2015        626.
## # ... with 23 more rows</code></pre>
</div>
</div>
<div id="unir-bases-de-datos" class="section level2">
<h2>Unir bases de datos</h2>
<p>Aquí tenemos una base con muchos datos de los <a href="https://databank.worldbank.org/table/source/2">World Development Indicators del Banco Mundial</a>. Están para los tres países del Cono Sur, pero desde 2007 a 2016 (falta 2006, en comparación a los datos anteriores).</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="manejo-av.html#cb293-1"></a>df_wdi &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;datos/wdi_cono_sur.csv&quot;</span>)</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   pais_codigo = col_character(),
##   external_debt_stocks_total_dod_current_us = col_logical(),
##   total_debt_service_percent_of_exports_of_goods_services_and_primary_income = col_logical()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="manejo-av.html#cb296-1"></a>df_wdi</span></code></pre></div>
<pre><code>## # A tibble: 30 x 57
##    pais_codigo  anio population_total population_grow~ surface_area_sq~ population_dens~ poverty_headcou~ poverty_headcou~ gni_atlas_metho~ gni_per_capita_~ gni_ppp_current~ gni_per_capita_~ income_share_he~ life_expectancy~ fertility_rate_~
##    &lt;chr&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 ARG          2007         39684295            0.999         2780400              14.5             NA                2.9    258429317135.             6510    656745628034.            16550              3.9             74.8             2.38
##  2 CHL          2007         16530195            1.07           756096.             22.2             NA               NA      143603828921.             8690    248814945028.            15050             NA               78.1             1.90
##  3 URY          2007          3331749            0.191          176220              19.0             29.6              0.3     21283077870.             6390     44113794683.            13240              4.8             76.3             2.05
##  4 ARG          2008         40080160            0.993         2780400              14.6             NA                2.6    307363845739.             7670    697740913973.            17410              4               75.0             2.37
##  5 CHL          2008         16708258            1.07           756096.             22.5             NA               NA      167969056839.            10050    254260262605.            15220             NA               78.3             1.90
##  6 URY          2008          3340221            0.254          176220              19.1             24.2              0.2     25752230257.             7710     47817999408.            14320              5               76.4             2.03
##  7 ARG          2009         40482788            1.00          2780400              14.8             NA                2.6    315586430026.             7800    657382734891.            16240              4               75.1             2.36
##  8 CHL          2009         16886186            1.06           756096.             22.7             25.3              2.6    168009833889.             9950    254255791261.            15060              4.6             78.6             1.89
##  9 URY          2009          3349676            0.283          176220              19.1             21                0.2     29494248573.             8810     50075569089.            14950              4.8             76.6             2.02
## 10 ARG          2010         40788453            0.752         2780400              14.9             NA                1.1    378241273936.             9270    729853440301.            17890              4.6             75.3             2.35
## # ... with 20 more rows, and 42 more variables: adolescent_fertility_rate_births_per_1_000_women_ages_15_19 &lt;dbl&gt;, contraceptive_prevalence_any_methods_percent_of_women_ages_15_49 &lt;dbl&gt;,
## #   births_attended_by_skilled_health_staff_percent_of_total &lt;dbl&gt;, mortality_rate_under_5_per_1_000_live_births &lt;dbl&gt;, prevalence_of_underweight_weight_for_age_percent_of_children_under_5 &lt;dbl&gt;,
## #   immunization_measles_percent_of_children_ages_12_23_months &lt;dbl&gt;, primary_completion_rate_total_percent_of_relevant_age_group &lt;dbl&gt;, school_enrollment_primary_percent_gross &lt;dbl&gt;, school_enrollment_secondary_percent_gross &lt;dbl&gt;,
## #   school_enrollment_primary_and_secondary_gross_gender_parity_index_gpi &lt;dbl&gt;, prevalence_of_hiv_total_percent_of_population_ages_15_49 &lt;dbl&gt;, forest_area_sq_km &lt;dbl&gt;, terrestrial_and_marine_protected_areas_percent_of_total_territorial_area &lt;dbl&gt;,
## #   annual_freshwater_withdrawals_total_percent_of_internal_resources &lt;dbl&gt;, urban_population_growth_annual_percent &lt;dbl&gt;, energy_use_kg_of_oil_equivalent_per_capita &lt;dbl&gt;, co2_emissions_metric_tons_per_capita &lt;dbl&gt;,
## #   electric_power_consumption_k_wh_per_capita &lt;dbl&gt;, gdp_current_us &lt;dbl&gt;, gdp_growth_annual_percent &lt;dbl&gt;, inflation_gdp_deflator_annual_percent &lt;dbl&gt;, agriculture_forestry_and_fishing_value_added_percent_of_gdp &lt;dbl&gt;,
## #   industry_including_construction_value_added_percent_of_gdp &lt;dbl&gt;, exports_of_goods_and_services_percent_of_gdp &lt;dbl&gt;, imports_of_goods_and_services_percent_of_gdp &lt;dbl&gt;, gross_capital_formation_percent_of_gdp &lt;dbl&gt;,
## #   revenue_excluding_grants_percent_of_gdp &lt;dbl&gt;, time_required_to_start_a_business_days &lt;dbl&gt;, domestic_credit_provided_by_financial_sector_percent_of_gdp &lt;dbl&gt;, tax_revenue_percent_of_gdp &lt;dbl&gt;, military_expenditure_percent_of_gdp &lt;dbl&gt;,
## #   mobile_cellular_subscriptions_per_100_people &lt;dbl&gt;, high_technology_exports_percent_of_manufactured_exports &lt;dbl&gt;, statistical_capacity_score_overall_average &lt;dbl&gt;, merchandise_trade_percent_of_gdp &lt;dbl&gt;,
## #   net_barter_terms_of_trade_index_2000_100 &lt;dbl&gt;, external_debt_stocks_total_dod_current_us &lt;lgl&gt;, total_debt_service_percent_of_exports_of_goods_services_and_primary_income &lt;lgl&gt;, net_migration &lt;dbl&gt;,
## #   personal_remittances_received_current_us &lt;dbl&gt;, foreign_direct_investment_net_inflows_bo_p_current_us &lt;dbl&gt;, net_official_development_assistance_and_official_aid_received_current_us &lt;dbl&gt;</code></pre>
<p>¿Cómo podemos añadir toda esta nueva información a nuestra base original? No podemos simplemente pegar las columnas unas al lado de otras con <code>bind_cols()</code> (los números de filas son distintos, lo mismo con el orden de las observaciones).</p>
<p>Lo mejor es realizar una unión de bases (merge/join). Lejos la más común de estas operaciones es la unión izquierda, en la que queremos añadir información a una base (la izquierda) a partir de otra (la derecha). <code>left_join()</code> nos permitirá hacer esto, mirando las observaciones de ambas bases donde las columnas de identificación toman los mismos valores:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="manejo-av.html#cb298-1"></a>df_robos_cono_sur_con_wdi &lt;-<span class="st"> </span><span class="kw">left_join</span>(</span>
<span id="cb298-2"><a href="manejo-av.html#cb298-2"></a>  <span class="dt">x =</span> df_robos_cono_sur, <span class="dt">y =</span> df_wdi,</span>
<span id="cb298-3"><a href="manejo-av.html#cb298-3"></a>  <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;pais_codigo&quot;</span>, <span class="st">&quot;anio&quot;</span>) <span class="co"># by dice cuáles son las variables de id.</span></span>
<span id="cb298-4"><a href="manejo-av.html#cb298-4"></a>)</span>
<span id="cb298-5"><a href="manejo-av.html#cb298-5"></a>df_robos_cono_sur_con_wdi</span></code></pre></div>
<pre><code>## # A tibble: 33 x 59
##    pais  pais_codigo  anio robos_c100k population_total population_grow~ surface_area_sq~ population_dens~ poverty_headcou~ poverty_headcou~ gni_atlas_metho~ gni_per_capita_~ gni_ppp_current~ gni_per_capita_~ income_share_he~ life_expectancy~
##    &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1 Arge~ ARG          2006        738.               NA           NA                   NA             NA                 NA             NA                NA                NA              NA                NA             NA               NA  
##  2 Arge~ ARG          2007        662.         39684295            0.999          2780400             14.5               NA              2.9    258429317135.             6510    656745628034.            16550              3.9             74.8
##  3 Arge~ ARG          2008        704.         40080160            0.993          2780400             14.6               NA              2.6    307363845739.             7670    697740913973.            17410              4               75.0
##  4 Arge~ ARG          2009         NA          40482788            1.00           2780400             14.8               NA              2.6    315586430026.             7800    657382734891.            16240              4               75.1
##  5 Arge~ ARG          2010         NA          40788453            0.752          2780400             14.9               NA              1.1    378241273936.             9270    729853440301.            17890              4.6             75.3
##  6 Arge~ ARG          2011         NA          41261490            1.15           2780400             15.1               NA              0.9    442037545216.            10710    794325172722.            19250              4.8             75.4
##  7 Arge~ ARG          2012         NA          41733271            1.14           2780400             15.2               NA              0.8    496046283910.            11890    805324243205.            19300              4.9             75.6
##  8 Arge~ ARG          2013         NA          42202935            1.12           2780400             15.4               NA              0.8    543285805981.            12870    841055034261.            19930              5               75.8
##  9 Arge~ ARG          2014        668.         42669500            1.10           2780400             15.6               NA              0.7    526784533342.            12350    836246704582.            19600              5.1             75.9
## 10 Arge~ ARG          2015        626.         43131966            1.08           2780400             15.8               NA             NA      543279945585.            12600    869846606665.            20170             NA               76.1
## # ... with 23 more rows, and 43 more variables: fertility_rate_total_births_per_woman &lt;dbl&gt;, adolescent_fertility_rate_births_per_1_000_women_ages_15_19 &lt;dbl&gt;, contraceptive_prevalence_any_methods_percent_of_women_ages_15_49 &lt;dbl&gt;,
## #   births_attended_by_skilled_health_staff_percent_of_total &lt;dbl&gt;, mortality_rate_under_5_per_1_000_live_births &lt;dbl&gt;, prevalence_of_underweight_weight_for_age_percent_of_children_under_5 &lt;dbl&gt;,
## #   immunization_measles_percent_of_children_ages_12_23_months &lt;dbl&gt;, primary_completion_rate_total_percent_of_relevant_age_group &lt;dbl&gt;, school_enrollment_primary_percent_gross &lt;dbl&gt;, school_enrollment_secondary_percent_gross &lt;dbl&gt;,
## #   school_enrollment_primary_and_secondary_gross_gender_parity_index_gpi &lt;dbl&gt;, prevalence_of_hiv_total_percent_of_population_ages_15_49 &lt;dbl&gt;, forest_area_sq_km &lt;dbl&gt;, terrestrial_and_marine_protected_areas_percent_of_total_territorial_area &lt;dbl&gt;,
## #   annual_freshwater_withdrawals_total_percent_of_internal_resources &lt;dbl&gt;, urban_population_growth_annual_percent &lt;dbl&gt;, energy_use_kg_of_oil_equivalent_per_capita &lt;dbl&gt;, co2_emissions_metric_tons_per_capita &lt;dbl&gt;,
## #   electric_power_consumption_k_wh_per_capita &lt;dbl&gt;, gdp_current_us &lt;dbl&gt;, gdp_growth_annual_percent &lt;dbl&gt;, inflation_gdp_deflator_annual_percent &lt;dbl&gt;, agriculture_forestry_and_fishing_value_added_percent_of_gdp &lt;dbl&gt;,
## #   industry_including_construction_value_added_percent_of_gdp &lt;dbl&gt;, exports_of_goods_and_services_percent_of_gdp &lt;dbl&gt;, imports_of_goods_and_services_percent_of_gdp &lt;dbl&gt;, gross_capital_formation_percent_of_gdp &lt;dbl&gt;,
## #   revenue_excluding_grants_percent_of_gdp &lt;dbl&gt;, time_required_to_start_a_business_days &lt;dbl&gt;, domestic_credit_provided_by_financial_sector_percent_of_gdp &lt;dbl&gt;, tax_revenue_percent_of_gdp &lt;dbl&gt;, military_expenditure_percent_of_gdp &lt;dbl&gt;,
## #   mobile_cellular_subscriptions_per_100_people &lt;dbl&gt;, high_technology_exports_percent_of_manufactured_exports &lt;dbl&gt;, statistical_capacity_score_overall_average &lt;dbl&gt;, merchandise_trade_percent_of_gdp &lt;dbl&gt;,
## #   net_barter_terms_of_trade_index_2000_100 &lt;dbl&gt;, external_debt_stocks_total_dod_current_us &lt;lgl&gt;, total_debt_service_percent_of_exports_of_goods_services_and_primary_income &lt;lgl&gt;, net_migration &lt;dbl&gt;,
## #   personal_remittances_received_current_us &lt;dbl&gt;, foreign_direct_investment_net_inflows_bo_p_current_us &lt;dbl&gt;, net_official_development_assistance_and_official_aid_received_current_us &lt;dbl&gt;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="busqueda-ayuda.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="manejo-av-ej.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
